{"version":3,"sources":["wallet-adapters/ledger/core.ts","assets/logo.svg","utils/utils.tsx","utils/fetch-loop.tsx","utils/connection.tsx","components/Link.js","utils/notifications.tsx","wallet-adapters/types.ts","wallet-adapters/ledger/index.tsx","wallet-adapters/solong/index.tsx","wallet-adapters/phantom/index.tsx","wallet-adapters/math/index.tsx","utils/wallet.tsx","wallet-adapters/sollet-extension/index.tsx","global_style.ts","components/ErrorBoundary.jsx","utils/send.tsx","utils/tokens.tsx","utils/bonfidaConnector.tsx","utils/markets.tsx","utils/useInterval.tsx","components/layout/FloatingElement.jsx","components/Orderbook.jsx","utils/usePrevious.tsx","components/layout/DataTable.jsx","components/UserInfoTable/BalancesTable.jsx","components/UserInfoTable/OpenOrderTable.tsx","components/UserInfoTable/FillsTable.jsx","components/UserInfoTable/FeesTable.js","components/UserInfoTable/index.jsx","components/DepositDialog.jsx","components/StandaloneTokenAccountSelect.tsx","components/LinkAddress.tsx","components/StandaloneBalancesDisplay.tsx","components/TradeForm.tsx","components/TradesTable.tsx","components/DeprecatedMarketsInstructions.js","components/CustomMarketDialog.jsx","pages/TradePage.tsx","components/WalletConnect.tsx","pages/OpenOrdersPage.tsx","components/UserInfoTable/WalletBalancesTable.tsx","pages/BalancesPage.tsx","components/ConvertForm.tsx","pages/ConvertPage.tsx","utils/preferences.tsx","components/Settings.jsx","components/CustomClusterEndpointDialog.tsx","components/AppSearch.tsx","components/TopBar.tsx","components/HelpUrls.ts","components/Footer.tsx","components/BasicLayout.js","components/useMintInput.tsx","pages/ListNewMarketPage.jsx","pages/pools/NewPoolPage.tsx","components/MintName.tsx","pages/pools/PoolPage/PoolBasketDisplay.tsx","pages/pools/PoolPage/PoolInfoPanel.tsx","pages/pools/PoolPage/PoolCreateRedeemPanel.tsx","pages/pools/PoolPage/PoolBalancesPanel.tsx","pages/pools/PoolPage/PoolAdminPanel.tsx","pages/pools/PoolPage/index.tsx","pages/pools/PoolListPage.tsx","routes.tsx","App.tsx","serviceWorker.js","index.js"],"names":["ledgerSend","transport","instruction","p1","payload","a","p2","payloadOffset","length","chunk","slice","console","log","toString","send","Error","reply","harden","n","getSolanaDerivationPath","account","change","undefined","derivationPath","Buffer","alloc","offset","writeUInt8","writeUInt32BE","signTransaction","transaction","messageBytes","serializeMessage","signBytes","bytes","numPaths","concat","getPublicKey","publicKeyBytes","PublicKey","module","exports","isValidPublicKey","key","sleep","ms","Promise","resolve","setTimeout","percentFormat","Intl","NumberFormat","style","minimumFractionDigits","maximumFractionDigits","floorToDecimal","value","decimals","Math","floor","roundToDecimal","round","getDecimalCount","isNaN","includes","split","parseInt","divideBnToNumber","numerator","denominator","quotient","div","toNumber","rem","umod","gcd","getTokenMultiplierFromDecimals","BN","pow","localStorageListeners","useLocalStorageStringState","defaultState","state","localStorage","getItem","useState","notify","useEffect","push","filter","listener","setState","useCallback","newState","removeItem","setItem","forEach","useLocalStorageState","JSON","stringify","stringState","setStringState","useMemo","parse","abbreviateAddress","address","size","base58","toBase58","isEqual","obj1","obj2","keys","Object","k","pageLoadTime","Date","globalCache","Map","FetchLoopListener","cacheKey","fn","refreshInterval","refreshIntervalOnError","callback","cacheNullValues","this","FetchLoopInternal","timeoutId","listeners","errors","refresh","clearTimeout","stopped","errored","data","set","notifyListeners","warn","waitTime","min","timeSincePageLoad","document","visibilityState","hasFocus","random","Set","map","refreshIntervalsOnError","x","previousRefreshInterval","add","assert","delete","globalLoops","loops","has","get","addListener","loop","removeListener","all","values","useAsyncData","asyncFn","useReducer","i","rerender","loaded","refreshCache","clearCache","refreshAllCaches","ENDPOINTS","name","endpoint","custom","accountListenerCount","ConnectionContext","React","createContext","ConnectionProvider","children","setEndpoint","customEndpoints","setCustomEndpoints","availableEndpoints","connection","Connection","sendConnection","id","onAccountChange","Account","publicKey","removeAccountChangeListener","onSlotChange","removeSlotChangeListener","Provider","useConnection","context","useContext","useSendConnection","useConnectionConfig","endpointInfo","find","info","useAccountInfo","tuple","getAccountInfo","accountInfo","count","previousInfo","subscriptionId","equals","lamports","initializeOnly","setCache","currentItem","previousInfoRef","useRef","current","useAccountData","Link","external","props","to","rest","href","target","rel","message","description","txid","type","placement","color","notification","opacity","backgroundColor","DEFAULT_PUBLIC_KEY","LedgerWalletAdapter","_connecting","_publicKey","_transport","transactions","result","signed","signature","addSignature","TransportWebUSB","create","emit","disconnect","close","EventEmitter","SolongWalletAdapter","_onProcess","_connected","connect","bind","solong","window","signAllTransactions","selectAccount","then","catch","finally","PhantomWalletAdapter","_handleConnect","args","_handleDisconnect","solana","isPhantom","_provider","isConnected","autoApprove","open","on","MathWalletAdapter","isMathWallet","getAccount","ASSET_URL","WALLET_PROVIDERS","url","icon","adapter","_","network","sollet","Wallet","WalletContext","WalletProvider","autoConnect","setAutoConnect","providerUrl","setProviderUrl","provider","wallet","setWallet","updateWallet","readyState","removeEventListener","addEventListener","connected","setConnected","walletPublicKey","substring","isModalVisible","setIsModalVisible","select","providerName","title","okText","visible","okButtonProps","display","onCancel","width","onClick","alt","height","src","marginRight","textAlign","marginBottom","useWallet","setProvider","GlobalStyle","createGlobalStyle","Title","Typography","ErrorBoundary","hasError","level","error","Component","createTokenAccountTransaction","mintPublicKey","newAccount","Transaction","SystemProgram","getMinimumBalanceForRentExemption","TokenInstructions","TOKEN_PROGRAM_ID","fromPubkey","newAccountPubkey","space","programId","createAccount","initializeAccount","mint","owner","signer","settleFunds","market","openOrders","baseCurrencyAccount","quoteCurrencyAccount","sendNotification","baseCurrencyAccountPubkey","pubkey","quoteCurrencyAccountPubkey","baseMintAddress","createAccountTransaction","createAccountSigner","quoteMintAddress","referrerQuoteWallet","supportsReferralFees","usdt","TOKEN_MINTS","usdc","process","makeSettleFundsTransaction","settleFundsTransaction","settleFundsSigners","signers","mergeTransactions","sendTransaction","sendingMessage","settleAllFunds","tokenAccounts","markets","selectedTokenAccounts","programIds","reduce","cumulative","m","_programId","p","getOpenOrdersAccountsForProgramId","OpenOrders","findForOwner","openOrdersAccounts","baseTokenFree","quoteTokenFree","openOrdersAccountsForProgramIds","accounts","openOrdersAccount","_decoded","ownAddress","isZero","baseMint","quoteMint","selectedBaseTokenAccount","getSelectedTokenAccountForMint","selectedQuoteTokenAccount","settleTransactions","t","s","cancelOrder","params","cancelOrders","orders","order","makeMatchOrdersTransaction","makeCancelOrderInstruction","placeOrder","side","price","orderType","feeDiscountPubkey","formattedMinOrderSize","minOrderSize","toFixed","formattedTickSize","tickSize","isIncrement","num","step","abs","createAccountSigners","payer","matchOrderstransaction","startTime","getUnixTs","makePlaceOrderTransaction","placeOrderTx","placeOrderSigners","endTime","listMarket","getVaultOwnerAndNonce","nonce","createProgramAddress","toBuffer","toArrayLike","dexProgramId","vaultOwner","iaddn","baseLotSize","quoteLotSize","requestQueue","eventQueue","bids","asks","baseVault","quoteVault","feeRateBps","quoteDustThreshold","vaultSignerNonce","tx1","tx2","Market","getLayout","span","DexInstructions","initializeMarket","signTransactions","transactionsAndSigners","signedTransactions","signedTransaction","sendSignedTransaction","getTime","sentMessage","successMessage","timeout","getRecentBlockhash","recentBlockhash","blockhash","setSigners","partialSign","rawTransaction","serialize","sendRawTransaction","skipPreflight","done","awaitTransactionSignatureConfirmation","simulateResult","simulateTransaction","err","logs","line","startsWith","parsedErrorInfo","parseInstructionErrorResponse","parsedError","reject","onSignature","e","getSignatureStatuses","signatureStatuses","confirmations","resultDescription","AccountInfoResult","struct","executable","rentEpoch","GetMultipleAccountsAndContextRpcResult","array","union","jsonRpcVersion","literal","jsonrpc","jsonRpcResult","slot","getMultipleSolanaAccounts","publicKeys","commitment","_rpcRequest","unsafeRes","res","join","from","fromEntries","_recentBlockhash","_disableBlockhashCaching","signData","wireTransaction","_serialize","encodedTransaction","encoding","ACCOUNT_LAYOUT","BufferLayout","MINT_LAYOUT","parseTokenAccountData","decode","amount","parseTokenMintData","initialized","supply","getOwnedAccountsFilters","memcmp","offsetOf","dataSize","getOwnedTokenAccounts","filters","resp","bs58","every","filterBytes","getTokenAccountInfo","ownerAddress","splAccounts","parsedSplAccounts","effectiveMint","WRAPPED_SOL_MINT","useMintToTickers","customMarkets","useCustomMarkets","useMintInfos","useTokenAccounts","useAllMarkets","allMarkets","allMints","marketInfo","uniqueMints","stringMint","mintInfos","entries","BonfidaApi","path","fetch","URL","response","ok","json","responseJson","success","marketAddress","SONAR_MARKETS","sonarMarkets","sonarMarket","MARKETS","deprecated","SONAR_TOKEN_MINTS","sonarTokenMints","sonarTokenMint","tokenMint","USE_MARKETS","getMarketInfos","load","marketName","_VERY_SLOW_REFRESH_INTERVAL","useUnmigratedOpenOrdersAccounts","deprecatedOpenOrdersAccounts","deprecatedProgramIds","Array","publicKeyStr","baseTokenTotal","quoteTokenTotal","some","MarketContext","DEFAULT_MARKET","getMarketDetails","otherMarket","baseCurrency","token","baseLabel","quoteCurrency","quoteLabel","setCustomMarkets","MarketProvider","setMarketAddress","marketInfos","setMarket","getTradePageUrl","saved","useSelectedTokenAccounts","useMarket","useMarkPrice","markPrice","setMarkPrice","useOrderbook","orderbook","trades","limit","_useUnfilteredTrades","eventFlags","maker","trade","useTrades","bb","Number","ba","last","sort","b","getUnfilteredTrades","loadFills","useOrderbookAccounts","bidData","askData","bidOrderbook","Orderbook","askOrderbook","depth","getL2","useOpenOrdersAccounts","fast","getOpenOrdersAccounts","findOpenOrdersAccountsForOwner","useSelectedOpenOrdersAccount","selectedPubKey","filtered","useSelectedQuoteCurrencyAccount","mintAddress","useSelectedBaseCurrencyAccount","useSelectedQuoteCurrencyBalances","quoteSplSizeToNumber","useSelectedBaseCurrencyBalances","baseSplSizeToNumber","useLocallyStoredFeeDiscountKey","storedFeeDiscountKey","setStoredFeeDiscountKey","useFeeDiscountKeys","findFeeDiscountKeys","feeDiscountKey","useAllOpenOrdersBalances","useMarketInfos","stringProgramId","flat","useAllOpenOrdersAccounts","loadedOpenOrdersAccounts","mintInfosConnected","marketsByAddress","openOrdersBalances","baseMintInfo","baseFree","baseTotal","quoteMintInfo","quoteFree","quoteTotal","free","total","useBalances","baseCurrencyBalances","quoteCurrencyBalances","baseExists","quoteExists","coin","sub","unsettled","useUnmigratedDeprecatedMarkets","marketsList","deps","getMarket","openOrdersList","customMarketsInfo","getMarketOrderPrice","cost","tickSizeDecimals","isBids","costAtLevel","spentCost","sendPrice","getExpectedFillPrice","sizeAtLevel","avgPrice","totalAvgPrice","useInterval","delay","savedCallback","setInterval","clearInterval","Wrapper","styled","FloatingElement","stretchVertical","SizeTitle","Row","MarkPriceTitle","Line","css","Price","smallScreen","onPrice","onSize","currentOrderbookData","lastOrderbookData","orderbookData","setOrderbookData","getCumulativeOrderbookSide","totalSize","backwards","cumulativeSize","sizePercent","reverse","sum","index","bidsToDisplay","asksToDisplay","flex","overflow","OrderbookRow","onPriceClick","onSizeClick","MarkPriceComponent","memo","element","classList","contains","remove","formattedSize","formattedPrice","ref","data-width","data-bgcolor","prevProps","nextProps","previousMarkPrice","usePrevious","markPriceColor","formattedMarkPrice","justify","ArrowUpOutlined","ArrowDownOutlined","DataTable","dataSource","columns","emptyLabel","pagination","loading","pageSize","renderEmpty","padding","justifyContent","alignItems","BalancesTable","balances","showMarket","hideWalletBalance","onSettleSuccess","dataIndex","render","ghost","onSettleFunds","CancelButton","Button","OpenOrderTable","onCancelSuccess","marketFilter","cancelId","setCancelId","orderId","marketFilters","orderInfos","text","onFilter","record","indexOf","fontWeight","charAt","toUpperCase","sorter","showSorterTooltip","DeleteOutlined","cancel","FillsTable","fills","fill","useFills","liquidity","FeesTable","feeTier","row","marginLeft","format","getFeeRates","taker","SRM_MINT","MSRM_MINT","marginTop","FeeScheduleTable","balance","Paragraph","TabPane","Tabs","Index","paddingTop","defaultActiveKey","tab","supportsSrmFeeDiscounts","OpenOrdersTab","filterForOpenOrders","useOpenOrders","BalancesTab","DepositDialog","coinMint","depositCoin","onClose","baseOrQuote","onOk","StandaloneTokenAccountsSelect","selectedValue","label","setSelectedTokenAccounts","Fragment","onSelect","newSelectedTokenAccounts","Option","Text","code","shape","CopyOutlined","navigator","clipboard","writeText","LinkAddress","shorten","LinkOutlined","cursor","RowBox","Tip","ActionButton","StandaloneBalancesDisplay","setBaseOrQuote","autoSettleEnabled","lastSettledAt","setLastSettledAt","autoSettle","now","formattedBalances","currency","borderColor","content","trigger","InfoCircleOutlined","align","paddingBottom","block","SellButton","BuyButton","sliderMarks","0","25","50","75","100","TradeForm","setChangeOrderRef","setSide","postOnly","setPostOnly","ioc","setIoc","baseSize","setBaseSize","quoteSize","setQuoteSize","setPrice","submitting","setSubmitting","sizeFraction","setSizeFraction","quoteBalance","baseBalance","sizeDecimalCount","priceDecimalCount","doChangeOrder","onSliderChange","updateSizeFraction","warmUpCache","findBestFeeDiscountKey","onSetBaseSize","usePrice","maxSize","parseFloat","newSize","formatted","onSubmit","flexDirection","Group","onChange","buttonStyle","background","addonBefore","suffix","fontSize","compact","onSetQuoteSize","tipFormatter","marks","checked","disabled","PublicTrades","getRecentTrades","useBonfidaTrades","minHeight","maxHeight","paddingRight","overflowY","time","toLocaleTimeString","DeprecatedMarketsInstructions","switchToLiveMarkets","openOrderAccountBalances","inOrdersBase","inOrdersQuote","unsettledBase","unsettledQuote","useBalancesForDeprecatedMarkets","marketsAndOrders","getOrders","loadOrdersForOwner","refreshOpenOrders","useGetOpenOrdersForDeprecatedMarkets","needToCancelOrders","filteredBalances","needToSettleFunds","CustomMarketDialog","onAddCustomMarket","marketId","setMarketId","marketLabel","setMarketLabel","setBaseLabel","setQuoteLabel","loadingMarket","setLoadingMarket","wellFormedMarketId","marketAccountInfo","resetLabels","knownMarket","knownProgram","knownBaseCurrency","knownQuoteCurrency","canSubmit","onDoClose","placeholder","LoadingOutlined","gutter","Select","OptGroup","TradePage","useParams","history","useHistory","TradePageInner","handleDeprecated","setHandleDeprecated","addMarketVisible","setAddMarketVisible","deprecatedMarkets","innerHeight","innerWidth","dimensions","setDimensions","changeOrderRef","handleResize","componentProps","onChangeOrderRef","component","customMarket","newCustomMarkets","paddingLeft","MarketSelector","onDeleteCustomMarket","PlusCircleOutlined","extractBase","extractQuote","selectedMarket","proposedMarket","showSearch","optionFilterProp","listHeight","filterOption","input","option","toLowerCase","nanoid","stopPropagation","nativeEvent","stopImmediatePropagation","DeprecatedMarketsPage","RenderNormal","flexWrap","RenderSmall","RenderSmaller","xs","sm","WalletConnect","menu","Item","overlay","OpenOrdersPage","setLoaded","setRefresh","setOpenOrders","lastRefresh","setLastRefresh","_openOrders","getOpenOrdersForMarket","getAllOpenOrders","prev","useAllOpenOrders","marketAddressesToNames","WalletBalancesTable","walletBalances","tokenAccountsConnected","allMarketsConnected","settlingFunds","setSettlingFunds","walletBalance","BalancesPage","parsedAccount","mintInfo","additionalAmount","useWalletBalancesForAllMarkets","mintToTickers","openOrdersFree","openOrdersTotal","ConvertButton","ConvertForm","fromToken","setFromToken","toToken","setToToken","setSize","marketInfosbyName","tokenConvertMap","base","quote","maxWidth","minWidth","ConvertFormSubmit","fromAmount","setFromAmount","toAmount","setToAmount","isConverting","setIsConverting","isFromTokenBaseOfMarket","onConvert","sidedOrderbookAccount","decodedOrderbookData","parsedPrice","parsedSize","getPrice","expectedPrice","canConvert","coinBalance","availableBalance","SwapOutlined","ConvertPage","PreferencesContext","PreferencesProvider","setAutoSettleEnabled","marketInfoList","currentlyFetchingMarkets","setCurrentlyFetchingMarkets","setMarkets","addToMarketsMap","fetchMarkets","Settings","usePreferences","CustomClusterEndpointDialog","testingConnection","onAddCustomEndpoint","customEndpoint","setCustomEndpoint","customEndpointName","setCustomEndpointName","appsAndTokens","apps","tags","AppSearch","searchMatches","setSearchMatches","searchValue","setSearchValue","handleClear","options","d","replace","allowClear","focussed","onSearch","filteredApps","app","searchString","lowerSearchStr","tag","matchApp","onClear","onFocus","onBlur","notFoundContent","transition","dropdownStyle","dropdownMatchSelectWidth","suffixIcon","SearchOutlined","focus","LogoWrapper","EXTERNAL_LINKS","TopBar","addEndpointVisible","setAddEndpointVisible","setTestingConnection","location","useLocation","searchFocussed","setSearchFocussed","handleClick","endpointInfoCustom","handler","tradePageUrl","pathname","handleError","getEpochInfo","newCustomEndpoints","logo","mode","selectedKeys","borderBottom","margin","SettingOutlined","helpUrls","Footer","Layout","useBreakpoint","Grid","footerElements","link","CustomFooter","lg","elem","Header","Content","BasicLayout","useMintInput","tooltip","setAddress","ticker","validateStatus","hasFeedback","help","parsed","ListNewMarketPage","baseMintInput","quoteMintInput","lotSize","setLotSize","setTickSize","listedMarket","setListedMarket","labelCol","wrapperCol","layout","onFinish","initialValue","trim","colon","htmlType","AddRemoveTokenButtons","SIMPLE_POOL_PROGRAM_ID","DEFAULT_PROGRAM_ID","PROGRAM_ID_OPTIONS","NewPoolPage","poolName","setPoolName","setProgramId","initialSupply","setInitialSupply","valid","initialAssets","setInitialAssets","adminControlled","setAdminControlled","adminAddress","setAdminAddress","newPoolAddress","setNewPoolAddress","asset","assets","PoolTransactions","initializeSimplePool","poolStateSpace","poolMintDecimals","initialPoolMintSupply","assetMints","initialAssetQuantities","quantity","creator","creatorAssets","found","tokenAccount","additionalAccounts","isSigner","isWritable","poolAddress","AssetInput","mintInput","setQuantity","parsedQuantity","old","MintName","showAddress","mintKey","PoolBasketDisplay","poolInfo","basket","BasketItem","quantities","mintAccountInfo","quantityDisplay","feeFormat","PoolInfoPanel","getPoolBasket","redeem","totalBasket","copyable","poolTokenMint","adminKey","feeRate","PoolCreateRedeemPanel","CreateRedeemTab","action","basketLoaded","findTokenAccount","preventDefault","execute","poolTokenAccount","assetAccounts","PoolBalancesPanel","WalletBalancesTab","PoolBalancesTab","BalanceItem","isPoolToken","vaultAddress","balanceAccountInfo","PoolAdminPanel","PauseUnpauseTab","AddAssetTab","RemoveAssetTab","DepositTab","WithdrawTab","UpdateFeeTab","AdminControlledPoolInstructions","pause","unpause","useOnSubmitHandler","getAssociatedTokenAddress","vaultSigner","createAssociatedTokenAccount","addAsset","MintSelector","SubmitButton","removeAsset","MintInPoolSelector","walletTokenAccount","mintDecimals","wrappedSolAccount","transfer","source","destination","closeAccount","approveDelegate","setFeeRate","updateFee","makeTransaction","className","PoolPage","isPublicKey","poolAccountInfo","poolAccountLoaded","decodePoolState","program","mintAccountInfoLoaded","onBack","subTitle","isAdminControlledPool","Form","form","PoolListPage","setPoolAddress","Routes","basename","exact","App","fallback","Boolean","hostname","match","ReactDOM","StrictMode","getElementById","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.2b2ee684.chunk.js","sourcesContent":["import type Transport from '@ledgerhq/hw-transport';\r\nimport type { Transaction } from '@solana/web3.js';\r\n\r\nimport { PublicKey } from '@solana/web3.js';\r\n\r\nconst INS_GET_PUBKEY = 0x05;\r\nconst INS_SIGN_MESSAGE = 0x06;\r\n\r\nconst P1_NON_CONFIRM = 0x00;\r\nconst P1_CONFIRM = 0x01;\r\n\r\nconst P2_EXTEND = 0x01;\r\nconst P2_MORE = 0x02;\r\n\r\nconst MAX_PAYLOAD = 255;\r\n\r\nconst LEDGER_CLA = 0xe0;\r\n\r\n/*\r\n * Helper for chunked send of large payloads\r\n */\r\nasync function ledgerSend(\r\n  transport: Transport,\r\n  instruction: number,\r\n  p1: number,\r\n  payload: Buffer,\r\n) {\r\n  let p2 = 0;\r\n  let payloadOffset = 0;\r\n\r\n  if (payload.length > MAX_PAYLOAD) {\r\n    while (payload.length - payloadOffset > MAX_PAYLOAD) {\r\n      const chunk = payload.slice(payloadOffset, payloadOffset + MAX_PAYLOAD);\r\n      payloadOffset += MAX_PAYLOAD;\r\n      console.log(\r\n        'send',\r\n        (p2 | P2_MORE).toString(16),\r\n        chunk.length.toString(16),\r\n        chunk,\r\n      );\r\n      const reply = await transport.send(\r\n        LEDGER_CLA,\r\n        instruction,\r\n        p1,\r\n        p2 | P2_MORE,\r\n        chunk,\r\n      );\r\n      if (reply.length !== 2) {\r\n        throw new Error('Received unexpected reply payload');\r\n      }\r\n      p2 |= P2_EXTEND;\r\n    }\r\n  }\r\n\r\n  const chunk = payload.slice(payloadOffset);\r\n  console.log('send', p2.toString(16), chunk.length.toString(16), chunk);\r\n  const reply = await transport.send(LEDGER_CLA, instruction, p1, p2, chunk);\r\n\r\n  return reply.slice(0, reply.length - 2);\r\n}\r\n\r\nconst BIP32_HARDENED_BIT = (1 << 31) >>> 0;\r\nfunction harden(n: number = 0) {\r\n  return (n | BIP32_HARDENED_BIT) >>> 0;\r\n}\r\n\r\nexport function getSolanaDerivationPath(account?: number, change?: number) {\r\n  var length;\r\n  if (account !== undefined) {\r\n    if (change !== undefined) {\r\n      length = 4;\r\n    } else {\r\n      length = 3;\r\n    }\r\n  } else {\r\n    length = 2;\r\n  }\r\n\r\n  var derivationPath = Buffer.alloc(1 + length * 4);\r\n  // eslint-disable-next-line\r\n  var offset = 0;\r\n  offset = derivationPath.writeUInt8(length, offset);\r\n  offset = derivationPath.writeUInt32BE(harden(44), offset); // Using BIP44\r\n  offset = derivationPath.writeUInt32BE(harden(501), offset); // Solana's BIP44 path\r\n\r\n  if (length > 2) {\r\n    offset = derivationPath.writeUInt32BE(harden(account), offset);\r\n    if (length === 4) {\r\n      // @FIXME: https://github.com/project-serum/spl-token-wallet/issues/59\r\n      offset = derivationPath.writeUInt32BE(harden(change), offset);\r\n    }\r\n  }\r\n\r\n  return derivationPath;\r\n}\r\n\r\nexport async function signTransaction(\r\n  transport: Transport,\r\n  transaction: Transaction,\r\n  derivationPath: Buffer = getSolanaDerivationPath(),\r\n) {\r\n  const messageBytes = transaction.serializeMessage();\r\n  return signBytes(transport, messageBytes, derivationPath);\r\n}\r\n\r\nexport async function signBytes(\r\n  transport: Transport,\r\n  bytes: Buffer,\r\n  derivationPath: Buffer = getSolanaDerivationPath(),\r\n) {\r\n  const numPaths = Buffer.alloc(1);\r\n  numPaths.writeUInt8(1, 0);\r\n\r\n  const payload = Buffer.concat([numPaths, derivationPath, bytes]);\r\n\r\n  // @FIXME: must enable blind signing in Solana Ledger App per https://github.com/project-serum/spl-token-wallet/issues/71\r\n  // See also https://github.com/project-serum/spl-token-wallet/pull/23#issuecomment-712317053\r\n  return ledgerSend(transport, INS_SIGN_MESSAGE, P1_CONFIRM, payload);\r\n}\r\n\r\nexport async function getPublicKey(\r\n  transport: Transport,\r\n  derivationPath: Buffer = getSolanaDerivationPath(),\r\n) {\r\n  const publicKeyBytes = await ledgerSend(\r\n    transport,\r\n    INS_GET_PUBKEY,\r\n    P1_NON_CONFIRM,\r\n    derivationPath,\r\n  );\r\n\r\n  return new PublicKey(publicKeyBytes);\r\n}\r\n","module.exports = __webpack_public_path__ + \"static/media/logo.d0dcc5a4.svg\";","import { useCallback, useEffect, useMemo, useState } from 'react';\r\nimport { PublicKey } from '@solana/web3.js';\r\nimport BN from 'bn.js';\r\n\r\nexport function isValidPublicKey(key) {\r\n  if (!key) {\r\n    return false;\r\n  }\r\n  try {\r\n    new PublicKey(key);\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function sleep(ms) {\r\n  return new Promise((resolve) => setTimeout(resolve, ms));\r\n}\r\n\r\nexport const percentFormat = new Intl.NumberFormat(undefined, {\r\n  style: 'percent',\r\n  minimumFractionDigits: 2,\r\n  maximumFractionDigits: 2,\r\n});\r\n\r\nexport function floorToDecimal(\r\n  value: number,\r\n  decimals: number | undefined | null,\r\n) {\r\n  return decimals\r\n    ? Math.floor(value * 10 ** decimals) / 10 ** decimals\r\n    : Math.floor(value);\r\n}\r\n\r\nexport function roundToDecimal(\r\n  value: number,\r\n  decimals: number | undefined | null,\r\n) {\r\n  return decimals ? Math.round(value * 10 ** decimals) / 10 ** decimals : value;\r\n}\r\n\r\nexport function getDecimalCount(value): number {\r\n  if (\r\n    !isNaN(value) &&\r\n    Math.floor(value) !== value &&\r\n    value.toString().includes('.')\r\n  )\r\n    return value.toString().split('.')[1].length || 0;\r\n  if (\r\n    !isNaN(value) &&\r\n    Math.floor(value) !== value &&\r\n    value.toString().includes('e')\r\n  )\r\n    return parseInt(value.toString().split('e-')[1] || '0');\r\n  return 0;\r\n}\r\n\r\nexport function divideBnToNumber(numerator: BN, denominator: BN): number {\r\n  const quotient = numerator.div(denominator).toNumber();\r\n  const rem = numerator.umod(denominator);\r\n  const gcd = rem.gcd(denominator);\r\n  return quotient + rem.div(gcd).toNumber() / denominator.div(gcd).toNumber();\r\n}\r\n\r\nexport function getTokenMultiplierFromDecimals(decimals: number): BN {\r\n  return new BN(10).pow(new BN(decimals));\r\n}\r\n\r\nconst localStorageListeners = {};\r\n\r\nexport function useLocalStorageStringState(\r\n  key: string,\r\n  defaultState: string | null = null,\r\n): [string | null, (newState: string | null) => void] {\r\n  const state = localStorage.getItem(key) || defaultState;\r\n\r\n  const [, notify] = useState(key + '\\n' + state);\r\n\r\n  useEffect(() => {\r\n    if (!localStorageListeners[key]) {\r\n      localStorageListeners[key] = [];\r\n    }\r\n    localStorageListeners[key].push(notify);\r\n    return () => {\r\n      localStorageListeners[key] = localStorageListeners[key].filter(\r\n        (listener) => listener !== notify,\r\n      );\r\n      if (localStorageListeners[key].length === 0) {\r\n        delete localStorageListeners[key];\r\n      }\r\n    };\r\n  }, [key]);\r\n\r\n  const setState = useCallback<(newState: string | null) => void>(\r\n    (newState) => {\r\n      const changed = state !== newState;\r\n      if (!changed) {\r\n        return;\r\n      }\r\n\r\n      if (newState === null) {\r\n        localStorage.removeItem(key);\r\n      } else {\r\n        localStorage.setItem(key, newState);\r\n      }\r\n      localStorageListeners[key].forEach((listener) =>\r\n        listener(key + '\\n' + newState),\r\n      );\r\n    },\r\n    [state, key],\r\n  );\r\n\r\n  return [state, setState];\r\n}\r\n\r\nexport function useLocalStorageState<T = any>(\r\n  key: string,\r\n  defaultState: T | null = null,\r\n): [T, (newState: T) => void] {\r\n  let [stringState, setStringState] = useLocalStorageStringState(\r\n    key,\r\n    JSON.stringify(defaultState),\r\n  );\r\n  return [\r\n    useMemo(() => stringState && JSON.parse(stringState), [stringState]),\r\n    (newState) => setStringState(JSON.stringify(newState)),\r\n  ];\r\n}\r\n\r\nexport function useEffectAfterTimeout(effect, timeout) {\r\n  useEffect(() => {\r\n    const handle = setTimeout(effect, timeout);\r\n    return () => clearTimeout(handle);\r\n  });\r\n}\r\n\r\nexport function useListener(emitter, eventName) {\r\n  const [, forceUpdate] = useState(0);\r\n  useEffect(() => {\r\n    const listener = () => forceUpdate((i) => i + 1);\r\n    emitter.on(eventName, listener);\r\n    return () => emitter.removeListener(eventName, listener);\r\n  }, [emitter, eventName]);\r\n}\r\n\r\nexport function abbreviateAddress(address: PublicKey, size = 4) {\r\n  const base58 = address.toBase58();\r\n  return base58.slice(0, size) + '…' + base58.slice(-size);\r\n}\r\n\r\nexport function isEqual(obj1, obj2, keys) {\r\n  if (!keys && Object.keys(obj1).length !== Object.keys(obj2).length) {\r\n    return false;\r\n  }\r\n  keys = keys || Object.keys(obj1);\r\n  for (const k of keys) {\r\n    if (obj1[k] !== obj2[k]) {\r\n      // shallow comparison\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n","import { useEffect, useReducer } from 'react';\r\n\r\nimport assert from 'assert';\r\n\r\nconst pageLoadTime = new Date();\r\n\r\nconst globalCache: Map<any, any> = new Map();\r\n\r\nclass FetchLoopListener<T = any> {\r\n  cacheKey: any;\r\n  fn: () => Promise<T>;\r\n  refreshInterval: number;\r\n  refreshIntervalOnError: number | null;\r\n  callback: () => void;\r\n  cacheNullValues: Boolean = true;\r\n\r\n  constructor(\r\n    cacheKey: any,\r\n    fn: () => Promise<T>,\r\n    refreshInterval: number,\r\n    refreshIntervalOnError: number | null,\r\n    callback: () => void,\r\n    cacheNullValues: Boolean,\r\n  ) {\r\n    this.cacheKey = cacheKey;\r\n    this.fn = fn;\r\n    this.refreshInterval = refreshInterval;\r\n    this.refreshIntervalOnError = refreshIntervalOnError;\r\n    this.callback = callback;\r\n    this.cacheNullValues = cacheNullValues;\r\n  }\r\n}\r\n\r\nclass FetchLoopInternal<T = any> {\r\n  cacheKey: any;\r\n  fn: () => Promise<T>;\r\n  timeoutId: null | any;\r\n  listeners: Set<FetchLoopListener<T>>;\r\n  errors: number;\r\n  cacheNullValues: Boolean = true;\r\n\r\n  constructor(cacheKey: any, fn: () => Promise<T>, cacheNullValues: Boolean) {\r\n    this.cacheKey = cacheKey;\r\n    this.fn = fn;\r\n    this.timeoutId = null;\r\n    this.listeners = new Set();\r\n    this.errors = 0;\r\n    this.cacheNullValues = cacheNullValues;\r\n  }\r\n\r\n  get refreshInterval(): number {\r\n    return Math.min(\r\n      ...[...this.listeners].map((listener) => listener.refreshInterval),\r\n    );\r\n  }\r\n\r\n  get refreshIntervalOnError(): number | null {\r\n    const refreshIntervalsOnError: number[] = [...this.listeners]\r\n      .map((listener) => listener.refreshIntervalOnError)\r\n      .filter((x): x is number => x !== null);\r\n    if (refreshIntervalsOnError.length === 0) {\r\n      return null;\r\n    }\r\n    return Math.min(...refreshIntervalsOnError);\r\n  }\r\n\r\n  get stopped(): boolean {\r\n    return this.listeners.size === 0;\r\n  }\r\n\r\n  addListener(listener: FetchLoopListener<T>): void {\r\n    const previousRefreshInterval = this.refreshInterval;\r\n    this.listeners.add(listener);\r\n    if (this.refreshInterval < previousRefreshInterval) {\r\n      this.refresh();\r\n    }\r\n  }\r\n\r\n  removeListener(listener: FetchLoopListener<T>): void {\r\n    assert(this.listeners.delete(listener));\r\n    if (this.stopped) {\r\n      if (this.timeoutId) {\r\n        clearTimeout(this.timeoutId);\r\n        this.timeoutId = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  notifyListeners(): void {\r\n    this.listeners.forEach((listener) => listener.callback());\r\n  }\r\n\r\n  refresh = async () => {\r\n    if (this.timeoutId) {\r\n      clearTimeout(this.timeoutId);\r\n      this.timeoutId = null;\r\n    }\r\n    if (this.stopped) {\r\n      return;\r\n    }\r\n\r\n    let errored = false;\r\n    try {\r\n      const data = await this.fn();\r\n      if (!this.cacheNullValues && data === null) {\r\n        console.log(`Not caching null value for ${this.cacheKey}`);\r\n        // cached data has not changed so no need to re-render\r\n        this.errors = 0;\r\n        return data;\r\n      } else {\r\n        globalCache.set(this.cacheKey, data);\r\n        this.errors = 0;\r\n        this.notifyListeners();\r\n        return data;\r\n      }\r\n    } catch (error) {\r\n      ++this.errors;\r\n      console.warn(error);\r\n      errored = true;\r\n    } finally {\r\n      if (!this.timeoutId && !this.stopped) {\r\n        let waitTime = this.refreshInterval;\r\n        if (\r\n          errored &&\r\n          this.refreshIntervalOnError &&\r\n          this.refreshIntervalOnError > 0\r\n        ) {\r\n          waitTime = this.refreshIntervalOnError;\r\n        }\r\n\r\n        // Back off on errors.\r\n        if (this.errors > 0) {\r\n          waitTime = Math.min(1000 * 2 ** (this.errors - 1), 60000);\r\n        }\r\n\r\n        // Don't do any refreshing for the first five seconds, to make way for other things to load.\r\n        const timeSincePageLoad = +new Date() - +pageLoadTime;\r\n        if (timeSincePageLoad < 5000) {\r\n          waitTime += 5000 - timeSincePageLoad / 2;\r\n        }\r\n\r\n        // Refresh background pages slowly.\r\n        if (document.visibilityState === 'hidden') {\r\n          waitTime = 60000;\r\n        } else if (!document.hasFocus()) {\r\n          waitTime *= 1.5;\r\n        }\r\n\r\n        // Add jitter so we don't send all requests at the same time.\r\n        waitTime *= 0.8 + 0.4 * Math.random();\r\n\r\n        this.timeoutId = setTimeout(this.refresh, waitTime);\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\nclass FetchLoops {\r\n  loops = new Map();\r\n\r\n  addListener<T>(listener: FetchLoopListener<T>) {\r\n    if (!this.loops.has(listener.cacheKey)) {\r\n      this.loops.set(\r\n        listener.cacheKey,\r\n        new FetchLoopInternal<T>(\r\n          listener.cacheKey,\r\n          listener.fn,\r\n          listener.cacheNullValues,\r\n        ),\r\n      );\r\n    }\r\n    this.loops.get(listener.cacheKey).addListener(listener);\r\n  }\r\n\r\n  removeListener<T>(listener: FetchLoopListener<T>) {\r\n    const loop = this.loops.get(listener.cacheKey);\r\n    loop.removeListener(listener);\r\n    if (loop.stopped) {\r\n      this.loops.delete(listener.cacheKey);\r\n      globalCache.delete(listener.cacheKey);\r\n    }\r\n  }\r\n\r\n  refresh(cacheKey) {\r\n    if (this.loops.has(cacheKey)) {\r\n      this.loops.get(cacheKey).refresh();\r\n    }\r\n  }\r\n\r\n  refreshAll() {\r\n    return Promise.all([...this.loops.values()].map((loop) => loop.refresh()));\r\n  }\r\n}\r\nconst globalLoops = new FetchLoops();\r\n\r\nexport function useAsyncData<T = any>(\r\n  asyncFn: () => Promise<T>,\r\n  cacheKey: any,\r\n  { refreshInterval = 60000, refreshIntervalOnError = null } = {},\r\n  cacheNullValues: Boolean = true,\r\n): [null | undefined | T, boolean] {\r\n  const [, rerender] = useReducer((i) => i + 1, 0);\r\n\r\n  useEffect(() => {\r\n    if (!cacheKey) {\r\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n      return () => {};\r\n    }\r\n    const listener = new FetchLoopListener<T>(\r\n      cacheKey,\r\n      asyncFn,\r\n      refreshInterval,\r\n      refreshIntervalOnError,\r\n      rerender,\r\n      cacheNullValues,\r\n    );\r\n    globalLoops.addListener(listener);\r\n    return () => globalLoops.removeListener(listener);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [cacheKey, refreshInterval]);\r\n\r\n  if (!cacheKey) {\r\n    return [null, false];\r\n  }\r\n\r\n  const loaded = globalCache.has(cacheKey);\r\n  const data = loaded ? globalCache.get(cacheKey) : undefined;\r\n  return [data, loaded];\r\n}\r\n\r\nexport function refreshCache(cacheKey: any, clearCache = false): void {\r\n  if (clearCache) {\r\n    globalCache.delete(cacheKey);\r\n  }\r\n  const loop = globalLoops.loops.get(cacheKey);\r\n  if (loop) {\r\n    loop.refresh();\r\n    if (clearCache) {\r\n      loop.notifyListeners();\r\n    }\r\n  }\r\n}\r\n\r\nexport function refreshAllCaches(): void {\r\n  for (const loop of globalLoops.loops.values()) {\r\n    loop.refresh();\r\n  }\r\n}\r\n\r\nexport function setCache(\r\n  cacheKey: any,\r\n  value: any,\r\n  { initializeOnly = false } = {},\r\n): void {\r\n  if (initializeOnly && globalCache.has(cacheKey)) {\r\n    return;\r\n  }\r\n  globalCache.set(cacheKey, value);\r\n  const loop = globalLoops.loops.get(cacheKey);\r\n  if (loop) {\r\n    loop.notifyListeners();\r\n  }\r\n}\r\n\r\nexport function getCache(\r\n  cacheKey: any\r\n) {\r\n  return globalCache.get(cacheKey);\r\n}\r\n","import { useLocalStorageState } from './utils';\r\nimport { Account, AccountInfo, Connection, PublicKey } from '@solana/web3.js';\r\nimport React, { useContext, useEffect, useMemo, useRef } from 'react';\r\nimport { setCache, useAsyncData } from './fetch-loop';\r\nimport tuple from 'immutable-tuple';\r\nimport { ConnectionContextValues, EndpointInfo } from './types';\r\n\r\nexport const ENDPOINTS: EndpointInfo[] = [\r\n  {\r\n    name: 'mainnet-beta',\r\n    endpoint: 'https://solana-api.projectserum.com',\r\n    custom: false,\r\n  },\r\n  {\r\n    name: 'mainnet-beta (alt)',\r\n    endpoint: 'https://api.mainnet-beta.solana.com',\r\n    custom: false,\r\n  }\r\n];\r\n\r\nconst accountListenerCount = new Map();\r\n\r\nconst ConnectionContext: React.Context<null | ConnectionContextValues> = React.createContext<null | ConnectionContextValues>(\r\n  null,\r\n);\r\n\r\nexport function ConnectionProvider({ children }) {\r\n  const [endpoint, setEndpoint] = useLocalStorageState<string>(\r\n    'connectionEndpts',\r\n    ENDPOINTS[0].endpoint,\r\n  );\r\n  const [customEndpoints, setCustomEndpoints] = useLocalStorageState<\r\n    EndpointInfo[]\r\n  >('customConnectionEndpoints', []);\r\n  const availableEndpoints = ENDPOINTS.concat(customEndpoints);\r\n\r\n  const connection = useMemo(() => new Connection(endpoint, 'recent'), [\r\n    endpoint,\r\n  ]);\r\n  const sendConnection = useMemo(() => new Connection(endpoint, 'recent'), [\r\n    endpoint,\r\n  ]);\r\n\r\n  // The websocket library solana/web3.js uses closes its websocket connection when the subscription list\r\n  // is empty after opening its first time, preventing subsequent subscriptions from receiving responses.\r\n  // This is a hack to prevent the list from every getting empty\r\n  useEffect(() => {\r\n    const id = connection.onAccountChange(new Account().publicKey, () => {});\r\n    return () => {\r\n      connection.removeAccountChangeListener(id);\r\n    };\r\n  }, [connection]);\r\n\r\n  useEffect(() => {\r\n    const id = connection.onSlotChange(() => null);\r\n    return () => {\r\n      connection.removeSlotChangeListener(id);\r\n    };\r\n  }, [connection]);\r\n\r\n  useEffect(() => {\r\n    const id = sendConnection.onAccountChange(\r\n      new Account().publicKey,\r\n      () => {},\r\n    );\r\n    return () => {\r\n      sendConnection.removeAccountChangeListener(id);\r\n    };\r\n  }, [sendConnection]);\r\n\r\n  useEffect(() => {\r\n    const id = sendConnection.onSlotChange(() => null);\r\n    return () => {\r\n      sendConnection.removeSlotChangeListener(id);\r\n    };\r\n  }, [sendConnection]);\r\n\r\n  return (\r\n    <ConnectionContext.Provider\r\n      value={{\r\n        endpoint,\r\n        setEndpoint,\r\n        connection,\r\n        sendConnection,\r\n        availableEndpoints,\r\n        setCustomEndpoints,\r\n      }}\r\n    >\r\n      {children}\r\n    </ConnectionContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useConnection() {\r\n  const context = useContext(ConnectionContext);\r\n  if (!context) {\r\n    throw new Error('Missing connection context');\r\n  }\r\n  return context.connection;\r\n}\r\n\r\nexport function useSendConnection() {\r\n  const context = useContext(ConnectionContext);\r\n  if (!context) {\r\n    throw new Error('Missing connection context');\r\n  }\r\n  return context.sendConnection;\r\n}\r\n\r\nexport function useConnectionConfig() {\r\n  const context = useContext(ConnectionContext);\r\n  if (!context) {\r\n    throw new Error('Missing connection context');\r\n  }\r\n  return {\r\n    endpoint: context.endpoint,\r\n    endpointInfo: context.availableEndpoints.find(\r\n      (info) => info.endpoint === context.endpoint,\r\n    ),\r\n    setEndpoint: context.setEndpoint,\r\n    availableEndpoints: context.availableEndpoints,\r\n    setCustomEndpoints: context.setCustomEndpoints,\r\n  };\r\n}\r\n\r\nexport function useAccountInfo(\r\n  publicKey: PublicKey | undefined | null,\r\n): [AccountInfo<Buffer> | null | undefined, boolean] {\r\n  const connection = useConnection();\r\n  const cacheKey = tuple(connection, publicKey?.toBase58());\r\n  const [accountInfo, loaded] = useAsyncData<AccountInfo<Buffer> | null>(\r\n    async () => (publicKey ? connection.getAccountInfo(publicKey) : null),\r\n    cacheKey,\r\n    { refreshInterval: 60_000 },\r\n  );\r\n  useEffect(() => {\r\n    if (!publicKey) {\r\n      return;\r\n    }\r\n    if (accountListenerCount.has(cacheKey)) {\r\n      let currentItem = accountListenerCount.get(cacheKey);\r\n      ++currentItem.count;\r\n    } else {\r\n      let previousInfo: AccountInfo<Buffer> | null = null;\r\n      const subscriptionId = connection.onAccountChange(publicKey, (info) => {\r\n        if (\r\n          !previousInfo ||\r\n          !previousInfo.data.equals(info.data) ||\r\n          previousInfo.lamports !== info.lamports\r\n        ) {\r\n          previousInfo = info;\r\n          setCache(cacheKey, info);\r\n        }\r\n      });\r\n      accountListenerCount.set(cacheKey, { count: 1, subscriptionId });\r\n    }\r\n    return () => {\r\n      let currentItem = accountListenerCount.get(cacheKey);\r\n      let nextCount = currentItem.count - 1;\r\n      if (nextCount <= 0) {\r\n        connection.removeAccountChangeListener(currentItem.subscriptionId);\r\n        accountListenerCount.delete(cacheKey);\r\n      } else {\r\n        --currentItem.count;\r\n      }\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [cacheKey]);\r\n  const previousInfoRef = useRef<AccountInfo<Buffer> | null | undefined>(null);\r\n  if (\r\n    !accountInfo ||\r\n    !previousInfoRef.current ||\r\n    !previousInfoRef.current.data.equals(accountInfo.data) ||\r\n    previousInfoRef.current.lamports !== accountInfo.lamports\r\n  ) {\r\n    previousInfoRef.current = accountInfo;\r\n  }\r\n  return [previousInfoRef.current, loaded];\r\n}\r\n\r\nexport function useAccountData(publicKey) {\r\n  const [accountInfo] = useAccountInfo(publicKey);\r\n  return accountInfo && accountInfo.data;\r\n}\r\n","import React from 'react';\r\nimport { Link as RouterLink } from 'react-router-dom';\r\n\r\nexport default function Link({ external = false, ...props }) {\r\n  let { to, children, ...rest } = props;\r\n  if (external) {\r\n    return (\r\n      <a href={to} target=\"_blank\" rel=\"noopener noreferrer\" {...rest}>\r\n        {children}\r\n      </a>\r\n    );\r\n  }\r\n  return (\r\n    <RouterLink to={to} {...rest}>\r\n      {children}\r\n    </RouterLink>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { notification } from 'antd';\r\nimport Link from '../components/Link';\r\n\r\nexport function notify({\r\n  message,\r\n  description,\r\n  txid,\r\n  type = 'info',\r\n  placement = 'bottomLeft',\r\n}: {\r\n  message: string;\r\n  description?: string | JSX.Element;\r\n  txid?: string;\r\n  type?: string;\r\n  placement?: string;\r\n}) {\r\n  if (txid) {\r\n    description = (\r\n      <Link\r\n        external\r\n        to={'https://explorer.solana.com/tx/' + txid}\r\n        style={{ color: '#0000ff' }}\r\n      >\r\n        View transaction {txid.slice(0, 8)}...{txid.slice(txid.length - 8)}\r\n      </Link>\r\n    );\r\n  }\r\n  notification[type]({\r\n    message: <span style={{ color: 'black' }}>{message}</span>,\r\n    description: (\r\n      <span style={{ color: 'black', opacity: 0.5 }}>{description}</span>\r\n    ),\r\n    placement,\r\n    style: {\r\n      backgroundColor: 'white',\r\n    },\r\n  });\r\n}\r\n","import { PublicKey, Transaction } from '@solana/web3.js';\r\n\r\nexport const DEFAULT_PUBLIC_KEY = new PublicKey(\r\n  '11111111111111111111111111111111',\r\n);\r\n\r\nexport interface WalletAdapter {\r\n  publicKey: PublicKey;\r\n  autoApprove: boolean;\r\n  connected: boolean;\r\n  signTransaction: (transaction: Transaction) => Promise<Transaction>;\r\n  signAllTransactions: (transaction: Transaction[]) => Promise<Transaction[]>;\r\n  connect: () => any;\r\n  disconnect: () => any;\r\n  on<T>(event: string, fn: () => void): this;\r\n}\r\n","import type Transport from '@ledgerhq/hw-transport';\r\nimport type { Transaction } from '@solana/web3.js';\r\n\r\nimport EventEmitter from 'eventemitter3';\r\nimport { PublicKey } from '@solana/web3.js';\r\nimport TransportWebUSB from '@ledgerhq/hw-transport-webusb';\r\nimport { notify } from '../../utils/notifications';\r\nimport { getPublicKey, signTransaction } from './core';\r\nimport { DEFAULT_PUBLIC_KEY, WalletAdapter } from '../types';\r\n\r\nexport class LedgerWalletAdapter extends EventEmitter implements WalletAdapter {\r\n  _connecting: boolean;\r\n  _publicKey: PublicKey | null;\r\n  _transport: Transport | null;\r\n\r\n  constructor() {\r\n    super();\r\n    this._connecting = false;\r\n    this._publicKey = null;\r\n    this._transport = null;\r\n  }\r\n\r\n  get publicKey() {\r\n    return this._publicKey || DEFAULT_PUBLIC_KEY;\r\n  }\r\n\r\n  get connected() {\r\n    return this._publicKey !== null;\r\n  }\r\n\r\n  get autoApprove() {\r\n    return false;\r\n  }\r\n\r\n  public async signAllTransactions(\r\n    transactions: Transaction[],\r\n  ): Promise<Transaction[]> {\r\n    const result: Transaction[] = [];\r\n    for (let i = 0; i < transactions.length; i++) {\r\n      const transaction = transactions[i];\r\n      const signed = await this.signTransaction(transaction);\r\n      result.push(signed);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  async signTransaction(transaction: Transaction) {\r\n    if (!this._transport || !this._publicKey) {\r\n      throw new Error('Not connected to Ledger');\r\n    }\r\n\r\n    // @TODO: account selection (derivation path changes with account)\r\n    const signature = await signTransaction(this._transport, transaction);\r\n\r\n    transaction.addSignature(this._publicKey, signature);\r\n\r\n    return transaction;\r\n  }\r\n\r\n  async connect() {\r\n    if (this._connecting) {\r\n      return;\r\n    }\r\n\r\n    this._connecting = true;\r\n\r\n    try {\r\n      // @TODO: transport selection (WebUSB, WebHID, bluetooth, ...)\r\n      this._transport = await TransportWebUSB.create();\r\n      // @TODO: account selection\r\n      this._publicKey = await getPublicKey(this._transport);\r\n      this.emit('connect', this._publicKey);\r\n    } catch (error) {\r\n      notify({\r\n        message: 'Ledger Error',\r\n        description: error.message,\r\n      });\r\n      await this.disconnect();\r\n    } finally {\r\n      this._connecting = false;\r\n    }\r\n  }\r\n\r\n  async disconnect() {\r\n    let emit = false;\r\n    if (this._transport) {\r\n      await this._transport.close();\r\n      this._transport = null;\r\n      emit = true;\r\n    }\r\n\r\n    this._connecting = false;\r\n    this._publicKey = null;\r\n\r\n    if (emit) {\r\n      this.emit('disconnect');\r\n    }\r\n  }\r\n}\r\n","import EventEmitter from 'eventemitter3';\r\nimport { PublicKey, Transaction } from '@solana/web3.js';\r\nimport { notify } from '../../utils/notifications';\r\nimport { DEFAULT_PUBLIC_KEY, WalletAdapter } from '../types';\r\n\r\nexport class SolongWalletAdapter extends EventEmitter implements WalletAdapter {\r\n  _publicKey?: PublicKey;\r\n  _onProcess: boolean;\r\n  _connected: boolean;\r\n  constructor() {\r\n    super();\r\n    this._onProcess = false;\r\n    this._connected = false;\r\n    this.connect = this.connect.bind(this);\r\n  }\r\n\r\n  get connected() {\r\n    return this._connected;\r\n  }\r\n\r\n  get autoApprove() {\r\n    return false;\r\n  }\r\n\r\n  public async signAllTransactions(\r\n    transactions: Transaction[],\r\n  ): Promise<Transaction[]> {\r\n    const solong = (window as any).solong;\r\n    if (solong.signAllTransactions) {\r\n      return solong.signAllTransactions(transactions);\r\n    } else {\r\n      const result: Transaction[] = [];\r\n      for (let i = 0; i < transactions.length; i++) {\r\n        const transaction = transactions[i];\r\n        const signed = await solong.signTransaction(transaction);\r\n        result.push(signed);\r\n      }\r\n\r\n      return result;\r\n    }\r\n  }\r\n\r\n  get publicKey() {\r\n    return this._publicKey || DEFAULT_PUBLIC_KEY;\r\n  }\r\n\r\n  async signTransaction(transaction: Transaction) {\r\n    return (window as any).solong.signTransaction(transaction);\r\n  }\r\n\r\n  connect() {\r\n    if (this._onProcess) {\r\n      return;\r\n    }\r\n\r\n    if ((window as any).solong === undefined) {\r\n      notify({\r\n        message: 'Solong Error',\r\n        description: 'Please install solong wallet from Chrome ',\r\n      });\r\n      return;\r\n    }\r\n\r\n    this._onProcess = true;\r\n    (window as any).solong\r\n      .selectAccount()\r\n      .then((account: any) => {\r\n        this._publicKey = new PublicKey(account);\r\n        this._connected = true;\r\n        this.emit('connect', this._publicKey);\r\n      })\r\n      .catch(() => {\r\n        this.disconnect();\r\n      })\r\n      .finally(() => {\r\n        this._onProcess = false;\r\n      });\r\n  }\r\n\r\n  disconnect() {\r\n    if (this._publicKey) {\r\n      this._publicKey = undefined;\r\n      this._connected = false;\r\n      this.emit('disconnect');\r\n    }\r\n  }\r\n}\r\n","import EventEmitter from 'eventemitter3';\r\nimport { PublicKey, Transaction } from '@solana/web3.js';\r\nimport { notify } from '../../utils/notifications';\r\nimport { DEFAULT_PUBLIC_KEY, WalletAdapter } from '../types';\r\n\r\ntype PhantomEvent = 'disconnect' | 'connect';\r\ntype PhantomRequestMethod =\r\n  | 'connect'\r\n  | 'disconnect'\r\n  | 'signTransaction'\r\n  | 'signAllTransactions';\r\n\r\ninterface PhantomProvider {\r\n  publicKey?: PublicKey;\r\n  isConnected?: boolean;\r\n  autoApprove?: boolean;\r\n  signTransaction: (transaction: Transaction) => Promise<Transaction>;\r\n  signAllTransactions: (transactions: Transaction[]) => Promise<Transaction[]>;\r\n  connect: () => Promise<void>;\r\n  disconnect: () => Promise<void>;\r\n  on: (event: PhantomEvent, handler: (args: any) => void) => void;\r\n  request: (method: PhantomRequestMethod, params: any) => Promise<any>;\r\n  listeners: (event: PhantomEvent) => (() => void)[];\r\n}\r\n\r\nexport class PhantomWalletAdapter\r\n  extends EventEmitter\r\n  implements WalletAdapter {\r\n  constructor() {\r\n    super();\r\n    this.connect = this.connect.bind(this);\r\n  }\r\n\r\n  private get _provider(): PhantomProvider | undefined {\r\n    if ((window as any)?.solana?.isPhantom) {\r\n      return (window as any).solana;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  private _handleConnect = (...args) => {\r\n    this.emit('connect', ...args);\r\n  }\r\n\r\n  private _handleDisconnect = (...args) => {\r\n    this.emit('disconnect', ...args);\r\n  }\r\n\r\n  get connected() {\r\n    return this._provider?.isConnected || false;\r\n  }\r\n\r\n  get autoApprove() {\r\n    return this._provider?.autoApprove || false;\r\n  }\r\n\r\n  async signAllTransactions(\r\n    transactions: Transaction[],\r\n  ): Promise<Transaction[]> {\r\n    if (!this._provider) {\r\n      return transactions;\r\n    }\r\n\r\n    return this._provider.signAllTransactions(transactions);\r\n  }\r\n\r\n  get publicKey() {\r\n    return this._provider?.publicKey || DEFAULT_PUBLIC_KEY;\r\n  }\r\n\r\n  async signTransaction(transaction: Transaction) {\r\n    if (!this._provider) {\r\n      return transaction;\r\n    }\r\n\r\n    return this._provider.signTransaction(transaction);\r\n  }\r\n\r\n  connect() {\r\n    if (!this._provider) {\r\n      window.open('https://phantom.app/', '_blank');\r\n      notify({\r\n        message: 'Connection Error',\r\n        description: 'Please install Phantom wallet',\r\n      });\r\n      return;\r\n    }\r\n    if (!this._provider.listeners('connect').length) {\r\n      this._provider?.on('connect', this._handleConnect);\r\n    }\r\n    if (!this._provider.listeners('disconnect').length) {\r\n      this._provider?.on('disconnect', this._handleDisconnect);\r\n    }\r\n    return this._provider?.connect();\r\n  }\r\n\r\n  disconnect() {\r\n    if (this._provider) {\r\n      this._provider.disconnect();\r\n    }\r\n  }\r\n}\r\n","import EventEmitter from 'eventemitter3';\r\nimport { PublicKey, Transaction } from '@solana/web3.js';\r\nimport { notify } from '../../utils/notifications';\r\nimport { DEFAULT_PUBLIC_KEY, WalletAdapter } from '../types';\r\n\r\nexport class MathWalletAdapter extends EventEmitter implements WalletAdapter {\r\n  _publicKey?: PublicKey;\r\n  _onProcess: boolean;\r\n  _connected: boolean;\r\n  constructor() {\r\n    super();\r\n    this._onProcess = false;\r\n    this._connected = false;\r\n    this.connect = this.connect.bind(this);\r\n  }\r\n\r\n  get connected() {\r\n    return this._connected;\r\n  }\r\n\r\n  get autoApprove() {\r\n    return false;\r\n  }\r\n\r\n  public async signAllTransactions(\r\n    transactions: Transaction[],\r\n  ): Promise<Transaction[]> {\r\n    if (!this._provider) {\r\n      return transactions;\r\n    }\r\n\r\n    return this._provider.signAllTransactions(transactions);\r\n  }\r\n\r\n  private get _provider() {\r\n    if ((window as any)?.solana?.isMathWallet) {\r\n      return (window as any).solana;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  get publicKey() {\r\n    return this._publicKey || DEFAULT_PUBLIC_KEY;\r\n  }\r\n\r\n  async signTransaction(transaction: Transaction) {\r\n    if (!this._provider) {\r\n      return transaction;\r\n    }\r\n\r\n    return this._provider.signTransaction(transaction);\r\n  }\r\n\r\n  connect() {\r\n    if (this._onProcess) {\r\n      return;\r\n    }\r\n\r\n    if (!this._provider) {\r\n      window.open('https://mathwallet.org/', '_blank');\r\n      notify({\r\n        message: 'Math Wallet Error',\r\n        description: 'Please install mathwallet',\r\n      });\r\n      return;\r\n    }\r\n\r\n    this._onProcess = true;\r\n    this._provider\r\n      .getAccount()\r\n      .then((account: any) => {\r\n        this._publicKey = new PublicKey(account);\r\n        this._connected = true;\r\n        this.emit('connect', this._publicKey);\r\n      })\r\n      .catch(() => {\r\n        this.disconnect();\r\n      })\r\n      .finally(() => {\r\n        this._onProcess = false;\r\n      });\r\n  }\r\n\r\n  disconnect() {\r\n    if (this._publicKey) {\r\n      this._publicKey = undefined;\r\n      this._connected = false;\r\n      this.emit('disconnect');\r\n    }\r\n  }\r\n}\r\n","import React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useState,\r\n} from 'react';\r\nimport Wallet from '@project-serum/sol-wallet-adapter';\r\nimport { notify } from './notifications';\r\nimport { useConnectionConfig } from './connection';\r\nimport { useLocalStorageState } from './utils';\r\nimport { WalletContextValues } from './types';\r\nimport { Button, Modal } from 'antd';\r\nimport {\r\n  WalletAdapter,\r\n  LedgerWalletAdapter,\r\n  SolongWalletAdapter,\r\n  PhantomWalletAdapter,\r\n  SolletExtensionAdapter,\r\n  MathWalletAdapter,\r\n} from '../wallet-adapters';\r\n\r\nconst ASSET_URL =\r\n  'https://cdn.jsdelivr.net/gh/solana-labs/oyster@main/assets/wallets';\r\nexport const WALLET_PROVIDERS = [\r\n  {\r\n    name: 'sollet.io',\r\n    url: 'https://www.sollet.io',\r\n    icon: `${ASSET_URL}/sollet.svg`,\r\n  },\r\n  {\r\n    name: 'Sollet Extension',\r\n    url: 'https://www.sollet.io/extension',\r\n    icon: `${ASSET_URL}/sollet.svg`,\r\n    adapter: SolletExtensionAdapter as any,\r\n  },\r\n  {\r\n    name: 'Ledger',\r\n    url: 'https://www.ledger.com',\r\n    icon: `${ASSET_URL}/ledger.svg`,\r\n    adapter: LedgerWalletAdapter,\r\n  },\r\n  {\r\n    name: 'Solong',\r\n    url: 'https://www.solong.com',\r\n    icon: `${ASSET_URL}/solong.png`,\r\n    adapter: SolongWalletAdapter,\r\n  },\r\n  {\r\n    name: 'Phantom',\r\n    url: 'https://www.phantom.app',\r\n    icon: `https://www.phantom.app/img/logo.png`,\r\n    adapter: PhantomWalletAdapter,\r\n  },\r\n  {\r\n    name: 'MathWallet',\r\n    url: 'https://www.mathwallet.org',\r\n    icon: `${ASSET_URL}/mathwallet.svg`,\r\n    adapter: MathWalletAdapter,\r\n  }\r\n];\r\n\r\nconst WalletContext = React.createContext<null | WalletContextValues>(null);\r\n\r\nexport function WalletProvider({ children }) {\r\n  const { endpoint } = useConnectionConfig();\r\n\r\n  const [autoConnect, setAutoConnect] = useState(false);\r\n  const [providerUrl, setProviderUrl] = useLocalStorageState('walletProvider');\r\n\r\n  const provider = useMemo(\r\n    () => WALLET_PROVIDERS.find(({ url }) => url === providerUrl),\r\n    [providerUrl],\r\n  );\r\n\r\n  let [wallet, setWallet] = useState<WalletAdapter|undefined>(undefined);\r\n\r\n  useEffect(() => {\r\n    if (provider) {\r\n      const updateWallet = () => {\r\n        // hack to also update wallet synchronously in case it disconnects\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n        wallet = new (provider.adapter || Wallet)(\r\n          providerUrl,\r\n          endpoint,\r\n        ) as WalletAdapter;\r\n        setWallet(wallet);\r\n      }\r\n\r\n      if (document.readyState !== 'complete') {\r\n        // wait to ensure that browser extensions are loaded\r\n        const listener = () => {\r\n          updateWallet();\r\n          window.removeEventListener('load', listener);\r\n        };\r\n        window.addEventListener('load', listener);\r\n        return () => window.removeEventListener('load', listener);\r\n      } else {\r\n        updateWallet();\r\n      }\r\n    }\r\n  }, [provider, providerUrl, endpoint]);\r\n\r\n  const [connected, setConnected] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (wallet) {\r\n      wallet.on('connect', () => {\r\n        if (wallet?.publicKey) {\r\n          console.log('connected');\r\n          localStorage.removeItem('feeDiscountKey');\r\n          setConnected(true);\r\n          const walletPublicKey = wallet.publicKey.toBase58();\r\n          const keyToDisplay =\r\n            walletPublicKey.length > 20\r\n              ? `${walletPublicKey.substring(\r\n                  0,\r\n                  7,\r\n                )}.....${walletPublicKey.substring(\r\n                  walletPublicKey.length - 7,\r\n                  walletPublicKey.length,\r\n                )}`\r\n              : walletPublicKey;\r\n\r\n          notify({\r\n            message: 'Wallet update',\r\n            description: 'Connected to wallet ' + keyToDisplay,\r\n          });\r\n        }\r\n      });\r\n\r\n      wallet.on('disconnect', () => {\r\n        setConnected(false);\r\n        notify({\r\n          message: 'Wallet update',\r\n          description: 'Disconnected from wallet',\r\n        });\r\n        localStorage.removeItem('feeDiscountKey');\r\n      });\r\n    }\r\n\r\n    return () => {\r\n      setConnected(false);\r\n      if (wallet && wallet.connected) {\r\n        wallet.disconnect();\r\n        setConnected(false);\r\n      }\r\n    };\r\n  }, [wallet]);\r\n\r\n  useEffect(() => {\r\n    if (wallet && autoConnect) {\r\n      wallet.connect();\r\n      setAutoConnect(false);\r\n    }\r\n\r\n    return () => {};\r\n  }, [wallet, autoConnect]);\r\n\r\n  const [isModalVisible, setIsModalVisible] = useState(false);\r\n\r\n  const select = useCallback(() => setIsModalVisible(true), []);\r\n  const close = useCallback(() => setIsModalVisible(false), []);\r\n\r\n  return (\r\n    <WalletContext.Provider\r\n      value={{\r\n        wallet,\r\n        connected,\r\n        select,\r\n        providerUrl,\r\n        setProviderUrl,\r\n        providerName:\r\n          WALLET_PROVIDERS.find(({ url }) => url === providerUrl)?.name ??\r\n          providerUrl,\r\n      }}\r\n    >\r\n      {children}\r\n      <Modal\r\n        title=\"Select Wallet\"\r\n        okText=\"Connect\"\r\n        visible={isModalVisible}\r\n        okButtonProps={{ style: { display: 'none' } }}\r\n        onCancel={close}\r\n        width={400}\r\n      >\r\n        {WALLET_PROVIDERS.map((provider) => {\r\n          const onClick = function () {\r\n            setProviderUrl(provider.url);\r\n            setAutoConnect(true);\r\n            close();\r\n          };\r\n\r\n          return (\r\n            <Button\r\n              size=\"large\"\r\n              type={providerUrl === provider.url ? 'primary' : 'ghost'}\r\n              onClick={onClick}\r\n              icon={\r\n                <img\r\n                  alt={`${provider.name}`}\r\n                  width={20}\r\n                  height={20}\r\n                  src={provider.icon}\r\n                  style={{ marginRight: 8 }}\r\n                />\r\n              }\r\n              style={{\r\n                display: 'block',\r\n                width: '100%',\r\n                textAlign: 'left',\r\n                marginBottom: 8,\r\n              }}\r\n            >\r\n              {provider.name}\r\n            </Button>\r\n          );\r\n        })}\r\n      </Modal>\r\n    </WalletContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useWallet() {\r\n  const context = useContext(WalletContext);\r\n  if (!context) {\r\n    throw new Error('Missing wallet context');\r\n  }\r\n\r\n  const wallet = context.wallet;\r\n  return {\r\n    connected: context.connected,\r\n    wallet: wallet,\r\n    providerUrl: context.providerUrl,\r\n    setProvider: context.setProviderUrl,\r\n    providerName: context.providerName,\r\n    select: context.select,\r\n    connect() {\r\n      wallet ? wallet.connect() : context.select();\r\n    },\r\n    disconnect() {\r\n      wallet?.disconnect();\r\n    },\r\n  };\r\n}\r\n","import Wallet from '@project-serum/sol-wallet-adapter';\r\nimport { notify } from '../../utils/notifications';\r\n\r\nexport function SolletExtensionAdapter(_, network) {\r\n  const sollet = (window as any).sollet;\r\n  if (sollet) {\r\n    return new Wallet(sollet, network);\r\n  }\r\n\r\n  return {\r\n    on: () => {},\r\n    connect: () => {\r\n      notify({\r\n        message: 'Sollet Extension Error',\r\n        description: 'Please install the Sollet Extension for Chrome',\r\n      });\r\n    }\r\n  }\r\n}","import { createGlobalStyle } from 'styled-components';\r\n\r\nexport const GlobalStyle = createGlobalStyle`\r\nhtml,body{\r\n  background: #11161D;\r\n}\r\ninput[type=number]::-webkit-inner-spin-button {\r\n  opacity: 0;\r\n}\r\ninput[type=number]:hover::-webkit-inner-spin-button,\r\ninput[type=number]:focus::-webkit-inner-spin-button {\r\n  opacity: 0.25;\r\n}\r\n/* width */\r\n::-webkit-scrollbar {\r\n  width: 15px;\r\n}\r\n/* Track */\r\n::-webkit-scrollbar-track {\r\n  background: #2d313c;\r\n}\r\n/* Handle */\r\n::-webkit-scrollbar-thumb {\r\n  background: #5b5f67;\r\n}\r\n/* Handle on hover */\r\n::-webkit-scrollbar-thumb:hover {\r\n  background: #5b5f67;\r\n}\r\n.ant-slider-track, .ant-slider:hover .ant-slider-track {\r\n  background-color: #2abdd2;\r\n  opacity: 0.75;\r\n}\r\n.ant-slider-track,\r\n.ant-slider ant-slider-track:hover {\r\n  background-color: #2abdd2;\r\n  opacity: 0.75;\r\n}\r\n.ant-slider-dot-active,\r\n.ant-slider-handle,\r\n.ant-slider-handle-click-focused,\r\n.ant-slider:hover .ant-slider-handle:not(.ant-tooltip-open)  {\r\n  border: 2px solid #2abdd2; \r\n}\r\n.ant-table-tbody > tr.ant-table-row:hover > td {\r\n  background: #273043;\r\n}\r\n.ant-table-tbody > tr > td {\r\n  border-bottom: 8px solid #1A2029;\r\n}\r\n.ant-table-container table > thead > tr:first-child th {\r\n  border-bottom: none;\r\n}\r\n.ant-divider-horizontal.ant-divider-with-text::before, .ant-divider-horizontal.ant-divider-with-text::after {\r\n  border-top: 1px solid #434a59 !important;\r\n}\r\n.ant-layout {\r\n    background: #11161D\r\n  }\r\n  .ant-table {\r\n    background: #212734;\r\n  }\r\n  .ant-table-thead > tr > th {\r\n    background: #1A2029;\r\n  }\r\n.ant-select-item-option-content {\r\n  img {\r\n    margin-right: 4px;\r\n  }\r\n}\r\n.ant-modal-content {\r\n  background-color: #212734;\r\n}\r\n\r\n@-webkit-keyframes highlight {\r\n  from { background-color: #2abdd2;}\r\n  to {background-color: #1A2029;}\r\n}\r\n@-moz-keyframes highlight {\r\n  from { background-color: #2abdd2;}\r\n  to {background-color: #1A2029;}\r\n}\r\n@-keyframes highlight {\r\n  from { background-color: #2abdd2;}\r\n  to {background-color: #1A2029;}\r\n}\r\n.flash {\r\n  -moz-animation: highlight 0.5s ease 0s 1 alternate ;\r\n  -webkit-animation: highlight 0.5s ease 0s 1 alternate;\r\n  animation: highlight 0.5s ease 0s 1 alternate;\r\n}`;\r\n","import React, { Component } from 'react';\r\nimport { Typography } from 'antd';\r\n\r\nconst { Title } = Typography;\r\n\r\nexport default class ErrorBoundary extends Component {\r\n  state = {\r\n    hasError: false,\r\n  };\r\n\r\n  static getDerivedStateFromError(error) {\r\n    return { hasError: true };\r\n  }\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      return (\r\n        <div>\r\n          <div>\r\n            <Title level={2}>Something went wrong.</Title>\r\n            <Title level={4}>Please try again later.</Title>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n","import { notify } from './notifications';\r\nimport { getDecimalCount, sleep } from './utils';\r\nimport { getSelectedTokenAccountForMint } from './markets';\r\nimport {\r\n  Account,\r\n  AccountInfo,\r\n  Commitment,\r\n  Connection,\r\n  PublicKey,\r\n  RpcResponseAndContext,\r\n  SimulatedTransactionResponse,\r\n  SystemProgram,\r\n  Transaction,\r\n  TransactionSignature,\r\n} from '@solana/web3.js';\r\nimport BN from 'bn.js';\r\nimport {\r\n  DexInstructions,\r\n  Market,\r\n  OpenOrders, parseInstructionErrorResponse,\r\n  TOKEN_MINTS,\r\n  TokenInstructions,\r\n} from '@project-serum/serum';\r\nimport { SelectedTokenAccounts, TokenAccount } from './types';\r\nimport { Order } from '@project-serum/serum/lib/market';\r\nimport { Buffer } from 'buffer';\r\nimport assert from 'assert';\r\nimport { struct } from 'superstruct';\r\nimport { WalletAdapter } from '../wallet-adapters';\r\n\r\nexport async function createTokenAccountTransaction({\r\n  connection,\r\n  wallet,\r\n  mintPublicKey,\r\n}: {\r\n  connection: Connection;\r\n  wallet: WalletAdapter;\r\n  mintPublicKey: PublicKey;\r\n}): Promise<{\r\n  transaction: Transaction;\r\n  signer: Account;\r\n  newAccountPubkey: PublicKey;\r\n}> {\r\n  const newAccount = new Account();\r\n  const transaction = new Transaction();\r\n  const instruction = SystemProgram.createAccount({\r\n    fromPubkey: wallet.publicKey,\r\n    newAccountPubkey: newAccount.publicKey,\r\n    lamports: await connection.getMinimumBalanceForRentExemption(165),\r\n    space: 165,\r\n    programId: TokenInstructions.TOKEN_PROGRAM_ID,\r\n  });\r\n  transaction.add(instruction);\r\n  transaction.add(\r\n    TokenInstructions.initializeAccount({\r\n      account: newAccount.publicKey,\r\n      mint: mintPublicKey,\r\n      owner: wallet.publicKey,\r\n    }),\r\n  );\r\n  return {\r\n    transaction,\r\n    signer: newAccount,\r\n    newAccountPubkey: newAccount.publicKey,\r\n  };\r\n}\r\n\r\nexport async function settleFunds({\r\n  market,\r\n  openOrders,\r\n  connection,\r\n  wallet,\r\n  baseCurrencyAccount,\r\n  quoteCurrencyAccount,\r\n  sendNotification = true,\r\n}: {\r\n  market: Market;\r\n  openOrders: OpenOrders;\r\n  connection: Connection;\r\n  wallet: WalletAdapter;\r\n  baseCurrencyAccount: TokenAccount;\r\n  quoteCurrencyAccount: TokenAccount;\r\n  sendNotification?: boolean,\r\n}): Promise<string | undefined> {\r\n  if (\r\n    !market ||\r\n    !wallet ||\r\n    !connection ||\r\n    !openOrders ||\r\n    (!baseCurrencyAccount && !quoteCurrencyAccount)\r\n  ) {\r\n    if (sendNotification) {\r\n      notify({message: 'Not connected'});\r\n    }\r\n    return;\r\n  }\r\n\r\n  let createAccountTransaction: Transaction | undefined;\r\n  let createAccountSigner: Account | undefined;\r\n  let baseCurrencyAccountPubkey = baseCurrencyAccount?.pubkey;\r\n  let quoteCurrencyAccountPubkey = quoteCurrencyAccount?.pubkey;\r\n\r\n  if (!baseCurrencyAccountPubkey) {\r\n    const result = await createTokenAccountTransaction({\r\n      connection,\r\n      wallet,\r\n      mintPublicKey: market.baseMintAddress,\r\n    });\r\n    baseCurrencyAccountPubkey = result?.newAccountPubkey;\r\n    createAccountTransaction = result?.transaction;\r\n    createAccountSigner = result?.signer;\r\n  }\r\n  if (!quoteCurrencyAccountPubkey) {\r\n    const result = await createTokenAccountTransaction({\r\n      connection,\r\n      wallet,\r\n      mintPublicKey: market.quoteMintAddress,\r\n    });\r\n    quoteCurrencyAccountPubkey = result?.newAccountPubkey;\r\n    createAccountTransaction = result?.transaction;\r\n    createAccountSigner = result?.signer;\r\n  }\r\n  let referrerQuoteWallet: PublicKey | null = null;\r\n  if (market.supportsReferralFees) {\r\n    const usdt = TOKEN_MINTS.find(({ name }) => name === 'USDT');\r\n    const usdc = TOKEN_MINTS.find(({ name }) => name === 'USDC');\r\n    if (\r\n      process.env.REACT_APP_USDT_REFERRAL_FEES_ADDRESS &&\r\n      usdt &&\r\n      market.quoteMintAddress.equals(usdt.address)\r\n    ) {\r\n      referrerQuoteWallet = new PublicKey(\r\n        process.env.REACT_APP_USDT_REFERRAL_FEES_ADDRESS,\r\n      );\r\n    } else if (\r\n      process.env.REACT_APP_USDC_REFERRAL_FEES_ADDRESS &&\r\n      usdc &&\r\n      market.quoteMintAddress.equals(usdc.address)\r\n    ) {\r\n      referrerQuoteWallet = new PublicKey(\r\n        process.env.REACT_APP_USDC_REFERRAL_FEES_ADDRESS,\r\n      );\r\n    }\r\n  }\r\n  const {\r\n    transaction: settleFundsTransaction,\r\n    signers: settleFundsSigners,\r\n  } = await market.makeSettleFundsTransaction(\r\n    connection,\r\n    openOrders,\r\n    baseCurrencyAccountPubkey,\r\n    quoteCurrencyAccountPubkey,\r\n    referrerQuoteWallet,\r\n  );\r\n\r\n  let transaction = mergeTransactions([\r\n    createAccountTransaction,\r\n    settleFundsTransaction,\r\n  ]);\r\n  let signers = createAccountSigner\r\n    ? [...settleFundsSigners, createAccountSigner]\r\n    : settleFundsSigners;\r\n\r\n  return await sendTransaction({\r\n    transaction,\r\n    signers,\r\n    wallet,\r\n    connection,\r\n    sendingMessage: 'Settling funds...',\r\n    sendNotification\r\n  });\r\n}\r\n\r\nexport async function settleAllFunds({\r\n  connection,\r\n  wallet,\r\n  tokenAccounts,\r\n  markets,\r\n  selectedTokenAccounts,\r\n}: {\r\n  connection: Connection;\r\n  wallet: WalletAdapter;\r\n  tokenAccounts: TokenAccount[];\r\n  markets: Market[];\r\n  selectedTokenAccounts?: SelectedTokenAccounts;\r\n}) {\r\n  if (!markets || !wallet || !connection || !tokenAccounts) {\r\n    return;\r\n  }\r\n\r\n  const programIds: PublicKey[] = [];\r\n  markets\r\n    .reduce((cumulative, m) => {\r\n      // @ts-ignore\r\n      cumulative.push(m._programId);\r\n      return cumulative;\r\n    }, [])\r\n    .forEach((programId) => {\r\n      if (!programIds.find((p) => p.equals(programId))) {\r\n        programIds.push(programId);\r\n      }\r\n    });\r\n\r\n  const getOpenOrdersAccountsForProgramId = async (programId) => {\r\n    const openOrdersAccounts = await OpenOrders.findForOwner(\r\n      connection,\r\n      wallet.publicKey,\r\n      programId,\r\n    );\r\n    return openOrdersAccounts.filter(\r\n      (openOrders) =>\r\n        openOrders.baseTokenFree.toNumber() ||\r\n        openOrders.quoteTokenFree.toNumber(),\r\n    );\r\n  };\r\n\r\n  const openOrdersAccountsForProgramIds = await Promise.all(\r\n    programIds.map((programId) => getOpenOrdersAccountsForProgramId(programId)),\r\n  );\r\n  const openOrdersAccounts = openOrdersAccountsForProgramIds.reduce(\r\n    (accounts, current) => accounts.concat(current),\r\n    [],\r\n  );\r\n\r\n  const settleTransactions = (\r\n    await Promise.all(\r\n      openOrdersAccounts.map((openOrdersAccount) => {\r\n        const market = markets.find((m) =>\r\n          // @ts-ignore\r\n          m._decoded?.ownAddress?.equals(openOrdersAccount.market),\r\n        );\r\n        if (openOrdersAccount.baseTokenFree.isZero() && openOrdersAccount.quoteTokenFree.isZero()) {\r\n          // nothing to settle for this market.\r\n          return null;\r\n        }\r\n        const baseMint = market?.baseMintAddress;\r\n        const quoteMint = market?.quoteMintAddress;\r\n\r\n        const selectedBaseTokenAccount = getSelectedTokenAccountForMint(\r\n          tokenAccounts,\r\n          baseMint,\r\n          baseMint &&\r\n            selectedTokenAccounts &&\r\n            selectedTokenAccounts[baseMint.toBase58()],\r\n        )?.pubkey;\r\n        const selectedQuoteTokenAccount = getSelectedTokenAccountForMint(\r\n          tokenAccounts,\r\n          quoteMint,\r\n          quoteMint &&\r\n            selectedTokenAccounts &&\r\n            selectedTokenAccounts[quoteMint.toBase58()],\r\n        )?.pubkey;\r\n        if (!selectedBaseTokenAccount || !selectedQuoteTokenAccount) {\r\n          return null;\r\n        }\r\n        return (\r\n          market &&\r\n          market.makeSettleFundsTransaction(\r\n            connection,\r\n            openOrdersAccount,\r\n            selectedBaseTokenAccount,\r\n            selectedQuoteTokenAccount,\r\n          )\r\n        );\r\n      }),\r\n    )\r\n  ).filter(\r\n    (\r\n      x,\r\n    ): x is {\r\n      signers: Account[];\r\n      transaction: Transaction;\r\n      payer: PublicKey;\r\n    } => !!x,\r\n  );\r\n  if (!settleTransactions || settleTransactions.length === 0) return;\r\n\r\n  const transactions = settleTransactions.slice(0, 4).map((t) => t.transaction);\r\n  const signers: Array<Account> = [];\r\n  settleTransactions\r\n    .reduce((cumulative: Array<Account>, t) => cumulative.concat(t.signers), [])\r\n    .forEach((signer) => {\r\n      if (!signers.find((s) => s.publicKey.equals(signer.publicKey))) {\r\n        signers.push(signer);\r\n      }\r\n    });\r\n\r\n  const transaction = mergeTransactions(transactions);\r\n\r\n  return await sendTransaction({\r\n    transaction,\r\n    signers,\r\n    wallet,\r\n    connection,\r\n  });\r\n}\r\n\r\nexport async function cancelOrder(params: {\r\n  market: Market;\r\n  connection: Connection;\r\n  wallet: WalletAdapter;\r\n  order: Order;\r\n}) {\r\n  return cancelOrders({ ...params, orders: [params.order] });\r\n}\r\n\r\nexport async function cancelOrders({\r\n  market,\r\n  wallet,\r\n  connection,\r\n  orders,\r\n}: {\r\n  market: Market;\r\n  wallet: WalletAdapter;\r\n  connection: Connection;\r\n  orders: Order[];\r\n}) {\r\n  const transaction = market.makeMatchOrdersTransaction(5);\r\n  orders.forEach((order) => {\r\n    transaction.add(\r\n      market.makeCancelOrderInstruction(connection, wallet.publicKey, order),\r\n    );\r\n  });\r\n  transaction.add(market.makeMatchOrdersTransaction(5));\r\n  return await sendTransaction({\r\n    transaction,\r\n    wallet,\r\n    connection,\r\n    sendingMessage: 'Sending cancel...',\r\n  });\r\n}\r\n\r\nexport async function placeOrder({\r\n  side,\r\n  price,\r\n  size,\r\n  orderType,\r\n  market,\r\n  connection,\r\n  wallet,\r\n  baseCurrencyAccount,\r\n  quoteCurrencyAccount,\r\n  feeDiscountPubkey = undefined,\r\n}: {\r\n  side: 'buy' | 'sell';\r\n  price: number;\r\n  size: number;\r\n  orderType: 'ioc' | 'postOnly' | 'limit';\r\n  market: Market | undefined | null;\r\n  connection: Connection;\r\n  wallet: WalletAdapter;\r\n  baseCurrencyAccount: PublicKey | undefined;\r\n  quoteCurrencyAccount: PublicKey | undefined;\r\n  feeDiscountPubkey: PublicKey | undefined;\r\n}) {\r\n  let formattedMinOrderSize =\r\n    market?.minOrderSize?.toFixed(getDecimalCount(market.minOrderSize)) ||\r\n    market?.minOrderSize;\r\n  let formattedTickSize =\r\n    market?.tickSize?.toFixed(getDecimalCount(market.tickSize)) ||\r\n    market?.tickSize;\r\n  const isIncrement = (num, step) =>\r\n    Math.abs((num / step) % 1) < 1e-5 ||\r\n    Math.abs(((num / step) % 1) - 1) < 1e-5;\r\n  if (isNaN(price)) {\r\n    notify({ message: 'Invalid price', type: 'error' });\r\n    return;\r\n  }\r\n  if (isNaN(size)) {\r\n    notify({ message: 'Invalid size', type: 'error' });\r\n    return;\r\n  }\r\n  if (!wallet || !wallet.publicKey) {\r\n    notify({ message: 'Connect wallet', type: 'error' });\r\n    return;\r\n  }\r\n  if (!market) {\r\n    notify({ message: 'Invalid  market', type: 'error' });\r\n    return;\r\n  }\r\n  if (!isIncrement(size, market.minOrderSize)) {\r\n    notify({\r\n      message: `Size must be an increment of ${formattedMinOrderSize}`,\r\n      type: 'error',\r\n    });\r\n    return;\r\n  }\r\n  if (size < market.minOrderSize) {\r\n    notify({ message: 'Size too small', type: 'error' });\r\n    return;\r\n  }\r\n  if (!isIncrement(price, market.tickSize)) {\r\n    notify({\r\n      message: `Price must be an increment of ${formattedTickSize}`,\r\n      type: 'error',\r\n    });\r\n    return;\r\n  }\r\n  if (price < market.tickSize) {\r\n    notify({ message: 'Price under tick size', type: 'error' });\r\n    return;\r\n  }\r\n  const owner = wallet.publicKey;\r\n  const transaction = new Transaction();\r\n  const signers: Account[] = [];\r\n\r\n  if (!baseCurrencyAccount) {\r\n    const {\r\n      transaction: createAccountTransaction,\r\n      signer: createAccountSigners,\r\n      newAccountPubkey,\r\n    } = await createTokenAccountTransaction({\r\n      connection,\r\n      wallet,\r\n      mintPublicKey: market.baseMintAddress,\r\n    });\r\n    transaction.add(createAccountTransaction);\r\n    signers.push(createAccountSigners);\r\n    baseCurrencyAccount = newAccountPubkey;\r\n  }\r\n  if (!quoteCurrencyAccount) {\r\n    const {\r\n      transaction: createAccountTransaction,\r\n      signer: createAccountSigners,\r\n      newAccountPubkey,\r\n    } = await createTokenAccountTransaction({\r\n      connection,\r\n      wallet,\r\n      mintPublicKey: market.quoteMintAddress,\r\n    });\r\n    transaction.add(createAccountTransaction);\r\n    signers.push(createAccountSigners);\r\n    quoteCurrencyAccount = newAccountPubkey;\r\n  }\r\n\r\n  const payer = side === 'sell' ? baseCurrencyAccount : quoteCurrencyAccount;\r\n  if (!payer) {\r\n    notify({\r\n      message: 'Need an SPL token account for cost currency',\r\n      type: 'error',\r\n    });\r\n    return;\r\n  }\r\n  const params = {\r\n    owner,\r\n    payer,\r\n    side,\r\n    price,\r\n    size,\r\n    orderType,\r\n    feeDiscountPubkey: feeDiscountPubkey || null,\r\n  };\r\n  console.log(params);\r\n\r\n  const matchOrderstransaction = market.makeMatchOrdersTransaction(5);\r\n  transaction.add(matchOrderstransaction);\r\n  const startTime = getUnixTs();\r\n  let {\r\n    transaction: placeOrderTx,\r\n    signers: placeOrderSigners,\r\n  } = await market.makePlaceOrderTransaction(\r\n    connection,\r\n    params,\r\n    120_000,\r\n    120_000,\r\n  );\r\n  const endTime = getUnixTs();\r\n  console.log(`Creating order transaction took ${endTime - startTime}`);\r\n  transaction.add(placeOrderTx);\r\n  transaction.add(market.makeMatchOrdersTransaction(5));\r\n  signers.push(...placeOrderSigners);\r\n\r\n  return await sendTransaction({\r\n    transaction,\r\n    wallet,\r\n    connection,\r\n    signers,\r\n    sendingMessage: 'Sending order...',\r\n  });\r\n}\r\n\r\nexport async function listMarket({\r\n  connection,\r\n  wallet,\r\n  baseMint,\r\n  quoteMint,\r\n  baseLotSize,\r\n  quoteLotSize,\r\n  dexProgramId,\r\n}: {\r\n  connection: Connection;\r\n  wallet: WalletAdapter;\r\n  baseMint: PublicKey;\r\n  quoteMint: PublicKey;\r\n  baseLotSize: number;\r\n  quoteLotSize: number;\r\n  dexProgramId: PublicKey;\r\n}) {\r\n  const market = new Account();\r\n  const requestQueue = new Account();\r\n  const eventQueue = new Account();\r\n  const bids = new Account();\r\n  const asks = new Account();\r\n  const baseVault = new Account();\r\n  const quoteVault = new Account();\r\n  const feeRateBps = 0;\r\n  const quoteDustThreshold = new BN(100);\r\n\r\n  async function getVaultOwnerAndNonce() {\r\n    const nonce = new BN(0);\r\n    while (true) {\r\n      try {\r\n        const vaultOwner = await PublicKey.createProgramAddress(\r\n          [market.publicKey.toBuffer(), nonce.toArrayLike(Buffer, 'le', 8)],\r\n          dexProgramId,\r\n        );\r\n        return [vaultOwner, nonce];\r\n      } catch (e) {\r\n        nonce.iaddn(1);\r\n      }\r\n    }\r\n  }\r\n  const [vaultOwner, vaultSignerNonce] = await getVaultOwnerAndNonce();\r\n\r\n  const tx1 = new Transaction();\r\n  tx1.add(\r\n    SystemProgram.createAccount({\r\n      fromPubkey: wallet.publicKey,\r\n      newAccountPubkey: baseVault.publicKey,\r\n      lamports: await connection.getMinimumBalanceForRentExemption(165),\r\n      space: 165,\r\n      programId: TokenInstructions.TOKEN_PROGRAM_ID,\r\n    }),\r\n    SystemProgram.createAccount({\r\n      fromPubkey: wallet.publicKey,\r\n      newAccountPubkey: quoteVault.publicKey,\r\n      lamports: await connection.getMinimumBalanceForRentExemption(165),\r\n      space: 165,\r\n      programId: TokenInstructions.TOKEN_PROGRAM_ID,\r\n    }),\r\n    TokenInstructions.initializeAccount({\r\n      account: baseVault.publicKey,\r\n      mint: baseMint,\r\n      owner: vaultOwner,\r\n    }),\r\n    TokenInstructions.initializeAccount({\r\n      account: quoteVault.publicKey,\r\n      mint: quoteMint,\r\n      owner: vaultOwner,\r\n    }),\r\n  );\r\n\r\n  const tx2 = new Transaction();\r\n  tx2.add(\r\n    SystemProgram.createAccount({\r\n      fromPubkey: wallet.publicKey,\r\n      newAccountPubkey: market.publicKey,\r\n      lamports: await connection.getMinimumBalanceForRentExemption(\r\n        Market.getLayout(dexProgramId).span,\r\n      ),\r\n      space: Market.getLayout(dexProgramId).span,\r\n      programId: dexProgramId,\r\n    }),\r\n    SystemProgram.createAccount({\r\n      fromPubkey: wallet.publicKey,\r\n      newAccountPubkey: requestQueue.publicKey,\r\n      lamports: await connection.getMinimumBalanceForRentExemption(5120 + 12),\r\n      space: 5120 + 12,\r\n      programId: dexProgramId,\r\n    }),\r\n    SystemProgram.createAccount({\r\n      fromPubkey: wallet.publicKey,\r\n      newAccountPubkey: eventQueue.publicKey,\r\n      lamports: await connection.getMinimumBalanceForRentExemption(262144 + 12),\r\n      space: 262144 + 12,\r\n      programId: dexProgramId,\r\n    }),\r\n    SystemProgram.createAccount({\r\n      fromPubkey: wallet.publicKey,\r\n      newAccountPubkey: bids.publicKey,\r\n      lamports: await connection.getMinimumBalanceForRentExemption(65536 + 12),\r\n      space: 65536 + 12,\r\n      programId: dexProgramId,\r\n    }),\r\n    SystemProgram.createAccount({\r\n      fromPubkey: wallet.publicKey,\r\n      newAccountPubkey: asks.publicKey,\r\n      lamports: await connection.getMinimumBalanceForRentExemption(65536 + 12),\r\n      space: 65536 + 12,\r\n      programId: dexProgramId,\r\n    }),\r\n    DexInstructions.initializeMarket({\r\n      market: market.publicKey,\r\n      requestQueue: requestQueue.publicKey,\r\n      eventQueue: eventQueue.publicKey,\r\n      bids: bids.publicKey,\r\n      asks: asks.publicKey,\r\n      baseVault: baseVault.publicKey,\r\n      quoteVault: quoteVault.publicKey,\r\n      baseMint,\r\n      quoteMint,\r\n      baseLotSize: new BN(baseLotSize),\r\n      quoteLotSize: new BN(quoteLotSize),\r\n      feeRateBps,\r\n      vaultSignerNonce,\r\n      quoteDustThreshold,\r\n      programId: dexProgramId,\r\n    }),\r\n  );\r\n\r\n  const signedTransactions = await signTransactions({\r\n    transactionsAndSigners: [\r\n      { transaction: tx1, signers: [baseVault, quoteVault] },\r\n      {\r\n        transaction: tx2,\r\n        signers: [market, requestQueue, eventQueue, bids, asks],\r\n      },\r\n    ],\r\n    wallet,\r\n    connection,\r\n  });\r\n  for (let signedTransaction of signedTransactions) {\r\n    await sendSignedTransaction({\r\n      signedTransaction,\r\n      connection,\r\n    });\r\n  }\r\n\r\n  return market.publicKey;\r\n}\r\n\r\nexport const getUnixTs = () => {\r\n  return new Date().getTime() / 1000;\r\n};\r\n\r\nconst DEFAULT_TIMEOUT = 15000;\r\n\r\nexport async function sendTransaction({\r\n  transaction,\r\n  wallet,\r\n  signers = [],\r\n  connection,\r\n  sendingMessage = 'Sending transaction...',\r\n  sentMessage = 'Transaction sent',\r\n  successMessage = 'Transaction confirmed',\r\n  timeout = DEFAULT_TIMEOUT,\r\n  sendNotification = true,\r\n}: {\r\n  transaction: Transaction;\r\n  wallet: WalletAdapter;\r\n  signers?: Array<Account>;\r\n  connection: Connection;\r\n  sendingMessage?: string;\r\n  sentMessage?: string;\r\n  successMessage?: string;\r\n  timeout?: number;\r\n  sendNotification?: boolean\r\n}) {\r\n  const signedTransaction = await signTransaction({\r\n    transaction,\r\n    wallet,\r\n    signers,\r\n    connection,\r\n  });\r\n  return await sendSignedTransaction({\r\n    signedTransaction,\r\n    connection,\r\n    sendingMessage,\r\n    sentMessage,\r\n    successMessage,\r\n    timeout,\r\n    sendNotification\r\n  });\r\n}\r\n\r\nexport async function signTransaction({\r\n  transaction,\r\n  wallet,\r\n  signers = [],\r\n  connection,\r\n}: {\r\n  transaction: Transaction;\r\n  wallet: WalletAdapter;\r\n  signers?: Array<Account>;\r\n  connection: Connection;\r\n}) {\r\n  transaction.recentBlockhash = (\r\n    await connection.getRecentBlockhash('max')\r\n  ).blockhash;\r\n  transaction.setSigners(wallet.publicKey, ...signers.map((s) => s.publicKey));\r\n  if (signers.length > 0) {\r\n    transaction.partialSign(...signers);\r\n  }\r\n  return await wallet.signTransaction(transaction);\r\n}\r\n\r\nexport async function signTransactions({\r\n  transactionsAndSigners,\r\n  wallet,\r\n  connection,\r\n}: {\r\n  transactionsAndSigners: {\r\n    transaction: Transaction;\r\n    signers?: Array<Account>;\r\n  }[];\r\n  wallet: WalletAdapter;\r\n  connection: Connection;\r\n}) {\r\n  const blockhash = (await connection.getRecentBlockhash('max')).blockhash;\r\n  transactionsAndSigners.forEach(({ transaction, signers = [] }) => {\r\n    transaction.recentBlockhash = blockhash;\r\n    transaction.setSigners(\r\n      wallet.publicKey,\r\n      ...signers.map((s) => s.publicKey),\r\n    );\r\n    if (signers?.length > 0) {\r\n      transaction.partialSign(...signers);\r\n    }\r\n  });\r\n  return await wallet.signAllTransactions(\r\n    transactionsAndSigners.map(({ transaction }) => transaction),\r\n  );\r\n}\r\n\r\nexport async function sendSignedTransaction({\r\n  signedTransaction,\r\n  connection,\r\n  sendingMessage = 'Sending transaction...',\r\n  sentMessage = 'Transaction sent',\r\n  successMessage = 'Transaction confirmed',\r\n  timeout = DEFAULT_TIMEOUT,\r\n  sendNotification = true,\r\n}: {\r\n  signedTransaction: Transaction;\r\n  connection: Connection;\r\n  sendingMessage?: string;\r\n  sentMessage?: string;\r\n  successMessage?: string;\r\n  timeout?: number;\r\n  sendNotification?: boolean\r\n}): Promise<string> {\r\n  const rawTransaction = signedTransaction.serialize();\r\n  const startTime = getUnixTs();\r\n  if (sendNotification){\r\n    notify({ message: sendingMessage });\r\n  }\r\n  const txid: TransactionSignature = await connection.sendRawTransaction(\r\n    rawTransaction,\r\n    {\r\n      skipPreflight: true,\r\n    },\r\n  );\r\n  if (sendNotification) {\r\n    notify({ message: sentMessage, type: 'success', txid });\r\n  }\r\n\r\n  console.log('Started awaiting confirmation for', txid);\r\n\r\n  let done = false;\r\n  (async () => {\r\n    while (!done && getUnixTs() - startTime < timeout) {\r\n      connection.sendRawTransaction(rawTransaction, {\r\n        skipPreflight: true,\r\n      });\r\n      await sleep(300);\r\n    }\r\n  })();\r\n  try {\r\n    await awaitTransactionSignatureConfirmation(txid, timeout, connection);\r\n  } catch (err) {\r\n    if (err.timeout) {\r\n      throw new Error('Timed out awaiting confirmation on transaction');\r\n    }\r\n    let simulateResult: SimulatedTransactionResponse | null = null;\r\n    try {\r\n      simulateResult = (\r\n        await simulateTransaction(connection, signedTransaction, 'single')\r\n      ).value;\r\n    } catch (e) {}\r\n    if (simulateResult && simulateResult.err) {\r\n      if (simulateResult.logs) {\r\n        for (let i = simulateResult.logs.length - 1; i >= 0; --i) {\r\n          const line = simulateResult.logs[i];\r\n          if (line.startsWith('Program log: ')) {\r\n            throw new Error(\r\n              'Transaction failed: ' + line.slice('Program log: '.length),\r\n            );\r\n          }\r\n        }\r\n      }\r\n      let parsedError;\r\n      if (typeof simulateResult.err == 'object' && \"InstructionError\" in simulateResult.err) {\r\n        const parsedErrorInfo = parseInstructionErrorResponse(signedTransaction, simulateResult.err[\"InstructionError\"]);\r\n        parsedError = parsedErrorInfo.error;\r\n      } else {\r\n        parsedError = JSON.stringify(simulateResult.err);\r\n      }\r\n      throw new Error(parsedError);\r\n    }\r\n    throw new Error('Transaction failed');\r\n  } finally {\r\n    done = true;\r\n  }\r\n  if (sendNotification) {\r\n    notify({ message: successMessage, type: 'success', txid });\r\n  }\r\n\r\n  console.log('Latency', txid, getUnixTs() - startTime);\r\n  return txid;\r\n}\r\n\r\nasync function awaitTransactionSignatureConfirmation(\r\n  txid: TransactionSignature,\r\n  timeout: number,\r\n  connection: Connection,\r\n) {\r\n  let done = false;\r\n  const result = await new Promise((resolve, reject) => {\r\n    (async () => {\r\n      setTimeout(() => {\r\n        if (done) {\r\n          return;\r\n        }\r\n        done = true;\r\n        console.log('Timed out for txid', txid);\r\n        reject({ timeout: true });\r\n      }, timeout);\r\n      try {\r\n        connection.onSignature(\r\n          txid,\r\n          (result) => {\r\n            console.log('WS confirmed', txid, result);\r\n            done = true;\r\n            if (result.err) {\r\n              reject(result.err);\r\n            } else {\r\n              resolve(result);\r\n            }\r\n          },\r\n          'recent',\r\n        );\r\n        console.log('Set up WS connection', txid);\r\n      } catch (e) {\r\n        done = true;\r\n        console.log('WS error in setup', txid, e);\r\n      }\r\n      while (!done) {\r\n        // eslint-disable-next-line no-loop-func\r\n        (async () => {\r\n          try {\r\n            const signatureStatuses = await connection.getSignatureStatuses([\r\n              txid,\r\n            ]);\r\n            const result = signatureStatuses && signatureStatuses.value[0];\r\n            if (!done) {\r\n              if (!result) {\r\n                console.log('REST null result for', txid, result);\r\n              } else if (result.err) {\r\n                console.log('REST error for', txid, result);\r\n                done = true;\r\n                reject(result.err);\r\n              } else if (!result.confirmations) {\r\n                console.log('REST no confirmations for', txid, result);\r\n              } else {\r\n                console.log('REST confirmation for', txid, result);\r\n                done = true;\r\n                resolve(result);\r\n              }\r\n            }\r\n          } catch (e) {\r\n            if (!done) {\r\n              console.log('REST connection error: txid', txid, e);\r\n            }\r\n          }\r\n        })();\r\n        await sleep(300);\r\n      }\r\n    })();\r\n  });\r\n  done = true;\r\n  return result;\r\n}\r\n\r\nfunction mergeTransactions(transactions: (Transaction | undefined)[]) {\r\n  const transaction = new Transaction();\r\n  transactions\r\n    .filter((t): t is Transaction => t !== undefined)\r\n    .forEach((t) => {\r\n      transaction.add(t);\r\n    });\r\n  return transaction;\r\n}\r\n\r\nfunction jsonRpcResult(resultDescription: any) {\r\n  const jsonRpcVersion = struct.literal('2.0');\r\n  return struct.union([\r\n    struct({\r\n      jsonrpc: jsonRpcVersion,\r\n      id: 'string',\r\n      error: 'any',\r\n    }),\r\n    struct({\r\n      jsonrpc: jsonRpcVersion,\r\n      id: 'string',\r\n      error: 'null?',\r\n      result: resultDescription,\r\n    }),\r\n  ]);\r\n}\r\n\r\nfunction jsonRpcResultAndContext(resultDescription: any) {\r\n  return jsonRpcResult({\r\n    context: struct({\r\n      slot: 'number',\r\n    }),\r\n    value: resultDescription,\r\n  });\r\n}\r\n\r\nconst AccountInfoResult = struct({\r\n  executable: 'boolean',\r\n  owner: 'string',\r\n  lamports: 'number',\r\n  data: 'any',\r\n  rentEpoch: 'number?',\r\n});\r\n\r\nexport const GetMultipleAccountsAndContextRpcResult = jsonRpcResultAndContext(\r\n  struct.array([struct.union(['null', AccountInfoResult])]),\r\n);\r\n\r\nexport async function getMultipleSolanaAccounts(\r\n  connection: Connection,\r\n  publicKeys: PublicKey[],\r\n): Promise<\r\n  RpcResponseAndContext<{ [key: string]: AccountInfo<Buffer> | null }>\r\n> {\r\n  const args = [publicKeys.map((k) => k.toBase58()), { commitment: 'recent' }];\r\n  // @ts-ignore\r\n  const unsafeRes = await connection._rpcRequest('getMultipleAccounts', args);\r\n  const res = GetMultipleAccountsAndContextRpcResult(unsafeRes);\r\n  if (res.error) {\r\n    throw new Error(\r\n      'failed to get info about accounts ' +\r\n        publicKeys.map((k) => k.toBase58()).join(', ') +\r\n        ': ' +\r\n        res.error.message,\r\n    );\r\n  }\r\n  assert(typeof res.result !== 'undefined');\r\n  const accounts: Array<{\r\n    executable: any;\r\n    owner: PublicKey;\r\n    lamports: any;\r\n    data: Buffer;\r\n  } | null> = [];\r\n  for (const account of res.result.value) {\r\n    let value: {\r\n      executable: any;\r\n      owner: PublicKey;\r\n      lamports: any;\r\n      data: Buffer;\r\n    } | null = null;\r\n    if (res.result.value) {\r\n      const { executable, owner, lamports, data } = account;\r\n      assert(data[1] === 'base64');\r\n      value = {\r\n        executable,\r\n        owner: new PublicKey(owner),\r\n        lamports,\r\n        data: Buffer.from(data[0], 'base64'),\r\n      };\r\n    }\r\n    accounts.push(value);\r\n  }\r\n  return {\r\n    context: {\r\n      slot: res.result.context.slot,\r\n    },\r\n    value: Object.fromEntries(\r\n      accounts.map((account, i) => [publicKeys[i].toBase58(), account]),\r\n    ),\r\n  };\r\n}\r\n\r\n/** Copy of Connection.simulateTransaction that takes a commitment parameter. */\r\nasync function simulateTransaction(\r\n  connection: Connection,\r\n  transaction: Transaction,\r\n  commitment: Commitment,\r\n): Promise<RpcResponseAndContext<SimulatedTransactionResponse>> {\r\n  // @ts-ignore\r\n  transaction.recentBlockhash = await connection._recentBlockhash(\r\n    // @ts-ignore\r\n    connection._disableBlockhashCaching,\r\n  );\r\n\r\n  const signData = transaction.serializeMessage();\r\n  // @ts-ignore\r\n  const wireTransaction = transaction._serialize(signData);\r\n  const encodedTransaction = wireTransaction.toString('base64');\r\n  const config: any = { encoding: 'base64', commitment };\r\n  const args = [encodedTransaction, config];\r\n\r\n  // @ts-ignore\r\n  const res = await connection._rpcRequest('simulateTransaction', args);\r\n  if (res.error) {\r\n    throw new Error('failed to simulate transaction: ' + res.error.message);\r\n  }\r\n  return res.result;\r\n}\r\n","import * as BufferLayout from 'buffer-layout';\r\nimport bs58 from 'bs58';\r\nimport {AccountInfo, Connection, PublicKey} from '@solana/web3.js';\r\nimport {WRAPPED_SOL_MINT} from '@project-serum/serum/lib/token-instructions';\r\nimport {TokenAccount} from './types';\r\nimport {TOKEN_MINTS} from '@project-serum/serum';\r\nimport {useAllMarkets, useCustomMarkets, useTokenAccounts} from './markets';\r\nimport {getMultipleSolanaAccounts} from './send';\r\nimport {useConnection} from './connection';\r\nimport {useAsyncData} from './fetch-loop';\r\nimport tuple from 'immutable-tuple';\r\nimport BN from 'bn.js';\r\nimport {useMemo} from 'react';\r\n\r\nexport const ACCOUNT_LAYOUT = BufferLayout.struct([\r\n  BufferLayout.blob(32, 'mint'),\r\n  BufferLayout.blob(32, 'owner'),\r\n  BufferLayout.nu64('amount'),\r\n  BufferLayout.blob(93),\r\n]);\r\n\r\nexport const MINT_LAYOUT = BufferLayout.struct([\r\n  BufferLayout.blob(36),\r\n  BufferLayout.blob(8, 'supply'),\r\n  BufferLayout.u8('decimals'),\r\n  BufferLayout.u8('initialized'),\r\n  BufferLayout.blob(36),\r\n]);\r\n\r\nexport function parseTokenAccountData(\r\n  data: Buffer,\r\n): { mint: PublicKey; owner: PublicKey; amount: number } {\r\n  let { mint, owner, amount } = ACCOUNT_LAYOUT.decode(data);\r\n  return {\r\n    mint: new PublicKey(mint),\r\n    owner: new PublicKey(owner),\r\n    amount,\r\n  };\r\n}\r\n\r\nexport interface MintInfo {\r\n  decimals: number;\r\n  initialized: boolean;\r\n  supply: BN;\r\n}\r\n\r\nexport function parseTokenMintData(data): MintInfo {\r\n  let { decimals, initialized, supply } = MINT_LAYOUT.decode(data);\r\n  return {\r\n    decimals,\r\n    initialized: !!initialized,\r\n    supply: new BN(supply, 10, 'le'),\r\n  };\r\n}\r\n\r\nexport function getOwnedAccountsFilters(publicKey: PublicKey) {\r\n  return [\r\n    {\r\n      memcmp: {\r\n        offset: ACCOUNT_LAYOUT.offsetOf('owner'),\r\n        bytes: publicKey.toBase58(),\r\n      },\r\n    },\r\n    {\r\n      dataSize: ACCOUNT_LAYOUT.span,\r\n    },\r\n  ];\r\n}\r\n\r\nexport const TOKEN_PROGRAM_ID = new PublicKey(\r\n  'TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA',\r\n);\r\n\r\nexport async function getOwnedTokenAccounts(\r\n  connection: Connection,\r\n  publicKey: PublicKey,\r\n): Promise<Array<{ publicKey: PublicKey; accountInfo: AccountInfo<Buffer> }>> {\r\n  let filters = getOwnedAccountsFilters(publicKey);\r\n  // @ts-ignore\r\n  let resp = await connection._rpcRequest('getProgramAccounts', [\r\n    TOKEN_PROGRAM_ID.toBase58(),\r\n    {\r\n      commitment: connection.commitment,\r\n      filters,\r\n    },\r\n  ]);\r\n  if (resp.error) {\r\n    throw new Error(\r\n      'failed to get token accounts owned by ' +\r\n        publicKey.toBase58() +\r\n        ': ' +\r\n        resp.error.message,\r\n    );\r\n  }\r\n  return resp.result\r\n    .map(({ pubkey, account: { data, executable, owner, lamports } }) => ({\r\n      publicKey: new PublicKey(pubkey),\r\n      accountInfo: {\r\n        data: bs58.decode(data),\r\n        executable,\r\n        owner: new PublicKey(owner),\r\n        lamports,\r\n      },\r\n    }))\r\n    .filter(({ accountInfo }) => {\r\n      // TODO: remove this check once mainnet is updated\r\n      return filters.every((filter) => {\r\n        if (filter.dataSize) {\r\n          return accountInfo.data.length === filter.dataSize;\r\n        } else if (filter.memcmp) {\r\n          let filterBytes = bs58.decode(filter.memcmp.bytes);\r\n          return accountInfo.data\r\n            .slice(\r\n              filter.memcmp.offset,\r\n              filter.memcmp.offset + filterBytes.length,\r\n            )\r\n            .equals(filterBytes);\r\n        }\r\n        return false;\r\n      });\r\n    });\r\n}\r\n\r\nexport async function getTokenAccountInfo(\r\n  connection: Connection,\r\n  ownerAddress: PublicKey,\r\n) {\r\n  let [splAccounts, account] = await Promise.all([\r\n    getOwnedTokenAccounts(connection, ownerAddress),\r\n    connection.getAccountInfo(ownerAddress),\r\n  ]);\r\n  const parsedSplAccounts: TokenAccount[] = splAccounts.map(\r\n    ({ publicKey, accountInfo }) => {\r\n      return {\r\n        pubkey: publicKey,\r\n        account: accountInfo,\r\n        effectiveMint: parseTokenAccountData(accountInfo.data).mint,\r\n      };\r\n    },\r\n  );\r\n  return parsedSplAccounts.concat({\r\n    pubkey: ownerAddress,\r\n    account,\r\n    effectiveMint: WRAPPED_SOL_MINT,\r\n  });\r\n}\r\n\r\n// todo: use this to map custom mints to custom tickers. Add functionality once custom markets store mints\r\nexport function useMintToTickers(): { [mint: string]: string } {\r\n  const { customMarkets } = useCustomMarkets();\r\n  return useMemo(() => {\r\n    return Object.fromEntries(\r\n      TOKEN_MINTS.map((mint) => [mint.address.toBase58(), mint.name]),\r\n    );\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [customMarkets.length]);\r\n}\r\n\r\nconst _VERY_SLOW_REFRESH_INTERVAL = 5000 * 1000;\r\n\r\n// todo: move this to using mints stored in static market infos once custom markets support that.\r\nexport function useMintInfos(): [\r\n  (\r\n    | {\r\n        [mintAddress: string]: {\r\n          decimals: number;\r\n          initialized: boolean;\r\n        } | null;\r\n      }\r\n    | null\r\n    | undefined\r\n  ),\r\n  boolean,\r\n] {\r\n  const connection = useConnection();\r\n  const [tokenAccounts] = useTokenAccounts();\r\n  const [allMarkets] = useAllMarkets();\r\n\r\n  const allMints = (tokenAccounts || [])\r\n    .map((account) => account.effectiveMint)\r\n    .concat(\r\n      (allMarkets || []).map((marketInfo) => marketInfo.market.baseMintAddress),\r\n    )\r\n    .concat(\r\n      (allMarkets || []).map(\r\n        (marketInfo) => marketInfo.market.quoteMintAddress,\r\n      ),\r\n    );\r\n  const uniqueMints = [...new Set(allMints.map((mint) => mint.toBase58()))].map(\r\n    (stringMint) => new PublicKey(stringMint),\r\n  );\r\n\r\n  const getAllMintInfo = async () => {\r\n    const mintInfos = await getMultipleSolanaAccounts(connection, uniqueMints);\r\n    return Object.fromEntries(\r\n      Object.entries(mintInfos.value).map(([key, accountInfo]) => [\r\n        key,\r\n        accountInfo && parseTokenMintData(accountInfo.data),\r\n      ]),\r\n    );\r\n  };\r\n\r\n  return useAsyncData(\r\n    getAllMintInfo,\r\n    tuple(\r\n      'getAllMintInfo',\r\n      connection,\r\n      (tokenAccounts || []).length,\r\n      (allMarkets || []).length,\r\n    ),\r\n    { refreshInterval: _VERY_SLOW_REFRESH_INTERVAL },\r\n  );\r\n}\r\n","import { BonfidaTrade } from './types';\r\n\r\nexport default class BonfidaApi {\r\n  static URL: string = 'https://serum-api.bonfida.com/';\r\n\r\n  static async get(path: string) {\r\n    try {\r\n      const response = await fetch(this.URL + path);\r\n      if (response.ok) {\r\n        const responseJson = await response.json();\r\n        return responseJson.success ? responseJson.data : null;\r\n      }\r\n    } catch (err) {\r\n      console.log(`Error fetching from Bonfida API ${path}: ${err}`);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  static async getRecentTrades(\r\n    marketAddress: string,\r\n  ): Promise<BonfidaTrade[] | null> {\r\n    return BonfidaApi.get(`trades/address/${marketAddress}`);\r\n  }\r\n}\r\n\r\nexport const BONFIDA_DATA_FEED = 'https://serum-api.bonfida.com/tv';\r\n","import {Market, MARKETS, OpenOrders, Orderbook, TOKEN_MINTS, TokenInstructions,} from '@project-serum/serum';\r\nimport {PublicKey} from '@solana/web3.js';\r\nimport React, {useContext, useEffect, useState} from 'react';\r\nimport {divideBnToNumber, floorToDecimal, getTokenMultiplierFromDecimals, sleep, useLocalStorageState,} from './utils';\r\nimport {refreshCache, useAsyncData} from './fetch-loop';\r\nimport {useAccountData, useAccountInfo, useConnection} from './connection';\r\nimport {useWallet} from './wallet';\r\nimport tuple from 'immutable-tuple';\r\nimport {notify} from './notifications';\r\nimport BN from 'bn.js';\r\nimport {getTokenAccountInfo, parseTokenAccountData, useMintInfos,} from './tokens';\r\nimport {\r\n  Balances,\r\n  CustomMarketInfo,\r\n  DeprecatedOpenOrdersBalances,\r\n  FullMarketInfo,\r\n  MarketContextValues,\r\n  MarketInfo,\r\n  OrderWithMarketAndMarketName,\r\n  SelectedTokenAccounts,\r\n  TokenAccount,\r\n} from './types';\r\nimport {WRAPPED_SOL_MINT} from '@project-serum/serum/lib/token-instructions';\r\nimport {Order} from '@project-serum/serum/lib/market';\r\nimport BonfidaApi from './bonfidaConnector';\r\nimport sonarMarkets from './sonar-markets.json'\r\nimport sonarTokenMints from './sonar-token-mints.json'\r\n\r\nexport const SONAR_MARKETS: Array<{\r\n  address: PublicKey;\r\n  name: string;\r\n  programId: PublicKey;\r\n  deprecated: boolean;\r\n}> = sonarMarkets\r\n  .filter((sonarMarket) => {\r\n    return (MARKETS.find(market => market.address.toString() === sonarMarket.address) !== undefined)?false:true\r\n  })\r\n  .map((market) => {\r\n    return {\r\n      address: new PublicKey(market.address),\r\n      name: market.name,\r\n      programId: new PublicKey(market.programId),\r\n      deprecated: market.deprecated,\r\n    };\r\n  });\r\n\r\n  export const SONAR_TOKEN_MINTS: Array<{\r\n    address: PublicKey;\r\n    name: string;\r\n  }> = sonarTokenMints\r\n  .filter((sonarTokenMint) => {\r\n    return (TOKEN_MINTS.find(tokenMint => tokenMint.address.toString() === sonarTokenMint.address) !== undefined)?false:true\r\n  })\r\n  .map((mint) => {\r\n    return {\r\n      address: new PublicKey(mint.address),\r\n      name: mint.name,\r\n    };\r\n  });\r\n  \r\n// Used in debugging, should be false in production\r\nconst _IGNORE_DEPRECATED = false;\r\n\r\nexport const USE_MARKETS: MarketInfo[] = _IGNORE_DEPRECATED\r\n  ? [...MARKETS, ...SONAR_MARKETS].map((m) => ({ ...m, deprecated: false }))\r\n  : [...MARKETS, ...SONAR_MARKETS];\r\n\r\nexport function useMarketsList() {\r\n  return USE_MARKETS.filter(({ name, deprecated }) => !deprecated && !process.env.REACT_APP_EXCLUDE_MARKETS?.includes(name));\r\n}\r\n\r\nexport function useAllMarkets() {\r\n  const connection = useConnection();\r\n  const { customMarkets } = useCustomMarkets();\r\n\r\n  const getAllMarkets = async () => {\r\n    const markets: Array<{\r\n      market: Market;\r\n      marketName: string;\r\n      programId: PublicKey;\r\n    } | null> = await Promise.all(\r\n      getMarketInfos(customMarkets).map(async (marketInfo) => {\r\n        try {\r\n          const market = await Market.load(\r\n            connection,\r\n            marketInfo.address,\r\n            {},\r\n            marketInfo.programId,\r\n          );\r\n          return {\r\n            market,\r\n            marketName: marketInfo.name,\r\n            programId: marketInfo.programId,\r\n          };\r\n        } catch (e) {\r\n          notify({\r\n            message: 'Error loading all market',\r\n            description: e.message,\r\n            type: 'error',\r\n          });\r\n          return null;\r\n        }\r\n      }),\r\n    );\r\n    return markets.filter(\r\n      (m): m is { market: Market; marketName: string; programId: PublicKey } =>\r\n        !!m,\r\n    );\r\n  };\r\n  return useAsyncData(\r\n    getAllMarkets,\r\n    tuple('getAllMarkets', customMarkets.length, connection),\r\n    { refreshInterval: _VERY_SLOW_REFRESH_INTERVAL },\r\n  );\r\n}\r\n\r\nexport function useUnmigratedOpenOrdersAccounts() {\r\n  const connection = useConnection();\r\n  const { wallet } = useWallet();\r\n\r\n  async function getUnmigratedOpenOrdersAccounts(): Promise<OpenOrders[]> {\r\n    if (!wallet || !connection || !wallet.publicKey) {\r\n      return [];\r\n    }\r\n    console.log('refreshing useUnmigratedOpenOrdersAccounts');\r\n    let deprecatedOpenOrdersAccounts: OpenOrders[] = [];\r\n    const deprecatedProgramIds = Array.from(\r\n      new Set(\r\n        USE_MARKETS.filter(\r\n          ({ deprecated }) => deprecated,\r\n        ).map(({ programId }) => programId.toBase58()),\r\n      ),\r\n    ).map((publicKeyStr) => new PublicKey(publicKeyStr));\r\n    let programId: PublicKey;\r\n    for (programId of deprecatedProgramIds) {\r\n      try {\r\n        const openOrdersAccounts = await OpenOrders.findForOwner(\r\n          connection,\r\n          wallet.publicKey,\r\n          programId,\r\n        );\r\n        deprecatedOpenOrdersAccounts = deprecatedOpenOrdersAccounts.concat(\r\n          openOrdersAccounts\r\n            .filter(\r\n              (openOrders) =>\r\n                openOrders.baseTokenTotal.toNumber() ||\r\n                openOrders.quoteTokenTotal.toNumber(),\r\n            )\r\n            .filter((openOrders) =>\r\n              USE_MARKETS.some(\r\n                (market) =>\r\n                  market.deprecated && market.address.equals(openOrders.market),\r\n              ),\r\n            ),\r\n        );\r\n      } catch (e) {\r\n        console.log(\r\n          'Error loading deprecated markets',\r\n          programId?.toBase58(),\r\n          e.message,\r\n        );\r\n      }\r\n    }\r\n    // Maybe sort\r\n    return deprecatedOpenOrdersAccounts;\r\n  }\r\n\r\n  const cacheKey = tuple(\r\n    'getUnmigratedOpenOrdersAccounts',\r\n    connection,\r\n    wallet?.publicKey?.toBase58(),\r\n  );\r\n  const [accounts] = useAsyncData(getUnmigratedOpenOrdersAccounts, cacheKey, {\r\n    refreshInterval: _VERY_SLOW_REFRESH_INTERVAL,\r\n  });\r\n\r\n  return {\r\n    accounts,\r\n    refresh: (clearCache: boolean) => refreshCache(cacheKey, clearCache),\r\n  };\r\n}\r\n\r\nconst MarketContext: React.Context<null | MarketContextValues> = React.createContext<null | MarketContextValues>(\r\n  null,\r\n);\r\n\r\nconst _VERY_SLOW_REFRESH_INTERVAL = 5000 * 1000;\r\n\r\n// For things that don't really change\r\nconst _SLOW_REFRESH_INTERVAL = 5 * 1000;\r\n\r\n// For things that change frequently\r\nconst _FAST_REFRESH_INTERVAL = 1000;\r\n\r\nexport const DEFAULT_MARKET = USE_MARKETS.find(\r\n  ({ name, deprecated }) => name === 'SRM/USDT' && !deprecated,\r\n);\r\n\r\nexport function getMarketDetails(\r\n  market: Market | undefined | null,\r\n  customMarkets: CustomMarketInfo[],\r\n): FullMarketInfo {\r\n  if (!market) {\r\n    return {};\r\n  }\r\n  const marketInfos = getMarketInfos(customMarkets);\r\n  const marketInfo = marketInfos.find((otherMarket) =>\r\n    otherMarket.address.equals(market.address),\r\n  );\r\n  const baseCurrency =\r\n    (market?.baseMintAddress &&\r\n      [...TOKEN_MINTS, ...SONAR_TOKEN_MINTS].find((token) => token.address.equals(market.baseMintAddress))\r\n        ?.name) ||\r\n    (marketInfo?.baseLabel && `${marketInfo?.baseLabel}*`) ||\r\n    'UNKNOWN';\r\n  const quoteCurrency =\r\n    (market?.quoteMintAddress &&\r\n      [...TOKEN_MINTS, ...SONAR_TOKEN_MINTS].find((token) => token.address.equals(market.quoteMintAddress))\r\n        ?.name) ||\r\n    (marketInfo?.quoteLabel && `${marketInfo?.quoteLabel}*`) ||\r\n    'UNKNOWN';\r\n\r\n  return {\r\n    ...marketInfo,\r\n    marketName: marketInfo?.name,\r\n    baseCurrency,\r\n    quoteCurrency,\r\n    marketInfo,\r\n  };\r\n}\r\n\r\nexport function useCustomMarkets() {\r\n  const [customMarkets, setCustomMarkets] = useLocalStorageState<\r\n    CustomMarketInfo[]\r\n  >('customMarkets', []);\r\n  return { customMarkets, setCustomMarkets };\r\n}\r\n\r\nexport function MarketProvider({ marketAddress, setMarketAddress, children }) {\r\n  const { customMarkets, setCustomMarkets } = useCustomMarkets();\r\n\r\n  const address = marketAddress && new PublicKey(marketAddress);\r\n  const connection = useConnection();\r\n  const marketInfos = getMarketInfos(customMarkets);\r\n  const marketInfo =\r\n    address && marketInfos.find((market) => market.address.equals(address));\r\n\r\n  // Replace existing market with a non-deprecated one on first load\r\n  useEffect(() => {\r\n    if (marketInfo && marketInfo.deprecated) {\r\n      console.log('Switching markets from deprecated', marketInfo);\r\n      if (DEFAULT_MARKET) {\r\n        setMarketAddress(DEFAULT_MARKET.address.toBase58());\r\n      }\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  const [market, setMarket] = useState<Market | null>();\r\n  useEffect(() => {\r\n    if (\r\n      market &&\r\n      marketInfo &&\r\n      // @ts-ignore\r\n      market._decoded.ownAddress?.equals(marketInfo?.address)\r\n    ) {\r\n      return;\r\n    }\r\n    setMarket(null);\r\n    if (!marketInfo || !marketInfo.address) {\r\n      notify({\r\n        message: 'Error loading market',\r\n        description: 'Please select a market from the dropdown',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n    Market.load(connection, marketInfo.address, {}, marketInfo.programId)\r\n      .then(setMarket)\r\n      .catch((e) =>\r\n        notify({\r\n          message: 'Error loading market',\r\n          description: e.message,\r\n          type: 'error',\r\n        }),\r\n      );\r\n    // eslint-disable-next-line\r\n  }, [connection, marketInfo]);\r\n\r\n  return (\r\n    <MarketContext.Provider\r\n      value={{\r\n        market,\r\n        ...getMarketDetails(market, customMarkets),\r\n        setMarketAddress,\r\n        customMarkets,\r\n        setCustomMarkets,\r\n      }}\r\n    >\r\n      {children}\r\n    </MarketContext.Provider>\r\n  );\r\n}\r\n\r\nexport function getTradePageUrl(marketAddress?: string) {\r\n  if (!marketAddress) {\r\n    const saved = localStorage.getItem('marketAddress');\r\n    if (saved) {\r\n      marketAddress = JSON.parse(saved);\r\n    }\r\n    marketAddress = marketAddress || DEFAULT_MARKET?.address.toBase58() || '';\r\n  }\r\n  return `/market/${marketAddress}`;\r\n}\r\n\r\nexport function useSelectedTokenAccounts(): [\r\n  SelectedTokenAccounts,\r\n  (newSelectedTokenAccounts: SelectedTokenAccounts) => void,\r\n] {\r\n  const [\r\n    selectedTokenAccounts,\r\n    setSelectedTokenAccounts,\r\n  ] = useLocalStorageState<SelectedTokenAccounts>('selectedTokenAccounts', {});\r\n  return [selectedTokenAccounts, setSelectedTokenAccounts];\r\n}\r\n\r\nexport function useMarket() {\r\n  const context = useContext(MarketContext);\r\n  if (!context) {\r\n    throw new Error('Missing market context');\r\n  }\r\n  return context;\r\n}\r\n\r\nexport function useMarkPrice() {\r\n  const [markPrice, setMarkPrice] = useState<null | number>(null);\r\n\r\n  const [orderbook] = useOrderbook();\r\n  const trades = useTrades();\r\n\r\n  useEffect(() => {\r\n    let bb = orderbook?.bids?.length > 0 && Number(orderbook.bids[0][0]);\r\n    let ba = orderbook?.asks?.length > 0 && Number(orderbook.asks[0][0]);\r\n    let last = trades && trades.length > 0 && trades[0].price;\r\n\r\n    let markPrice =\r\n      bb && ba\r\n        ? last\r\n          ? [bb, ba, last].sort((a, b) => a - b)[1]\r\n          : (bb + ba) / 2\r\n        : null;\r\n\r\n    setMarkPrice(markPrice);\r\n  }, [orderbook, trades]);\r\n\r\n  return markPrice;\r\n}\r\n\r\nexport function _useUnfilteredTrades(limit = 10000) {\r\n  const { market } = useMarket();\r\n  const connection = useConnection();\r\n  async function getUnfilteredTrades(): Promise<any[] | null> {\r\n    if (!market || !connection) {\r\n      return null;\r\n    }\r\n    return await market.loadFills(connection, limit);\r\n  }\r\n  const [trades] = useAsyncData(\r\n    getUnfilteredTrades,\r\n    tuple('getUnfilteredTrades', market, connection),\r\n    { refreshInterval: _SLOW_REFRESH_INTERVAL },\r\n  );\r\n  return trades;\r\n  // NOTE: For now, websocket is too expensive since the event queue is large\r\n  // and updates very frequently\r\n\r\n  // let data = useAccountData(market && market._decoded.eventQueue);\r\n  // if (!data) {\r\n  //   return null;\r\n  // }\r\n  // const events = decodeEventQueue(data, limit);\r\n  // return events\r\n  //   .filter((event) => event.eventFlags.fill && event.nativeQuantityPaid.gtn(0))\r\n  //   .map(market.parseFillEvent.bind(market));\r\n}\r\n\r\nexport function useBonfidaTrades() {\r\n  const { market } = useMarket();\r\n  const marketAddress = market?.address.toBase58();\r\n\r\n  async function getBonfidaTrades() {\r\n    if (!marketAddress) {\r\n      return null;\r\n    }\r\n    return await BonfidaApi.getRecentTrades(marketAddress);\r\n  }\r\n\r\n  return useAsyncData(\r\n    getBonfidaTrades,\r\n    tuple('getBonfidaTrades', marketAddress),\r\n    { refreshInterval: _SLOW_REFRESH_INTERVAL },\r\n    false,\r\n  );\r\n}\r\n\r\nexport function useOrderbookAccounts() {\r\n  const { market } = useMarket();\r\n  // @ts-ignore\r\n  let bidData = useAccountData(market && market._decoded.bids);\r\n  // @ts-ignore\r\n  let askData = useAccountData(market && market._decoded.asks);\r\n  return {\r\n    bidOrderbook: market && bidData ? Orderbook.decode(market, bidData) : null,\r\n    askOrderbook: market && askData ? Orderbook.decode(market, askData) : null,\r\n  };\r\n}\r\n\r\nexport function useOrderbook(\r\n  depth = 20,\r\n): [{ bids: number[][]; asks: number[][] }, boolean] {\r\n  const { bidOrderbook, askOrderbook } = useOrderbookAccounts();\r\n  const { market } = useMarket();\r\n  const bids =\r\n    !bidOrderbook || !market\r\n      ? []\r\n      : bidOrderbook.getL2(depth).map(([price, size]) => [price, size]);\r\n  const asks =\r\n    !askOrderbook || !market\r\n      ? []\r\n      : askOrderbook.getL2(depth).map(([price, size]) => [price, size]);\r\n  return [{ bids, asks }, !!bids || !!asks];\r\n}\r\n\r\n// Want the balances table to be fast-updating, dont want open orders to flicker\r\n// TODO: Update to use websocket\r\nexport function useOpenOrdersAccounts(fast = false) {\r\n  const { market } = useMarket();\r\n  const { connected, wallet } = useWallet();\r\n  const connection = useConnection();\r\n  async function getOpenOrdersAccounts() {\r\n    if (!connected || !wallet) {\r\n      return null;\r\n    }\r\n    if (!market) {\r\n      return null;\r\n    }\r\n    return await market.findOpenOrdersAccountsForOwner(\r\n      connection,\r\n      wallet.publicKey,\r\n    );\r\n  }\r\n  return useAsyncData<OpenOrders[] | null>(\r\n    getOpenOrdersAccounts,\r\n    tuple('getOpenOrdersAccounts', wallet, market, connected),\r\n    { refreshInterval: fast ? _FAST_REFRESH_INTERVAL : _SLOW_REFRESH_INTERVAL },\r\n  );\r\n}\r\n\r\nexport function useSelectedOpenOrdersAccount(fast = false) {\r\n  const [accounts] = useOpenOrdersAccounts(fast);\r\n  if (!accounts) {\r\n    return null;\r\n  }\r\n  return accounts[0];\r\n}\r\n\r\nexport function useTokenAccounts(): [\r\n  TokenAccount[] | null | undefined,\r\n  boolean,\r\n] {\r\n  const { connected, wallet } = useWallet();\r\n  const connection = useConnection();\r\n  async function getTokenAccounts() {\r\n    if (!connected || !wallet) {\r\n      return null;\r\n    }\r\n    return await getTokenAccountInfo(connection, wallet.publicKey);\r\n  }\r\n  return useAsyncData(\r\n    getTokenAccounts,\r\n    tuple('getTokenAccounts', wallet, connected),\r\n    { refreshInterval: _SLOW_REFRESH_INTERVAL },\r\n  );\r\n}\r\n\r\nexport function getSelectedTokenAccountForMint(\r\n  accounts: TokenAccount[] | undefined | null,\r\n  mint: PublicKey | undefined,\r\n  selectedPubKey?: string | PublicKey | null,\r\n) {\r\n  if (!accounts || !mint) {\r\n    return null;\r\n  }\r\n  const filtered = accounts.filter(\r\n    ({ effectiveMint, pubkey }) =>\r\n      mint.equals(effectiveMint) &&\r\n      (!selectedPubKey ||\r\n        (typeof selectedPubKey === 'string'\r\n          ? selectedPubKey\r\n          : selectedPubKey.toBase58()) === pubkey.toBase58()),\r\n  );\r\n  return filtered && filtered[0];\r\n}\r\n\r\nexport function useSelectedQuoteCurrencyAccount() {\r\n  const [accounts] = useTokenAccounts();\r\n  const { market } = useMarket();\r\n  const [selectedTokenAccounts] = useSelectedTokenAccounts();\r\n  const mintAddress = market?.quoteMintAddress;\r\n  return getSelectedTokenAccountForMint(\r\n    accounts,\r\n    mintAddress,\r\n    mintAddress && selectedTokenAccounts[mintAddress.toBase58()],\r\n  );\r\n}\r\n\r\nexport function useSelectedBaseCurrencyAccount() {\r\n  const [accounts] = useTokenAccounts();\r\n  const { market } = useMarket();\r\n  const [selectedTokenAccounts] = useSelectedTokenAccounts();\r\n  const mintAddress = market?.baseMintAddress;\r\n  return getSelectedTokenAccountForMint(\r\n    accounts,\r\n    mintAddress,\r\n    mintAddress && selectedTokenAccounts[mintAddress.toBase58()],\r\n  );\r\n}\r\n\r\n// TODO: Update to use websocket\r\nexport function useSelectedQuoteCurrencyBalances() {\r\n  const quoteCurrencyAccount = useSelectedQuoteCurrencyAccount();\r\n  const { market } = useMarket();\r\n  const [accountInfo, loaded] = useAccountInfo(quoteCurrencyAccount?.pubkey);\r\n  if (!market || !quoteCurrencyAccount || !loaded || !accountInfo) {\r\n    return null;\r\n  }\r\n  if (market.quoteMintAddress.equals(TokenInstructions.WRAPPED_SOL_MINT)) {\r\n    return accountInfo?.lamports / 1e9 ?? 0;\r\n  }\r\n  return market.quoteSplSizeToNumber(\r\n    new BN(accountInfo.data.slice(64, 72), 10, 'le'),\r\n  );\r\n}\r\n\r\n// TODO: Update to use websocket\r\nexport function useSelectedBaseCurrencyBalances() {\r\n  const baseCurrencyAccount = useSelectedBaseCurrencyAccount();\r\n  const { market } = useMarket();\r\n  const [accountInfo, loaded] = useAccountInfo(baseCurrencyAccount?.pubkey);\r\n  if (!market || !baseCurrencyAccount || !loaded || !accountInfo) {\r\n    return null;\r\n  }\r\n  if (market.baseMintAddress.equals(TokenInstructions.WRAPPED_SOL_MINT)) {\r\n    return accountInfo?.lamports / 1e9 ?? 0;\r\n  }\r\n  return market.baseSplSizeToNumber(\r\n    new BN(accountInfo.data.slice(64, 72), 10, 'le'),\r\n  );\r\n}\r\n\r\nexport function useOpenOrders() {\r\n  const { market, marketName } = useMarket();\r\n  const openOrdersAccount = useSelectedOpenOrdersAccount();\r\n  const { bidOrderbook, askOrderbook } = useOrderbookAccounts();\r\n  if (!market || !openOrdersAccount || !bidOrderbook || !askOrderbook) {\r\n    return null;\r\n  }\r\n  return market\r\n    .filterForOpenOrders(bidOrderbook, askOrderbook, [openOrdersAccount])\r\n    .map((order) => ({ ...order, marketName, market }));\r\n}\r\n\r\nexport function useTrades(limit = 100) {\r\n  const trades = _useUnfilteredTrades(limit);\r\n  if (!trades) {\r\n    return null;\r\n  }\r\n  // Until partial fills are each given their own fill, use maker fills\r\n  return trades\r\n    .filter(({ eventFlags }) => eventFlags.maker)\r\n    .map((trade) => ({\r\n      ...trade,\r\n      side: trade.side === 'buy' ? 'sell' : 'buy',\r\n    }));\r\n}\r\n\r\nexport function useLocallyStoredFeeDiscountKey(): {\r\n  storedFeeDiscountKey: PublicKey | undefined;\r\n  setStoredFeeDiscountKey: (key: string) => void;\r\n} {\r\n  const [\r\n    storedFeeDiscountKey,\r\n    setStoredFeeDiscountKey,\r\n  ] = useLocalStorageState<string>(`feeDiscountKey`, undefined);\r\n  return {\r\n    storedFeeDiscountKey: storedFeeDiscountKey\r\n      ? new PublicKey(storedFeeDiscountKey)\r\n      : undefined,\r\n    setStoredFeeDiscountKey,\r\n  };\r\n}\r\n\r\nexport function useFeeDiscountKeys(): [\r\n  (\r\n    | {\r\n        pubkey: PublicKey;\r\n        feeTier: number;\r\n        balance: number;\r\n        mint: PublicKey;\r\n      }[]\r\n    | null\r\n    | undefined\r\n  ),\r\n  boolean,\r\n] {\r\n  const { market } = useMarket();\r\n  const { connected, wallet } = useWallet();\r\n  const connection = useConnection();\r\n  const { setStoredFeeDiscountKey } = useLocallyStoredFeeDiscountKey();\r\n  let getFeeDiscountKeys = async () => {\r\n    if (!connected || !wallet) {\r\n      return null;\r\n    }\r\n    if (!market) {\r\n      return null;\r\n    }\r\n    const feeDiscountKey = await market.findFeeDiscountKeys(\r\n      connection,\r\n      wallet.publicKey,\r\n    );\r\n    if (feeDiscountKey) {\r\n      setStoredFeeDiscountKey(feeDiscountKey[0].pubkey.toBase58());\r\n    }\r\n    return feeDiscountKey;\r\n  };\r\n  return useAsyncData(\r\n    getFeeDiscountKeys,\r\n    tuple('getFeeDiscountKeys', wallet, market, connected),\r\n    { refreshInterval: _SLOW_REFRESH_INTERVAL },\r\n  );\r\n}\r\n\r\nexport function useFills(limit = 100) {\r\n  const { marketName } = useMarket();\r\n  const fills = _useUnfilteredTrades(limit);\r\n  const [openOrdersAccounts] = useOpenOrdersAccounts();\r\n  if (!openOrdersAccounts || openOrdersAccounts.length === 0) {\r\n    return null;\r\n  }\r\n  if (!fills) {\r\n    return null;\r\n  }\r\n  return fills\r\n    .filter((fill) =>\r\n      openOrdersAccounts.some((openOrdersAccount) =>\r\n        fill.openOrders.equals(openOrdersAccount.publicKey),\r\n      ),\r\n    )\r\n    .map((fill) => ({ ...fill, marketName }));\r\n}\r\n\r\nexport function useAllOpenOrdersAccounts() {\r\n  const { wallet, connected } = useWallet();\r\n  const connection = useConnection();\r\n  const marketInfos = useMarketInfos();\r\n  const programIds = [\r\n    ...new Set(marketInfos.map((info) => info.programId.toBase58())),\r\n  ].map((stringProgramId) => new PublicKey(stringProgramId));\r\n\r\n  const getAllOpenOrdersAccounts = async () => {\r\n    if (!connected || !wallet) {\r\n      return [];\r\n    }\r\n    return (\r\n      await Promise.all(\r\n        programIds.map((programId) =>\r\n          OpenOrders.findForOwner(connection, wallet.publicKey, programId),\r\n        ),\r\n      )\r\n    ).flat();\r\n  };\r\n  return useAsyncData(\r\n    getAllOpenOrdersAccounts,\r\n    tuple(\r\n      'getAllOpenOrdersAccounts',\r\n      connection,\r\n      connected,\r\n      wallet?.publicKey?.toBase58(),\r\n      marketInfos.length,\r\n      (programIds || []).length,\r\n    ),\r\n    { refreshInterval: _SLOW_REFRESH_INTERVAL },\r\n  );\r\n}\r\n\r\nexport function useAllOpenOrdersBalances() {\r\n  const [\r\n    openOrdersAccounts,\r\n    loadedOpenOrdersAccounts,\r\n  ] = useAllOpenOrdersAccounts();\r\n  const [mintInfos, mintInfosConnected] = useMintInfos();\r\n  const [allMarkets] = useAllMarkets();\r\n  if (!loadedOpenOrdersAccounts || !mintInfosConnected) {\r\n    return {};\r\n  }\r\n\r\n  const marketsByAddress = Object.fromEntries(\r\n    (allMarkets || []).map((m) => [m.market.address.toBase58(), m]),\r\n  );\r\n  const openOrdersBalances: {\r\n    [mint: string]: { market: PublicKey; free: number; total: number }[];\r\n  } = {};\r\n  for (let account of openOrdersAccounts || []) {\r\n    const marketInfo = marketsByAddress[account.market.toBase58()];\r\n    const baseMint = marketInfo?.market.baseMintAddress.toBase58();\r\n    const quoteMint = marketInfo?.market.quoteMintAddress.toBase58();\r\n    if (!(baseMint in openOrdersBalances)) {\r\n      openOrdersBalances[baseMint] = [];\r\n    }\r\n    if (!(quoteMint in openOrdersBalances)) {\r\n      openOrdersBalances[quoteMint] = [];\r\n    }\r\n\r\n    const baseMintInfo = mintInfos && mintInfos[baseMint];\r\n    const baseFree = divideBnToNumber(\r\n      new BN(account.baseTokenFree),\r\n      getTokenMultiplierFromDecimals(baseMintInfo?.decimals || 0),\r\n    );\r\n    const baseTotal = divideBnToNumber(\r\n      new BN(account.baseTokenTotal),\r\n      getTokenMultiplierFromDecimals(baseMintInfo?.decimals || 0),\r\n    );\r\n    const quoteMintInfo = mintInfos && mintInfos[quoteMint];\r\n    const quoteFree = divideBnToNumber(\r\n      new BN(account.quoteTokenFree),\r\n      getTokenMultiplierFromDecimals(quoteMintInfo?.decimals || 0),\r\n    );\r\n    const quoteTotal = divideBnToNumber(\r\n      new BN(account.quoteTokenTotal),\r\n      getTokenMultiplierFromDecimals(quoteMintInfo?.decimals || 0),\r\n    );\r\n\r\n    openOrdersBalances[baseMint].push({\r\n      market: account.market,\r\n      free: baseFree,\r\n      total: baseTotal,\r\n    });\r\n    openOrdersBalances[quoteMint].push({\r\n      market: account.market,\r\n      free: quoteFree,\r\n      total: quoteTotal,\r\n    });\r\n  }\r\n  return openOrdersBalances;\r\n}\r\n\r\nexport const useAllOpenOrders = (): {\r\n  openOrders: { orders: Order[]; marketAddress: string }[] | null | undefined;\r\n  loaded: boolean;\r\n  refreshOpenOrders: () => void;\r\n} => {\r\n  const connection = useConnection();\r\n  const { connected, wallet } = useWallet();\r\n  const [loaded, setLoaded] = useState(false);\r\n  const [refresh, setRefresh] = useState(0);\r\n  const [openOrders, setOpenOrders] = useState<\r\n    { orders: Order[]; marketAddress: string }[] | null | undefined\r\n  >(null);\r\n  const [lastRefresh, setLastRefresh] = useState(0);\r\n\r\n  const refreshOpenOrders = () => {\r\n    if (new Date().getTime() - lastRefresh > 10 * 1000) {\r\n      setRefresh((prev) => prev + 1);\r\n    } else {\r\n      console.log('not refreshing');\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (connected && wallet) {\r\n      const getAllOpenOrders = async () => {\r\n        setLoaded(false);\r\n        const _openOrders: { orders: Order[]; marketAddress: string }[] = [];\r\n        const getOpenOrdersForMarket = async (marketInfo: MarketInfo) => {\r\n          await sleep(1000 * Math.random()); // Try not to hit rate limit\r\n          try {\r\n            const market = await Market.load(\r\n              connection,\r\n              marketInfo.address,\r\n              undefined,\r\n              marketInfo.programId,\r\n            );\r\n            const orders = await market.loadOrdersForOwner(\r\n              connection,\r\n              wallet?.publicKey,\r\n              30000,\r\n            );\r\n            _openOrders.push({\r\n              orders: orders,\r\n              marketAddress: marketInfo.address.toBase58(),\r\n            });\r\n          } catch (e) {\r\n            console.warn(`Error loading open order ${marketInfo.name} - ${e}`);\r\n          }\r\n        };\r\n        await Promise.all(USE_MARKETS.map((m) => getOpenOrdersForMarket(m)));\r\n        setOpenOrders(_openOrders);\r\n        setLastRefresh(new Date().getTime());\r\n        setLoaded(true);\r\n      };\r\n      getAllOpenOrders();\r\n    }\r\n  }, [connection, connected, wallet, refresh]);\r\n  return {\r\n    openOrders: openOrders,\r\n    loaded: loaded,\r\n    refreshOpenOrders: refreshOpenOrders,\r\n  };\r\n};\r\n\r\nexport function useBalances(): Balances[] {\r\n  const baseCurrencyBalances = useSelectedBaseCurrencyBalances();\r\n  const quoteCurrencyBalances = useSelectedQuoteCurrencyBalances();\r\n  const openOrders = useSelectedOpenOrdersAccount(true);\r\n  const { baseCurrency, quoteCurrency, market } = useMarket();\r\n  const baseExists =\r\n    openOrders && openOrders.baseTokenTotal && openOrders.baseTokenFree;\r\n  const quoteExists =\r\n    openOrders && openOrders.quoteTokenTotal && openOrders.quoteTokenFree;\r\n  if (\r\n    baseCurrency === 'UNKNOWN' ||\r\n    quoteCurrency === 'UNKNOWN' ||\r\n    !baseCurrency ||\r\n    !quoteCurrency\r\n  ) {\r\n    return [];\r\n  }\r\n  return [\r\n    {\r\n      market,\r\n      key: `${baseCurrency}${quoteCurrency}${baseCurrency}`,\r\n      coin: baseCurrency,\r\n      wallet: baseCurrencyBalances,\r\n      orders:\r\n        baseExists && market && openOrders\r\n          ? market.baseSplSizeToNumber(\r\n              openOrders.baseTokenTotal.sub(openOrders.baseTokenFree),\r\n            )\r\n          : null,\r\n      openOrders,\r\n      unsettled:\r\n        baseExists && market && openOrders\r\n          ? market.baseSplSizeToNumber(openOrders.baseTokenFree)\r\n          : null,\r\n    },\r\n    {\r\n      market,\r\n      key: `${quoteCurrency}${baseCurrency}${quoteCurrency}`,\r\n      coin: quoteCurrency,\r\n      wallet: quoteCurrencyBalances,\r\n      openOrders,\r\n      orders:\r\n        quoteExists && market && openOrders\r\n          ? market.quoteSplSizeToNumber(\r\n              openOrders.quoteTokenTotal.sub(openOrders.quoteTokenFree),\r\n            )\r\n          : null,\r\n      unsettled:\r\n        quoteExists && market && openOrders\r\n          ? market.quoteSplSizeToNumber(openOrders.quoteTokenFree)\r\n          : null,\r\n    },\r\n  ];\r\n}\r\n\r\nexport function useWalletBalancesForAllMarkets(): {\r\n  mint: string;\r\n  balance: number;\r\n}[] {\r\n  const [tokenAccounts] = useTokenAccounts();\r\n  const { connected } = useWallet();\r\n  const [mintInfos, mintInfosConnected] = useMintInfos();\r\n\r\n  if (!connected || !mintInfosConnected) {\r\n    return [];\r\n  }\r\n\r\n  let balances: { [mint: string]: number } = {};\r\n  for (let account of tokenAccounts || []) {\r\n    if (!account.account) {\r\n      continue;\r\n    }\r\n    let parsedAccount;\r\n    if (account.effectiveMint.equals(WRAPPED_SOL_MINT)) {\r\n      parsedAccount = {\r\n        mint: WRAPPED_SOL_MINT,\r\n        owner: account.pubkey,\r\n        amount: account.account.lamports,\r\n      };\r\n    } else {\r\n      parsedAccount = parseTokenAccountData(account.account.data);\r\n    }\r\n    if (!(parsedAccount.mint.toBase58() in balances)) {\r\n      balances[parsedAccount.mint.toBase58()] = 0;\r\n    }\r\n    const mintInfo = mintInfos && mintInfos[parsedAccount.mint.toBase58()];\r\n    const additionalAmount = divideBnToNumber(\r\n      new BN(parsedAccount.amount),\r\n      getTokenMultiplierFromDecimals(mintInfo?.decimals || 0),\r\n    );\r\n    balances[parsedAccount.mint.toBase58()] += additionalAmount;\r\n  }\r\n  return Object.entries(balances).map(([mint, balance]) => {\r\n    return { mint, balance };\r\n  });\r\n}\r\n\r\nexport function useUnmigratedDeprecatedMarkets() {\r\n  const connection = useConnection();\r\n  const { accounts } = useUnmigratedOpenOrdersAccounts();\r\n  const marketsList =\r\n    accounts &&\r\n    Array.from(new Set(accounts.map((openOrders) => openOrders.market)));\r\n  const deps = marketsList && marketsList.map((m) => m.toBase58());\r\n\r\n  const useUnmigratedDeprecatedMarketsInner = async () => {\r\n    if (!marketsList) {\r\n      return null;\r\n    }\r\n    const getMarket = async (address) => {\r\n      const marketInfo = USE_MARKETS.find((market) =>\r\n        market.address.equals(address),\r\n      );\r\n      if (!marketInfo) {\r\n        console.log('Failed loading market');\r\n        notify({\r\n          message: 'Error loading market',\r\n          type: 'error',\r\n        });\r\n        return null;\r\n      }\r\n      try {\r\n        console.log('Loading market', marketInfo.name);\r\n        // NOTE: Should this just be cached by (connection, marketInfo.address, marketInfo.programId)?\r\n        return await Market.load(\r\n          connection,\r\n          marketInfo.address,\r\n          {},\r\n          marketInfo.programId,\r\n        );\r\n      } catch (e) {\r\n        console.log('Failed loading market', marketInfo.name, e);\r\n        notify({\r\n          message: 'Error loading market',\r\n          description: e.message,\r\n          type: 'error',\r\n        });\r\n        return null;\r\n      }\r\n    };\r\n    return (await Promise.all(marketsList.map(getMarket))).filter((x) => x);\r\n  };\r\n  const [markets] = useAsyncData(\r\n    useUnmigratedDeprecatedMarketsInner,\r\n    tuple(\r\n      'useUnmigratedDeprecatedMarketsInner',\r\n      connection,\r\n      deps && deps.toString(),\r\n    ),\r\n    { refreshInterval: _VERY_SLOW_REFRESH_INTERVAL },\r\n  );\r\n  if (!markets) {\r\n    return null;\r\n  }\r\n  return markets.map((market) => ({\r\n    market,\r\n    openOrdersList: accounts?.filter(\r\n      (openOrders) => market && openOrders.market.equals(market.address),\r\n    ),\r\n  }));\r\n}\r\n\r\nexport function useGetOpenOrdersForDeprecatedMarkets(): {\r\n  openOrders: OrderWithMarketAndMarketName[] | null | undefined;\r\n  loaded: boolean;\r\n  refreshOpenOrders: () => void;\r\n} {\r\n  const { connected, wallet } = useWallet();\r\n  const { customMarkets } = useCustomMarkets();\r\n  const connection = useConnection();\r\n  const marketsAndOrders = useUnmigratedDeprecatedMarkets();\r\n  const marketsList =\r\n    marketsAndOrders && marketsAndOrders.map(({ market }) => market);\r\n\r\n  // This isn't quite right: open order balances could change\r\n  const deps =\r\n    marketsList &&\r\n    marketsList\r\n      .filter((market): market is Market => !!market)\r\n      .map((market) => market.address.toBase58());\r\n\r\n  async function getOpenOrdersForDeprecatedMarkets() {\r\n    if (!connected || !wallet) {\r\n      return null;\r\n    }\r\n    if (!marketsList) {\r\n      return null;\r\n    }\r\n    console.log('refreshing getOpenOrdersForDeprecatedMarkets');\r\n    const getOrders = async (market: Market | null) => {\r\n      if (!market) {\r\n        return null;\r\n      }\r\n      const { marketName } = getMarketDetails(market, customMarkets);\r\n      try {\r\n        console.log('Fetching open orders for', marketName);\r\n        // Can do better than this, we have the open orders accounts already\r\n        return (\r\n          await market.loadOrdersForOwner(connection, wallet.publicKey)\r\n        ).map((order) => ({ marketName, market, ...order }));\r\n      } catch (e) {\r\n        console.log('Failed loading open orders', market.address.toBase58(), e);\r\n        notify({\r\n          message: `Error loading open orders for deprecated ${marketName}`,\r\n          description: e.message,\r\n          type: 'error',\r\n        });\r\n        return null;\r\n      }\r\n    };\r\n    return (await Promise.all(marketsList.map(getOrders)))\r\n      .filter((x): x is OrderWithMarketAndMarketName[] => !!x)\r\n      .flat();\r\n  }\r\n\r\n  const cacheKey = tuple(\r\n    'getOpenOrdersForDeprecatedMarkets',\r\n    connected,\r\n    connection,\r\n    wallet,\r\n    deps && deps.toString(),\r\n  );\r\n  const [openOrders, loaded] = useAsyncData(\r\n    getOpenOrdersForDeprecatedMarkets,\r\n    cacheKey,\r\n    {\r\n      refreshInterval: _VERY_SLOW_REFRESH_INTERVAL,\r\n    },\r\n  );\r\n  console.log('openOrders', openOrders);\r\n  return {\r\n    openOrders,\r\n    loaded,\r\n    refreshOpenOrders: () => refreshCache(cacheKey),\r\n  };\r\n}\r\n\r\nexport function useBalancesForDeprecatedMarkets() {\r\n  const markets = useUnmigratedDeprecatedMarkets();\r\n  const [customMarkets] = useLocalStorageState<CustomMarketInfo[]>(\r\n    'customMarkets',\r\n    [],\r\n  );\r\n  if (!markets) {\r\n    return null;\r\n  }\r\n\r\n  const openOrderAccountBalances: DeprecatedOpenOrdersBalances[] = [];\r\n  markets.forEach(({ market, openOrdersList }) => {\r\n    const { baseCurrency, quoteCurrency, marketName } = getMarketDetails(\r\n      market,\r\n      customMarkets,\r\n    );\r\n    if (!baseCurrency || !quoteCurrency || !market) {\r\n      return;\r\n    }\r\n    (openOrdersList || []).forEach((openOrders) => {\r\n      const inOrdersBase =\r\n        openOrders?.baseTokenTotal &&\r\n        openOrders?.baseTokenFree &&\r\n        market.baseSplSizeToNumber(\r\n          openOrders.baseTokenTotal.sub(openOrders.baseTokenFree),\r\n        );\r\n      const inOrdersQuote =\r\n        openOrders?.quoteTokenTotal &&\r\n        openOrders?.quoteTokenFree &&\r\n        market.baseSplSizeToNumber(\r\n          openOrders.quoteTokenTotal.sub(openOrders.quoteTokenFree),\r\n        );\r\n      const unsettledBase =\r\n        openOrders?.baseTokenFree &&\r\n        market.baseSplSizeToNumber(openOrders.baseTokenFree);\r\n      const unsettledQuote =\r\n        openOrders?.quoteTokenFree &&\r\n        market.baseSplSizeToNumber(openOrders.quoteTokenFree);\r\n\r\n      openOrderAccountBalances.push({\r\n        marketName,\r\n        market,\r\n        coin: baseCurrency,\r\n        key: `${marketName}${baseCurrency}`,\r\n        orders: inOrdersBase,\r\n        unsettled: unsettledBase,\r\n        openOrders,\r\n      });\r\n      openOrderAccountBalances.push({\r\n        marketName,\r\n        market,\r\n        coin: quoteCurrency,\r\n        key: `${marketName}${quoteCurrency}`,\r\n        orders: inOrdersQuote,\r\n        unsettled: unsettledQuote,\r\n        openOrders,\r\n      });\r\n    });\r\n  });\r\n  return openOrderAccountBalances;\r\n}\r\n\r\nexport function getMarketInfos(\r\n  customMarkets: CustomMarketInfo[],\r\n): MarketInfo[] {\r\n  const customMarketsInfo = customMarkets.map((m) => ({\r\n    ...m,\r\n    address: new PublicKey(m.address),\r\n    programId: new PublicKey(m.programId),\r\n    deprecated: false,\r\n  }));\r\n\r\n  return [...customMarketsInfo, ...USE_MARKETS];\r\n}\r\n\r\nexport function useMarketInfos() {\r\n  const { customMarkets } = useCustomMarkets();\r\n  return getMarketInfos(customMarkets);\r\n}\r\n\r\n/**\r\n * If selling, choose min tick size. If buying choose a price\r\n * s.t. given the state of the orderbook, the order will spend\r\n * `cost` cost currency.\r\n *\r\n * @param orderbook serum Orderbook object\r\n * @param cost quantity to spend. Base currency if selling,\r\n *  quote currency if buying.\r\n * @param tickSizeDecimals size of price increment of the market\r\n */\r\nexport function getMarketOrderPrice(\r\n  orderbook: Orderbook,\r\n  cost: number,\r\n  tickSizeDecimals?: number,\r\n) {\r\n  if (orderbook.isBids) {\r\n    return orderbook.market.tickSize;\r\n  }\r\n  let spentCost = 0;\r\n  let price, sizeAtLevel, costAtLevel: number;\r\n  const asks = orderbook.getL2(1000);\r\n  for ([price, sizeAtLevel] of asks) {\r\n    costAtLevel = price * sizeAtLevel;\r\n    if (spentCost + costAtLevel > cost) {\r\n      break;\r\n    }\r\n    spentCost += costAtLevel;\r\n  }\r\n  const sendPrice = Math.min(price * 1.02, asks[0][0] * 1.05);\r\n  let formattedPrice;\r\n  if (tickSizeDecimals) {\r\n    formattedPrice = floorToDecimal(sendPrice, tickSizeDecimals);\r\n  } else {\r\n    formattedPrice = sendPrice;\r\n  }\r\n  return formattedPrice;\r\n}\r\n\r\nexport function getExpectedFillPrice(\r\n  orderbook: Orderbook,\r\n  cost: number,\r\n  tickSizeDecimals?: number,\r\n) {\r\n  let spentCost = 0;\r\n  let avgPrice = 0;\r\n  let price, sizeAtLevel, costAtLevel: number;\r\n  for ([price, sizeAtLevel] of orderbook.getL2(1000)) {\r\n    costAtLevel = (orderbook.isBids ? 1 : price) * sizeAtLevel;\r\n    if (spentCost + costAtLevel > cost) {\r\n      avgPrice += (cost - spentCost) * price;\r\n      spentCost = cost;\r\n      break;\r\n    }\r\n    avgPrice += costAtLevel * price;\r\n    spentCost += costAtLevel;\r\n  }\r\n  const totalAvgPrice = avgPrice / Math.min(cost, spentCost);\r\n  let formattedPrice;\r\n  if (tickSizeDecimals) {\r\n    formattedPrice = floorToDecimal(totalAvgPrice, tickSizeDecimals);\r\n  } else {\r\n    formattedPrice = totalAvgPrice;\r\n  }\r\n  return formattedPrice;\r\n}\r\n\r\nexport function useCurrentlyAutoSettling(): [boolean, (currentlyAutoSettling: boolean) => void] {\r\n  const [currentlyAutoSettling, setCurrentlyAutosettling] = useState<boolean>(false);\r\n  return [currentlyAutoSettling, setCurrentlyAutosettling];\r\n}\r\n","import { useRef, useEffect } from 'react';\r\n\r\nexport function useInterval(callback, delay) {\r\n  const savedCallback = useRef<() => void>();\r\n\r\n  // Remember the latest callback.\r\n  useEffect(() => {\r\n    savedCallback.current = callback;\r\n  }, [callback]);\r\n\r\n  // Set up the interval.\r\n  useEffect(() => {\r\n    function tick() {\r\n      savedCallback.current && savedCallback.current();\r\n    }\r\n    if (delay !== null) {\r\n      let id = setInterval(tick, delay);\r\n      return () => {\r\n        clearInterval(id);\r\n      };\r\n    }\r\n  }, [delay]);\r\n}\r\n","import React from 'react';\r\nimport styled from 'styled-components';\r\n\r\nconst Wrapper = styled.div`\r\n  margin: 5px;\r\n  padding: 20px;\r\n  background-color: #1a2029;\r\n`;\r\n\r\nexport default function FloatingElement({\r\n  style = undefined,\r\n  children,\r\n  stretchVertical = false,\r\n}) {\r\n  return (\r\n    <Wrapper\r\n      style={{\r\n        height: stretchVertical ? 'calc(100% - 10px)' : undefined,\r\n        ...style,\r\n      }}\r\n    >\r\n      {children}\r\n    </Wrapper>\r\n  );\r\n}\r\n","import { Col, Row } from 'antd';\r\nimport React, { useRef, useEffect, useState } from 'react';\r\nimport styled, { css } from 'styled-components';\r\nimport { useMarket, useOrderbook, useMarkPrice } from '../utils/markets';\r\nimport { isEqual, getDecimalCount } from '../utils/utils';\r\nimport { useInterval } from '../utils/useInterval';\r\nimport FloatingElement from './layout/FloatingElement';\r\nimport usePrevious from '../utils/usePrevious';\r\nimport { ArrowUpOutlined, ArrowDownOutlined } from '@ant-design/icons';\r\n\r\nconst Title = styled.div`\r\n  color: rgba(255, 255, 255, 1);\r\n`;\r\n\r\nconst SizeTitle = styled(Row)`\r\n  padding: 20px 0 14px;\r\n  color: #434a59;\r\n`;\r\n\r\nconst MarkPriceTitle = styled(Row)`\r\n  padding: 20px 0 14px;\r\n  font-weight: 700;\r\n`;\r\n\r\nconst Line = styled.div`\r\n  text-align: right;\r\n  float: right;\r\n  height: 100%;\r\n  ${(props) =>\r\n    props['data-width'] &&\r\n    css`\r\n      width: ${props['data-width']};\r\n    `}\r\n  ${(props) =>\r\n    props['data-bgcolor'] &&\r\n    css`\r\n      background-color: ${props['data-bgcolor']};\r\n    `}\r\n`;\r\n\r\nconst Price = styled.div`\r\n  position: absolute;\r\n  right: 5px;\r\n  color: white;\r\n`;\r\n\r\nexport default function Orderbook({ smallScreen, depth = 7, onPrice, onSize }) {\r\n  const markPrice = useMarkPrice();\r\n  const [orderbook] = useOrderbook();\r\n  const { baseCurrency, quoteCurrency } = useMarket();\r\n\r\n  const currentOrderbookData = useRef(null);\r\n  const lastOrderbookData = useRef(null);\r\n\r\n  const [orderbookData, setOrderbookData] = useState(null);\r\n\r\n  useInterval(() => {\r\n    if (\r\n      !currentOrderbookData.current ||\r\n      JSON.stringify(currentOrderbookData.current) !==\r\n        JSON.stringify(lastOrderbookData.current)\r\n    ) {\r\n      let bids = orderbook?.bids || [];\r\n      let asks = orderbook?.asks || [];\r\n\r\n      let sum = (total, [, size], index) =>\r\n        index < depth ? total + size : total;\r\n      let totalSize = bids.reduce(sum, 0) + asks.reduce(sum, 0);\r\n\r\n      let bidsToDisplay = getCumulativeOrderbookSide(bids, totalSize, false);\r\n      let asksToDisplay = getCumulativeOrderbookSide(asks, totalSize, true);\r\n\r\n      currentOrderbookData.current = {\r\n        bids: orderbook?.bids,\r\n        asks: orderbook?.asks,\r\n      };\r\n\r\n      setOrderbookData({ bids: bidsToDisplay, asks: asksToDisplay });\r\n    }\r\n  }, 250);\r\n\r\n  useEffect(() => {\r\n    lastOrderbookData.current = {\r\n      bids: orderbook?.bids,\r\n      asks: orderbook?.asks,\r\n    };\r\n  }, [orderbook]);\r\n\r\n  function getCumulativeOrderbookSide(orders, totalSize, backwards = false) {\r\n    let cumulative = orders\r\n      .slice(0, depth)\r\n      .reduce((cumulative, [price, size], i) => {\r\n        const cumulativeSize = (cumulative[i - 1]?.cumulativeSize || 0) + size;\r\n        cumulative.push({\r\n          price,\r\n          size,\r\n          cumulativeSize,\r\n          sizePercent: Math.round((cumulativeSize / (totalSize || 1)) * 100),\r\n        });\r\n        return cumulative;\r\n      }, []);\r\n    if (backwards) {\r\n      cumulative = cumulative.reverse();\r\n    }\r\n    return cumulative;\r\n  }\r\n\r\n  return (\r\n    <FloatingElement\r\n      style={\r\n        smallScreen ? { flex: 1 } : { height: '500px', overflow: 'hidden' }\r\n      }\r\n    >\r\n      <Title>Orderbook</Title>\r\n      <SizeTitle>\r\n        <Col span={12} style={{ textAlign: 'left' }}>\r\n          Size ({baseCurrency})\r\n        </Col>\r\n        <Col span={12} style={{ textAlign: 'right' }}>\r\n          Price ({quoteCurrency})\r\n        </Col>\r\n      </SizeTitle>\r\n      {orderbookData?.asks.map(({ price, size, sizePercent }) => (\r\n        <OrderbookRow\r\n          key={price + ''}\r\n          price={price}\r\n          size={size}\r\n          side={'sell'}\r\n          sizePercent={sizePercent}\r\n          onPriceClick={() => onPrice(price)}\r\n          onSizeClick={() => onSize(size)}\r\n        />\r\n      ))}\r\n      <MarkPriceComponent markPrice={markPrice} />\r\n      {orderbookData?.bids.map(({ price, size, sizePercent }) => (\r\n        <OrderbookRow\r\n          key={price + ''}\r\n          price={price}\r\n          size={size}\r\n          side={'buy'}\r\n          sizePercent={sizePercent}\r\n          onPriceClick={() => onPrice(price)}\r\n          onSizeClick={() => onSize(size)}\r\n        />\r\n      ))}\r\n    </FloatingElement>\r\n  );\r\n}\r\n\r\nconst OrderbookRow = React.memo(\r\n  ({ side, price, size, sizePercent, onSizeClick, onPriceClick }) => {\r\n    const element = useRef();\r\n\r\n    const { market } = useMarket();\r\n\r\n    useEffect(() => {\r\n      // eslint-disable-next-line\r\n      !element.current?.classList.contains('flash') &&\r\n        element.current?.classList.add('flash');\r\n      const id = setTimeout(\r\n        () =>\r\n          element.current?.classList.contains('flash') &&\r\n          element.current?.classList.remove('flash'),\r\n        250,\r\n      );\r\n      return () => clearTimeout(id);\r\n    }, [price, size]);\r\n\r\n    let formattedSize =\r\n      market?.minOrderSize && !isNaN(size)\r\n        ? Number(size).toFixed(getDecimalCount(market.minOrderSize) + 1)\r\n        : size;\r\n\r\n    let formattedPrice =\r\n      market?.tickSize && !isNaN(price)\r\n        ? Number(price).toFixed(getDecimalCount(market.tickSize) + 1)\r\n        : price;\r\n\r\n    return (\r\n      <Row ref={element} style={{ marginBottom: 1 }} onClick={onSizeClick}>\r\n        <Col span={12} style={{ textAlign: 'left' }}>\r\n          {formattedSize}\r\n        </Col>\r\n        <Col span={12} style={{ textAlign: 'right' }}>\r\n          <Line\r\n            data-width={sizePercent + '%'}\r\n            data-bgcolor={\r\n              side === 'buy'\r\n                ? 'rgba(65, 199, 122, 0.6)'\r\n                : 'rgba(242, 60, 105, 0.6)'\r\n            }\r\n          />\r\n          <Price onClick={onPriceClick}>{formattedPrice}</Price>\r\n        </Col>\r\n      </Row>\r\n    );\r\n  },\r\n  (prevProps, nextProps) =>\r\n    isEqual(prevProps, nextProps, ['price', 'size', 'sizePercent']),\r\n);\r\n\r\nconst MarkPriceComponent = React.memo(\r\n  ({ markPrice }) => {\r\n    const { market } = useMarket();\r\n    const previousMarkPrice = usePrevious(markPrice);\r\n\r\n    let markPriceColor =\r\n      markPrice > previousMarkPrice\r\n        ? '#41C77A'\r\n        : markPrice < previousMarkPrice\r\n        ? '#F23B69'\r\n        : 'white';\r\n\r\n    let formattedMarkPrice =\r\n      markPrice &&\r\n      market?.tickSize &&\r\n      markPrice.toFixed(getDecimalCount(market.tickSize));\r\n\r\n    return (\r\n      <MarkPriceTitle justify=\"center\">\r\n        <Col style={{ color: markPriceColor }}>\r\n          {markPrice > previousMarkPrice && (\r\n            <ArrowUpOutlined style={{ marginRight: 5 }} />\r\n          )}\r\n          {markPrice < previousMarkPrice && (\r\n            <ArrowDownOutlined style={{ marginRight: 5 }} />\r\n          )}\r\n          {formattedMarkPrice || '----'}\r\n        </Col>\r\n      </MarkPriceTitle>\r\n    );\r\n  },\r\n  (prevProps, nextProps) => isEqual(prevProps, nextProps, ['markPrice']),\r\n);\r\n","import { useEffect, useRef } from 'react';\r\n\r\nexport default function usePrevious(value) {\r\n  // The ref object is a generic container whose current property is mutable ...\r\n  // ... and can hold any value, similar to an instance property on a class\r\n  const ref = useRef();\r\n\r\n  // Store current value in ref\r\n  useEffect(() => {\r\n    ref.current = value;\r\n  }, [value]); // Only re-run if value changes\r\n\r\n  // Return previous value (happens before update in useEffect above)\r\n  return ref.current;\r\n}\r\n","import React from 'react';\r\nimport { ConfigProvider, Table } from 'antd';\r\n\r\nexport default function DataTable({\r\n  dataSource,\r\n  columns,\r\n  emptyLabel = 'No data',\r\n  pagination = false,\r\n  loading = false,\r\n  pageSize = 10,\r\n}) {\r\n  const customizeRenderEmpty = () => (\r\n    <div\r\n      style={{\r\n        padding: '20px',\r\n        display: 'flex',\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n      }}\r\n    >\r\n      {emptyLabel}\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <ConfigProvider renderEmpty={customizeRenderEmpty}>\r\n      <Table\r\n        dataSource={dataSource}\r\n        columns={columns}\r\n        pagination={pagination ? { pagination: true, pageSize } : false}\r\n        loading={loading}\r\n      />\r\n    </ConfigProvider>\r\n  );\r\n}\r\n","import { Button } from 'antd';\r\nimport React from 'react';\r\nimport {\r\n  useTokenAccounts,\r\n  getSelectedTokenAccountForMint,\r\n} from '../../utils/markets';\r\nimport DataTable from '../layout/DataTable';\r\nimport { useSendConnection } from '../../utils/connection';\r\nimport { useWallet } from '../../utils/wallet';\r\nimport { settleFunds } from '../../utils/send';\r\nimport { notify } from '../../utils/notifications';\r\n\r\nexport default function BalancesTable({\r\n  balances,\r\n  showMarket,\r\n  hideWalletBalance,\r\n  onSettleSuccess,\r\n}) {\r\n  const [accounts] = useTokenAccounts();\r\n  const connection = useSendConnection();\r\n  const { wallet } = useWallet();\r\n\r\n  async function onSettleFunds(market, openOrders) {\r\n    try {\r\n      await settleFunds({\r\n        market,\r\n        openOrders,\r\n        connection,\r\n        wallet,\r\n        baseCurrencyAccount: getSelectedTokenAccountForMint(\r\n          accounts,\r\n          market?.baseMintAddress,\r\n        ),\r\n        quoteCurrencyAccount: getSelectedTokenAccountForMint(\r\n          accounts,\r\n          market?.quoteMintAddress,\r\n        ),\r\n      });\r\n    } catch (e) {\r\n      notify({\r\n        message: 'Error settling funds',\r\n        description: e.message,\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n    onSettleSuccess && onSettleSuccess();\r\n  }\r\n\r\n  const columns = [\r\n    showMarket\r\n      ? {\r\n          title: 'Market',\r\n          dataIndex: 'marketName',\r\n          key: 'marketName',\r\n        }\r\n      : null,\r\n    {\r\n      title: 'Coin',\r\n      dataIndex: 'coin',\r\n      key: 'coin',\r\n    },\r\n    hideWalletBalance\r\n      ? null\r\n      : {\r\n          title: 'Wallet Balance',\r\n          dataIndex: 'wallet',\r\n          key: 'wallet',\r\n        },\r\n    {\r\n      title: 'Orders',\r\n      dataIndex: 'orders',\r\n      key: 'orders',\r\n    },\r\n    {\r\n      title: 'Unsettled',\r\n      dataIndex: 'unsettled',\r\n      key: 'unsettled',\r\n    },\r\n    {\r\n      key: 'action',\r\n      render: ({ market, openOrders, marketName }) => (\r\n        <div style={{ textAlign: 'right' }}>\r\n          <Button\r\n            ghost\r\n            style={{ marginRight: 12 }}\r\n            onClick={() => onSettleFunds(market, openOrders)}\r\n          >\r\n            Settle {marketName}\r\n          </Button>\r\n        </div>\r\n      ),\r\n    },\r\n  ].filter((x) => x);\r\n  return (\r\n    <DataTable\r\n      emptyLabel=\"No balances\"\r\n      dataSource={balances}\r\n      columns={columns}\r\n      pagination={false}\r\n    />\r\n  );\r\n}\r\n","import React, { useState } from 'react';\r\nimport DataTable from '../layout/DataTable';\r\n\r\nimport styled from 'styled-components';\r\nimport { Button, Col, Row, Tag } from 'antd';\r\nimport { cancelOrder } from '../../utils/send';\r\nimport { useWallet } from '../../utils/wallet';\r\nimport { useSendConnection } from '../../utils/connection';\r\nimport { notify } from '../../utils/notifications';\r\nimport { DeleteOutlined } from '@ant-design/icons';\r\nimport { OrderWithMarketAndMarketName } from '../../utils/types';\r\n\r\nconst CancelButton = styled(Button)`\r\n  color: #f23b69;\r\n  border: 1px solid #f23b69;\r\n`;\r\n\r\nexport default function OpenOrderTable({\r\n  openOrders,\r\n  onCancelSuccess,\r\n  pageSize,\r\n  loading,\r\n  marketFilter,\r\n}: {\r\n  openOrders: OrderWithMarketAndMarketName[] | null | undefined;\r\n  onCancelSuccess?: () => void;\r\n  pageSize?: number;\r\n  loading?: boolean;\r\n  marketFilter?: boolean;\r\n}) {\r\n  let { wallet } = useWallet();\r\n  let connection = useSendConnection();\r\n\r\n  const [cancelId, setCancelId] = useState(null);\r\n\r\n  async function cancel(order) {\r\n    setCancelId(order?.orderId);\r\n    try {\r\n      if (!wallet) {\r\n        return null;\r\n      }\r\n\r\n      await cancelOrder({\r\n        order,\r\n        market: order.market,\r\n        connection,\r\n        wallet,\r\n      });\r\n    } catch (e) {\r\n      notify({\r\n        message: 'Error cancelling order',\r\n        description: e.message,\r\n        type: 'error',\r\n      });\r\n      return;\r\n    } finally {\r\n      setCancelId(null);\r\n    }\r\n    onCancelSuccess && onCancelSuccess();\r\n  }\r\n\r\n  const marketFilters = [\r\n    ...new Set((openOrders || []).map((orderInfos) => orderInfos.marketName)),\r\n  ].map((marketName) => {\r\n    return { text: marketName, value: marketName };\r\n  });\r\n\r\n  const columns = [\r\n    {\r\n      title: 'Market',\r\n      dataIndex: 'marketName',\r\n      key: 'marketName',\r\n      filters: marketFilter ? marketFilters : undefined,\r\n      onFilter: (value, record) => record.marketName.indexOf(value) === 0,\r\n    },\r\n    {\r\n      title: 'Side',\r\n      dataIndex: 'side',\r\n      key: 'side',\r\n      render: (side) => (\r\n        <Tag\r\n          color={side === 'buy' ? '#41C77A' : '#F23B69'}\r\n          style={{ fontWeight: 700 }}\r\n        >\r\n          {side.charAt(0).toUpperCase() + side.slice(1)}\r\n        </Tag>\r\n      ),\r\n      sorter: (a, b) => {\r\n        if (a.side === b.side) {\r\n          return 0;\r\n        } else if (a.side === 'buy') {\r\n          return 1;\r\n        } else {\r\n          return -1;\r\n        }\r\n      },\r\n      showSorterTooltip: false,\r\n    },\r\n    {\r\n      title: 'Size',\r\n      dataIndex: 'size',\r\n      key: 'size',\r\n      sorter: (a, b) => b.size - a.size,\r\n      showSorterTooltip: false,\r\n    },\r\n    {\r\n      title: 'Price',\r\n      dataIndex: 'price',\r\n      key: 'price',\r\n      sorter: (a, b) => b.price - a.price,\r\n      showSorterTooltip: false,\r\n    },\r\n    {\r\n      key: 'orderId',\r\n      render: (order) => (\r\n        <div style={{ textAlign: 'right' }}>\r\n          <CancelButton\r\n            icon={<DeleteOutlined />}\r\n            onClick={() => cancel(order)}\r\n            loading={cancelId + '' === order?.orderId + ''}\r\n          >\r\n            Cancel\r\n          </CancelButton>\r\n        </div>\r\n      ),\r\n    },\r\n  ];\r\n  const dataSource = (openOrders || []).map((order) => ({\r\n    ...order,\r\n    key: order.orderId,\r\n  }));\r\n\r\n  return (\r\n    <Row>\r\n      <Col span={24}>\r\n        <DataTable\r\n          emptyLabel=\"No open orders\"\r\n          dataSource={dataSource}\r\n          columns={columns}\r\n          pagination={true}\r\n          pageSize={pageSize ? pageSize : 5}\r\n          loading={loading !== undefined && loading}\r\n        />\r\n      </Col>\r\n    </Row>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Row, Col, Tag } from 'antd';\r\nimport { useFills, useMarket } from '../../utils/markets';\r\nimport DataTable from '../layout/DataTable';\r\n\r\nexport default function FillsTable() {\r\n  const fills = useFills();\r\n\r\n  const { quoteCurrency } = useMarket();\r\n\r\n  const columns = [\r\n    {\r\n      title: 'Market',\r\n      dataIndex: 'marketName',\r\n      key: 'marketName',\r\n    },\r\n    {\r\n      title: 'Side',\r\n      dataIndex: 'side',\r\n      key: 'side',\r\n      render: (side) => (\r\n        <Tag\r\n          color={side === 'buy' ? '#41C77A' : '#F23B69'}\r\n          style={{ fontWeight: 700 }}\r\n        >\r\n          {side.charAt(0).toUpperCase() + side.slice(1)}\r\n        </Tag>\r\n      ),\r\n    },\r\n    {\r\n      title: `Size`,\r\n      dataIndex: 'size',\r\n      key: 'size',\r\n    },\r\n    {\r\n      title: `Price`,\r\n      dataIndex: 'price',\r\n      key: 'price',\r\n    },\r\n    {\r\n      title: `Liquidity`,\r\n      dataIndex: 'liquidity',\r\n      key: 'liquidity',\r\n    },\r\n    {\r\n      title: quoteCurrency ? `Fees (${quoteCurrency})` : 'Fees',\r\n      dataIndex: 'feeCost',\r\n      key: 'feeCost',\r\n    },\r\n  ];\r\n\r\n  const dataSource = (fills || []).map((fill) => ({\r\n    ...fill,\r\n    key: `${fill.orderId}${fill.side}`,\r\n    liquidity: fill.eventFlags.maker ? 'Maker' : 'Taker',\r\n  }));\r\n\r\n  return (\r\n    <>\r\n      <Row>\r\n        <Col span={24}>\r\n          <DataTable\r\n            dataSource={dataSource}\r\n            columns={columns}\r\n            pagination={true}\r\n            pageSize={5}\r\n            emptyLabel=\"No fills\"\r\n          />\r\n        </Col>\r\n      </Row>\r\n    </>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Row, Col, Typography, Tag } from 'antd';\r\nimport { useFeeDiscountKeys } from '../../utils/markets';\r\nimport DataTable from '../layout/DataTable';\r\nimport { TokenInstructions, getFeeRates } from '@project-serum/serum';\r\nimport { percentFormat } from '../../utils/utils';\r\n\r\nexport default function FeesTable() {\r\n  const [feeAccounts] = useFeeDiscountKeys();\r\n\r\n  const columns = [\r\n    {\r\n      title: 'Fee Tier',\r\n      dataIndex: 'feeTier',\r\n      key: 'feeTier',\r\n      render: (feeTier, row) => (\r\n        <div style={{ display: 'flex' }}>\r\n          <Typography>{feeTier}</Typography>\r\n          {row.index === 0 ? (\r\n            <div style={{ marginLeft: 10 }}>\r\n              <Tag color={'#41C77A'} style={{ fontWeight: 700 }}>\r\n                Selected\r\n              </Tag>\r\n            </div>\r\n          ) : null}\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Taker',\r\n      dataIndex: 'taker',\r\n      key: 'taker',\r\n      render: (feeTier, row) =>\r\n        percentFormat.format(getFeeRates(row.feeTier).taker),\r\n    },\r\n    {\r\n      title: 'Maker',\r\n      dataIndex: 'maker',\r\n      key: 'maker',\r\n      render: (feeTier, row) =>\r\n        percentFormat.format(getFeeRates(row.feeTier).maker),\r\n    },\r\n    {\r\n      title: `Public Key`,\r\n      dataIndex: 'pubkey',\r\n      key: 'pubkey',\r\n      render: (pubkey) => pubkey.toBase58(),\r\n    },\r\n    {\r\n      title: `Balance`,\r\n      dataIndex: 'balance',\r\n      key: 'balance',\r\n    },\r\n    {\r\n      title: `Mint`,\r\n      dataIndex: 'mint',\r\n      key: 'mint',\r\n      render: (_, row) =>\r\n        row.mint.equals(TokenInstructions.SRM_MINT)\r\n          ? 'SRM'\r\n          : row.mint.equals(TokenInstructions.MSRM_MINT)\r\n          ? 'MSRM'\r\n          : 'UNKNOWN',\r\n    },\r\n  ];\r\n\r\n  const dataSource = (feeAccounts || []).map((account, index) => ({\r\n    ...account,\r\n    index,\r\n    key: account.pubkey.toBase58(),\r\n  }));\r\n\r\n  return (\r\n    <>\r\n      <Row>\r\n        <Col span={24}>\r\n          <DataTable\r\n            dataSource={dataSource}\r\n            columns={columns}\r\n            pagination={true}\r\n            pageSize={5}\r\n            emptyLabel=\"No (M)SRM accounts\"\r\n          />\r\n        </Col>\r\n      </Row>\r\n      <Row style={{ marginTop: 8 }}>\r\n        <Col>\r\n          <Typography>\r\n            Holding SRM or MSRM makes you eligible for fee discounts:\r\n          </Typography>\r\n          <FeeScheduleTable />\r\n        </Col>\r\n      </Row>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction FeeScheduleTable() {\r\n  // Representation of serum-js/src/fees.ts\r\n  const dataSource = [\r\n    { feeTier: 0, taker: 0.0022, maker: -0.0003, token: '', balance: '' },\r\n    { feeTier: 1, taker: 0.002, maker: -0.0003, token: 'SRM', balance: 100 },\r\n    { feeTier: 2, taker: 0.0018, maker: -0.0003, token: 'SRM', balance: 1000 },\r\n    { feeTier: 3, taker: 0.0016, maker: -0.0003, token: 'SRM', balance: 10000 },\r\n    {\r\n      feeTier: 4,\r\n      taker: 0.0014,\r\n      maker: -0.0003,\r\n      token: 'SRM',\r\n      balance: 100000,\r\n    },\r\n    {\r\n      feeTier: 5,\r\n      taker: 0.0012,\r\n      maker: -0.0003,\r\n      token: 'SRM',\r\n      balance: 1000000,\r\n    },\r\n    { feeTier: 6, taker: 0.001, maker: -0.0005, token: 'MSRM', balance: 1 },\r\n  ];\r\n  const columns = [\r\n    {\r\n      title: 'Fee Tier',\r\n      dataIndex: 'feeTier',\r\n      key: 'feeTier',\r\n    },\r\n    {\r\n      title: 'Taker',\r\n      dataIndex: 'taker',\r\n      key: 'taker',\r\n      render: (feeTier, row) =>\r\n        percentFormat.format(getFeeRates(row.feeTier).taker),\r\n    },\r\n    {\r\n      title: 'Maker',\r\n      dataIndex: 'maker',\r\n      key: 'maker',\r\n      render: (feeTier, row) =>\r\n        percentFormat.format(getFeeRates(row.feeTier).maker),\r\n    },\r\n    {\r\n      title: 'Requirements',\r\n      dataIndex: 'requirements',\r\n      key: 'requirements',\r\n      render: (_, row) => (\r\n        <Typography>\r\n          {!row.balance ? 'None' : `≥ ${row.balance} ${row.token}`}\r\n        </Typography>\r\n      ),\r\n    },\r\n  ];\r\n  return (\r\n    <DataTable\r\n      dataSource={dataSource.map((info) => ({ ...info, key: info.feeTier }))}\r\n      columns={columns}\r\n    />\r\n  );\r\n}\r\n","import BalancesTable from './BalancesTable';\r\nimport OpenOrderTable from './OpenOrderTable';\r\nimport React from 'react';\r\nimport { Tabs, Typography } from 'antd';\r\nimport FillsTable from './FillsTable';\r\nimport FloatingElement from '../layout/FloatingElement';\r\nimport FeesTable from './FeesTable';\r\nimport { useOpenOrders, useBalances, useMarket } from '../../utils/markets';\r\n\r\nconst { Paragraph } = Typography;\r\nconst { TabPane } = Tabs;\r\n\r\nexport default function Index() {\r\n  const { market } = useMarket();\r\n  return (\r\n    <FloatingElement style={{ flex: 1, paddingTop: 20 }}>\r\n      <Typography>\r\n        <Paragraph style={{ color: 'rgba(255,255,255,0.5)' }}>\r\n          Make sure to go to Balances and click Settle to send out your funds.\r\n        </Paragraph>\r\n        <Paragraph style={{ color: 'rgba(255,255,255,0.5)' }}>\r\n          To fund your wallet, <a href=\"https://www.sollet.io\">sollet.io</a>.\r\n          You can get SOL from FTX, Binance, BitMax, and others. You can get\r\n          other tokens from FTX.{' '}\r\n        </Paragraph>\r\n      </Typography>\r\n      <Tabs defaultActiveKey=\"orders\">\r\n        <TabPane tab=\"Open Orders\" key=\"orders\">\r\n          <OpenOrdersTab />\r\n        </TabPane>\r\n        <TabPane tab=\"Recent Trade History\" key=\"fills\">\r\n          <FillsTable />\r\n        </TabPane>\r\n        <TabPane tab=\"Balances\" key=\"balances\">\r\n          <BalancesTab />\r\n        </TabPane>\r\n        {market && market.supportsSrmFeeDiscounts ? (\r\n          <TabPane tab=\"Fee discounts\" key=\"fees\">\r\n            <FeesTable />\r\n          </TabPane>\r\n        ) : null}\r\n      </Tabs>\r\n    </FloatingElement>\r\n  );\r\n}\r\n\r\nconst OpenOrdersTab = () => {\r\n  const openOrders = useOpenOrders();\r\n\r\n  return <OpenOrderTable openOrders={openOrders} />;\r\n};\r\n\r\nconst BalancesTab = () => {\r\n  const balances = useBalances();\r\n\r\n  return <BalancesTable balances={balances} />;\r\n};\r\n","import React from 'react';\r\nimport { Modal } from 'antd';\r\nimport {\r\n  useSelectedBaseCurrencyAccount,\r\n  useMarket,\r\n  useSelectedQuoteCurrencyAccount,\r\n} from '../utils/markets';\r\nimport { useWallet } from '../utils/wallet';\r\nimport Link from './Link';\r\n\r\nexport default function DepositDialog({ onClose, baseOrQuote }) {\r\n  const { market, baseCurrency, quoteCurrency } = useMarket();\r\n\r\n  const { providerName, providerUrl } = useWallet();\r\n  const baseCurrencyAccount = useSelectedBaseCurrencyAccount();\r\n  const quoteCurrencyAccount = useSelectedQuoteCurrencyAccount();\r\n  let coinMint;\r\n  let account;\r\n  let depositCoin;\r\n  if (baseOrQuote === 'base') {\r\n    coinMint = market?.baseMintAddress;\r\n    account = baseCurrencyAccount;\r\n    depositCoin = baseCurrency;\r\n  } else if (baseOrQuote === 'quote') {\r\n    coinMint = market?.quoteMintAddress;\r\n    account = quoteCurrencyAccount;\r\n    depositCoin = quoteCurrency;\r\n  } else {\r\n    account = null;\r\n  }\r\n  if (!coinMint) {\r\n    return null;\r\n  }\r\n  return (\r\n    <Modal\r\n      title={depositCoin}\r\n      visible={!!coinMint}\r\n      onOk={onClose}\r\n      onCancel={onClose}\r\n    >\r\n      <div style={{ paddingTop: '20px' }}>\r\n        <p style={{ color: 'white' }}>Mint address:</p>\r\n        <p style={{ color: 'rgba(255,255,255,0.5)' }}>{coinMint.toBase58()}</p>\r\n        <div>\r\n          <p style={{ color: 'white' }}>SPL Deposit address:</p>\r\n          <p style={{ color: 'rgba(255,255,255,0.5)' }}>\r\n            {account ? (\r\n              account.pubkey.toBase58()\r\n            ) : (\r\n              <>\r\n                Visit{' '}\r\n                <Link external to={providerUrl}>\r\n                  {providerName}\r\n                </Link>{' '}\r\n                to create an account for this mint\r\n              </>\r\n            )}\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { TokenAccount } from '../utils/types';\r\nimport { useSelectedTokenAccounts } from '../utils/markets';\r\nimport { Button, Col, Select, Typography } from 'antd';\r\nimport { CopyOutlined } from '@ant-design/icons';\r\nimport { abbreviateAddress } from '../utils/utils';\r\nimport { notify } from '../utils/notifications';\r\n\r\nexport default function StandaloneTokenAccountsSelect({\r\n  accounts,\r\n  mint,\r\n  label,\r\n}: {\r\n  accounts: TokenAccount[] | null | undefined;\r\n  mint: string | undefined;\r\n  label?: boolean;\r\n}) {\r\n  const [\r\n    selectedTokenAccounts,\r\n    setSelectedTokenAccounts,\r\n  ] = useSelectedTokenAccounts();\r\n\r\n  let selectedValue: string | undefined;\r\n  if (mint && mint in selectedTokenAccounts) {\r\n    selectedValue = selectedTokenAccounts[mint];\r\n  } else if (accounts && accounts?.length > 0) {\r\n    selectedValue = accounts[0].pubkey.toBase58();\r\n  } else {\r\n    selectedValue = undefined;\r\n  }\r\n\r\n  const setTokenAccountForCoin = (value) => {\r\n    if (!mint) {\r\n      notify({\r\n        message: 'Error selecting token account',\r\n        description: 'Mint is undefined',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n    const newSelectedTokenAccounts = { ...selectedTokenAccounts };\r\n    newSelectedTokenAccounts[mint] = value;\r\n    setSelectedTokenAccounts(newSelectedTokenAccounts);\r\n  };\r\n\r\n  return (\r\n    <React.Fragment>\r\n      {label && <Col span={8}>Token account:</Col>}\r\n      <Col span={label ? 13 : 21}>\r\n        <Select\r\n          style={{ width: '100%' }}\r\n          value={selectedValue}\r\n          onSelect={setTokenAccountForCoin}\r\n        >\r\n          {accounts?.map((account) => (\r\n            <Select.Option\r\n              key={account.pubkey.toBase58()}\r\n              value={account.pubkey.toBase58()}\r\n            >\r\n              <Typography.Text code>\r\n                {label\r\n                  ? abbreviateAddress(account.pubkey, 8)\r\n                  : account.pubkey.toBase58()}\r\n              </Typography.Text>\r\n            </Select.Option>\r\n          ))}\r\n        </Select>\r\n      </Col>\r\n      <Col span={2} offset={1}>\r\n        <Button\r\n          shape=\"round\"\r\n          icon={<CopyOutlined />}\r\n          size={'small'}\r\n          onClick={() =>\r\n            selectedValue && navigator.clipboard.writeText(selectedValue)\r\n          }\r\n        />\r\n      </Col>\r\n    </React.Fragment>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Button } from 'antd';\r\nimport { LinkOutlined } from '@ant-design/icons';\r\n\r\nexport default function LinkAddress({\r\n  title,\r\n  address,\r\n  shorten = false,\r\n}: {\r\n  title?: undefined | any;\r\n  address: string;\r\n  shorten?: boolean;\r\n}) {\r\n  return (\r\n    <div>\r\n      {title && <p style={{ color: 'white' }}>{title}</p>}\r\n      <Button\r\n        type=\"link\"\r\n        icon={<LinkOutlined />}\r\n        href={'https://explorer.solana.com/address/' + address}\r\n        target=\"_blank\"\r\n        rel=\"noopener noreferrer\"\r\n        style={{ cursor: 'pointer' }}\r\n      >\r\n        {shorten ? `${address.slice(0, 4)}...${address.slice(-4)}` : address}\r\n      </Button>\r\n    </div>\r\n  );\r\n}\r\n","import {Button, Col, Divider, Popover, Row} from 'antd';\r\nimport React, {useState} from 'react';\r\nimport FloatingElement from './layout/FloatingElement';\r\nimport styled from 'styled-components';\r\nimport {\r\n  useBalances,\r\n  useMarket,\r\n  useSelectedBaseCurrencyAccount,\r\n  useSelectedOpenOrdersAccount,\r\n  useSelectedQuoteCurrencyAccount,\r\n  useTokenAccounts,\r\n} from '../utils/markets';\r\nimport DepositDialog from './DepositDialog';\r\nimport {useWallet} from '../utils/wallet';\r\nimport Link from './Link';\r\nimport {settleFunds} from '../utils/send';\r\nimport {useSendConnection} from '../utils/connection';\r\nimport {notify} from '../utils/notifications';\r\nimport {Balances} from '../utils/types';\r\nimport StandaloneTokenAccountsSelect from './StandaloneTokenAccountSelect';\r\nimport LinkAddress from './LinkAddress';\r\nimport {InfoCircleOutlined} from '@ant-design/icons';\r\nimport {useInterval} from \"../utils/useInterval\";\r\nimport {useLocalStorageState} from \"../utils/utils\";\r\n\r\nconst RowBox = styled(Row)`\r\n  padding-bottom: 20px;\r\n`;\r\n\r\nconst Tip = styled.p`\r\n  font-size: 12px;\r\n  padding-top: 6px;\r\n`;\r\n\r\nconst ActionButton = styled(Button)`\r\n  color: #2abdd2;\r\n  background-color: #212734;\r\n  border-width: 0px;\r\n`;\r\n\r\nexport default function StandaloneBalancesDisplay() {\r\n  const { baseCurrency, quoteCurrency, market } = useMarket();\r\n  const balances = useBalances();\r\n  const openOrdersAccount = useSelectedOpenOrdersAccount(true);\r\n  const connection = useSendConnection();\r\n  const { providerUrl, providerName, wallet, connected } = useWallet();\r\n  const [baseOrQuote, setBaseOrQuote] = useState('');\r\n  const baseCurrencyAccount = useSelectedBaseCurrencyAccount();\r\n  const quoteCurrencyAccount = useSelectedQuoteCurrencyAccount();\r\n  const [tokenAccounts] = useTokenAccounts();\r\n  const baseCurrencyBalances =\r\n    balances && balances.find((b) => b.coin === baseCurrency);\r\n  const quoteCurrencyBalances =\r\n    balances && balances.find((b) => b.coin === quoteCurrency);\r\n  const [autoSettleEnabled] = useLocalStorageState(\r\n    'autoSettleEnabled',\r\n    true,\r\n  );\r\n  const [lastSettledAt, setLastSettledAt] = useState<number>(0);\r\n\r\n  async function onSettleFunds() {\r\n    if (!wallet) {\r\n      notify({\r\n        message: 'Wallet not connected',\r\n        description: 'wallet is undefined',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (!market) {\r\n      notify({\r\n        message: 'Error settling funds',\r\n        description: 'market is undefined',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n    if (!openOrdersAccount) {\r\n      notify({\r\n        message: 'Error settling funds',\r\n        description: 'Open orders account is undefined',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n    if (!baseCurrencyAccount) {\r\n      notify({\r\n        message: 'Error settling funds',\r\n        description: 'Open orders account is undefined',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n    if (!quoteCurrencyAccount) {\r\n      notify({\r\n        message: 'Error settling funds',\r\n        description: 'Open orders account is undefined',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await settleFunds({\r\n        market,\r\n        openOrders: openOrdersAccount,\r\n        connection,\r\n        wallet,\r\n        baseCurrencyAccount,\r\n        quoteCurrencyAccount,\r\n      });\r\n    } catch (e) {\r\n      notify({\r\n        message: 'Error settling funds',\r\n        description: e.message,\r\n        type: 'error',\r\n      });\r\n    }\r\n  }\r\n\r\n  useInterval(() => {\r\n    const autoSettle = async () => {\r\n      if (!wallet || !market || !openOrdersAccount || !baseCurrencyAccount || !quoteCurrencyAccount || !autoSettleEnabled) {\r\n        return;\r\n      }\r\n      if (!baseCurrencyBalances?.unsettled && !quoteCurrencyBalances?.unsettled) {\r\n        return;\r\n      }\r\n      if (Date.now() - lastSettledAt < 15000) {\r\n        return;\r\n      }\r\n      try {\r\n        console.log('Settling funds...');\r\n        setLastSettledAt(Date.now());\r\n        await settleFunds({\r\n          market,\r\n          openOrders: openOrdersAccount,\r\n          connection,\r\n          wallet,\r\n          baseCurrencyAccount,\r\n          quoteCurrencyAccount,\r\n        });\r\n      } catch (e) {\r\n        console.log('Error auto settling funds: ' + e.message);\r\n        return;\r\n      }\r\n      console.log('Finished settling funds.');\r\n    };\r\n    (\r\n      connected &&\r\n      wallet?.autoApprove &&\r\n      autoSettleEnabled &&\r\n      autoSettle()\r\n    );\r\n  }, 1000);\r\n\r\n  const formattedBalances: [\r\n    string | undefined,\r\n    Balances | undefined,\r\n    string,\r\n    string | undefined,\r\n  ][] = [\r\n    [\r\n      baseCurrency,\r\n      baseCurrencyBalances,\r\n      'base',\r\n      market?.baseMintAddress.toBase58(),\r\n    ],\r\n    [\r\n      quoteCurrency,\r\n      quoteCurrencyBalances,\r\n      'quote',\r\n      market?.quoteMintAddress.toBase58(),\r\n    ],\r\n  ];\r\n\r\n  return (\r\n    <FloatingElement style={{ flex: 1, paddingTop: 10 }}>\r\n      {formattedBalances.map(\r\n        ([currency, balances, baseOrQuote, mint], index) => (\r\n          <React.Fragment key={index}>\r\n            <Divider style={{ borderColor: 'white' }}>\r\n              {currency}{' '}\r\n              {mint && (\r\n                <Popover\r\n                  content={<LinkAddress address={mint} />}\r\n                  placement=\"bottomRight\"\r\n                  title=\"Token mint\"\r\n                  trigger=\"hover\"\r\n                >\r\n                  <InfoCircleOutlined style={{ color: '#2abdd2' }} />\r\n                </Popover>\r\n              )}\r\n            </Divider>\r\n            {connected && (\r\n              <RowBox align=\"middle\" style={{ paddingBottom: 10 }}>\r\n                <StandaloneTokenAccountsSelect\r\n                  accounts={tokenAccounts?.filter(\r\n                    (account) => account.effectiveMint.toBase58() === mint,\r\n                  )}\r\n                  mint={mint}\r\n                  label\r\n                />\r\n              </RowBox>\r\n            )}\r\n            <RowBox\r\n              align=\"middle\"\r\n              justify=\"space-between\"\r\n              style={{ paddingBottom: 12 }}\r\n            >\r\n              <Col>Wallet balance:</Col>\r\n              <Col>{balances && balances.wallet}</Col>\r\n            </RowBox>\r\n            <RowBox\r\n              align=\"middle\"\r\n              justify=\"space-between\"\r\n              style={{ paddingBottom: 12 }}\r\n            >\r\n              <Col>Unsettled balance:</Col>\r\n              <Col>{balances && balances.unsettled}</Col>\r\n            </RowBox>\r\n            <RowBox align=\"middle\" justify=\"space-around\">\r\n              <Col style={{ width: 150 }}>\r\n                <ActionButton\r\n                  block\r\n                  size=\"large\"\r\n                  onClick={() => setBaseOrQuote(baseOrQuote)}\r\n                >\r\n                  Deposit\r\n                </ActionButton>\r\n              </Col>\r\n              <Col style={{ width: 150 }}>\r\n                <ActionButton block size=\"large\" onClick={onSettleFunds}>\r\n                  Settle\r\n                </ActionButton>\r\n              </Col>\r\n            </RowBox>\r\n            <Tip>\r\n              All deposits go to your{' '}\r\n              <Link external to={providerUrl}>\r\n                {providerName}\r\n              </Link>{' '}\r\n              wallet\r\n            </Tip>\r\n          </React.Fragment>\r\n        ),\r\n      )}\r\n      <DepositDialog\r\n        baseOrQuote={baseOrQuote}\r\n        onClose={() => setBaseOrQuote('')}\r\n      />\r\n    </FloatingElement>\r\n  );\r\n}\r\n","import {Button, Input, Radio, Slider, Switch} from 'antd';\r\nimport React, {useEffect, useState} from 'react';\r\nimport styled from 'styled-components';\r\nimport {\r\n  useFeeDiscountKeys,\r\n  useLocallyStoredFeeDiscountKey,\r\n  useMarket,\r\n  useMarkPrice,\r\n  useSelectedBaseCurrencyAccount,\r\n  useSelectedBaseCurrencyBalances,\r\n  useSelectedOpenOrdersAccount,\r\n  useSelectedQuoteCurrencyAccount,\r\n  useSelectedQuoteCurrencyBalances,\r\n} from '../utils/markets';\r\nimport {useWallet} from '../utils/wallet';\r\nimport {notify} from '../utils/notifications';\r\nimport {floorToDecimal, getDecimalCount, roundToDecimal,} from '../utils/utils';\r\nimport {useSendConnection} from '../utils/connection';\r\nimport FloatingElement from './layout/FloatingElement';\r\nimport {getUnixTs, placeOrder} from '../utils/send';\r\nimport {SwitchChangeEventHandler} from 'antd/es/switch';\r\nimport {refreshCache} from '../utils/fetch-loop';\r\nimport tuple from 'immutable-tuple';\r\n\r\nconst SellButton = styled(Button)`\r\n  margin: 20px 0px 0px 0px;\r\n  background: #f23b69;\r\n  border-color: #f23b69;\r\n`;\r\n\r\nconst BuyButton = styled(Button)`\r\n  margin: 20px 0px 0px 0px;\r\n  background: #02bf76;\r\n  border-color: #02bf76;\r\n`;\r\n\r\nconst sliderMarks = {\r\n  0: '0%',\r\n  25: '25%',\r\n  50: '50%',\r\n  75: '75%',\r\n  100: '100%',\r\n};\r\n\r\nexport default function TradeForm({\r\n  style,\r\n  setChangeOrderRef,\r\n}: {\r\n  style?: any;\r\n  setChangeOrderRef?: (\r\n    ref: ({ size, price }: { size?: number; price?: number }) => void,\r\n  ) => void;\r\n}) {\r\n  const [side, setSide] = useState<'buy' | 'sell'>('buy');\r\n  const { baseCurrency, quoteCurrency, market } = useMarket();\r\n  const baseCurrencyBalances = useSelectedBaseCurrencyBalances();\r\n  const quoteCurrencyBalances = useSelectedQuoteCurrencyBalances();\r\n  const baseCurrencyAccount = useSelectedBaseCurrencyAccount();\r\n  const quoteCurrencyAccount = useSelectedQuoteCurrencyAccount();\r\n  const openOrdersAccount = useSelectedOpenOrdersAccount(true);\r\n  const { wallet, connected } = useWallet();\r\n  const sendConnection = useSendConnection();\r\n  const markPrice = useMarkPrice();\r\n  useFeeDiscountKeys();\r\n  const {\r\n    storedFeeDiscountKey: feeDiscountKey,\r\n  } = useLocallyStoredFeeDiscountKey();\r\n\r\n  const [postOnly, setPostOnly] = useState(false);\r\n  const [ioc, setIoc] = useState(false);\r\n  const [baseSize, setBaseSize] = useState<number | undefined>(undefined);\r\n  const [quoteSize, setQuoteSize] = useState<number | undefined>(undefined);\r\n  const [price, setPrice] = useState<number | undefined>(undefined);\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [sizeFraction, setSizeFraction] = useState(0);\r\n\r\n  const availableQuote =\r\n    openOrdersAccount && market\r\n      ? market.quoteSplSizeToNumber(openOrdersAccount.quoteTokenFree)\r\n      : 0;\r\n\r\n  let quoteBalance = (quoteCurrencyBalances || 0) + (availableQuote || 0);\r\n  let baseBalance = baseCurrencyBalances || 0;\r\n  let sizeDecimalCount =\r\n    market?.minOrderSize && getDecimalCount(market.minOrderSize);\r\n  let priceDecimalCount = market?.tickSize && getDecimalCount(market.tickSize);\r\n\r\n  const publicKey = wallet?.publicKey;\r\n\r\n  useEffect(() => {\r\n    setChangeOrderRef && setChangeOrderRef(doChangeOrder);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [setChangeOrderRef]);\r\n\r\n  useEffect(() => {\r\n    baseSize && price && onSliderChange(sizeFraction);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [side]);\r\n\r\n  useEffect(() => {\r\n    updateSizeFraction();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [price, baseSize]);\r\n\r\n  useEffect(() => {\r\n    const warmUpCache = async () => {\r\n      try {\r\n        if (!wallet || !publicKey || !market) {\r\n          console.log(`Skipping refreshing accounts`);\r\n          return;\r\n        }\r\n        const startTime = getUnixTs();\r\n        console.log(`Refreshing accounts for ${market.address}`);\r\n        await market?.findOpenOrdersAccountsForOwner(sendConnection, publicKey);\r\n        await market?.findBestFeeDiscountKey(sendConnection, publicKey);\r\n        const endTime = getUnixTs();\r\n        console.log(\r\n          `Finished refreshing accounts for ${market.address} after ${\r\n            endTime - startTime\r\n          }`,\r\n        );\r\n      } catch (e) {\r\n        console.log(`Encountered error when refreshing trading accounts: ${e}`);\r\n      }\r\n    };\r\n    warmUpCache();\r\n    const id = setInterval(warmUpCache, 30_000);\r\n    return () => clearInterval(id);\r\n  }, [market, sendConnection, wallet, publicKey]);\r\n\r\n  const onSetBaseSize = (baseSize: number | undefined) => {\r\n    setBaseSize(baseSize);\r\n    if (!baseSize) {\r\n      setQuoteSize(undefined);\r\n      return;\r\n    }\r\n    let usePrice = price || markPrice;\r\n    if (!usePrice) {\r\n      setQuoteSize(undefined);\r\n      return;\r\n    }\r\n    const rawQuoteSize = baseSize * usePrice;\r\n    const quoteSize =\r\n      baseSize && roundToDecimal(rawQuoteSize, sizeDecimalCount);\r\n    setQuoteSize(quoteSize);\r\n  };\r\n\r\n  const onSetQuoteSize = (quoteSize: number | undefined) => {\r\n    setQuoteSize(quoteSize);\r\n    if (!quoteSize) {\r\n      setBaseSize(undefined);\r\n      return;\r\n    }\r\n    let usePrice = price || markPrice;\r\n    if (!usePrice) {\r\n      setBaseSize(undefined);\r\n      return;\r\n    }\r\n    const rawBaseSize = quoteSize / usePrice;\r\n    const baseSize = quoteSize && roundToDecimal(rawBaseSize, sizeDecimalCount);\r\n    setBaseSize(baseSize);\r\n  };\r\n\r\n  const doChangeOrder = ({\r\n    size,\r\n    price,\r\n  }: {\r\n    size?: number;\r\n    price?: number;\r\n  }) => {\r\n    const formattedSize = size && roundToDecimal(size, sizeDecimalCount);\r\n    const formattedPrice = price && roundToDecimal(price, priceDecimalCount);\r\n    formattedSize && onSetBaseSize(formattedSize);\r\n    formattedPrice && setPrice(formattedPrice);\r\n  };\r\n\r\n  const updateSizeFraction = () => {\r\n    const rawMaxSize =\r\n      side === 'buy' ? quoteBalance / (price || markPrice || 1) : baseBalance;\r\n    const maxSize = floorToDecimal(rawMaxSize, sizeDecimalCount);\r\n    const sizeFraction = Math.min(((baseSize || 0) / maxSize) * 100, 100);\r\n    setSizeFraction(sizeFraction);\r\n  };\r\n\r\n  const onSliderChange = (value) => {\r\n    if (!price && markPrice) {\r\n      let formattedMarkPrice: number | string = priceDecimalCount\r\n        ? markPrice.toFixed(priceDecimalCount)\r\n        : markPrice;\r\n      setPrice(\r\n        typeof formattedMarkPrice === 'number'\r\n          ? formattedMarkPrice\r\n          : parseFloat(formattedMarkPrice),\r\n      );\r\n    }\r\n\r\n    let newSize;\r\n    if (side === 'buy') {\r\n      if (price || markPrice) {\r\n        newSize = ((quoteBalance / (price || markPrice || 1)) * value) / 100;\r\n      }\r\n    } else {\r\n      newSize = (baseBalance * value) / 100;\r\n    }\r\n\r\n    // round down to minOrderSize increment\r\n    let formatted = floorToDecimal(newSize, sizeDecimalCount);\r\n\r\n    onSetBaseSize(formatted);\r\n  };\r\n\r\n  const postOnChange: SwitchChangeEventHandler = (checked) => {\r\n    if (checked) {\r\n      setIoc(false);\r\n    }\r\n    setPostOnly(checked);\r\n  };\r\n  const iocOnChange: SwitchChangeEventHandler = (checked) => {\r\n    if (checked) {\r\n      setPostOnly(false);\r\n    }\r\n    setIoc(checked);\r\n  };\r\n\r\n  async function onSubmit() {\r\n    if (!price) {\r\n      console.warn('Missing price');\r\n      notify({\r\n        message: 'Missing price',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    } else if (!baseSize) {\r\n      console.warn('Missing size');\r\n      notify({\r\n        message: 'Missing size',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n\r\n    setSubmitting(true);\r\n    try {\r\n      if (!wallet) {\r\n        return null;\r\n      }\r\n\r\n      await placeOrder({\r\n        side,\r\n        price,\r\n        size: baseSize,\r\n        orderType: ioc ? 'ioc' : postOnly ? 'postOnly' : 'limit',\r\n        market,\r\n        connection: sendConnection,\r\n        wallet,\r\n        baseCurrencyAccount: baseCurrencyAccount?.pubkey,\r\n        quoteCurrencyAccount: quoteCurrencyAccount?.pubkey,\r\n        feeDiscountPubkey: feeDiscountKey,\r\n      });\r\n      refreshCache(tuple('getTokenAccounts', wallet, connected));\r\n      setPrice(undefined);\r\n      onSetBaseSize(undefined);\r\n    } catch (e) {\r\n      console.warn(e);\r\n      notify({\r\n        message: 'Error placing order',\r\n        description: e.message,\r\n        type: 'error',\r\n      });\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <FloatingElement\r\n      style={{ display: 'flex', flexDirection: 'column', ...style }}\r\n    >\r\n      <div style={{ flex: 1 }}>\r\n        <Radio.Group\r\n          onChange={(e) => setSide(e.target.value)}\r\n          value={side}\r\n          buttonStyle=\"solid\"\r\n          style={{\r\n            marginBottom: 8,\r\n            width: '100%',\r\n          }}\r\n        >\r\n          <Radio.Button\r\n            value=\"buy\"\r\n            style={{\r\n              width: '50%',\r\n              textAlign: 'center',\r\n              background: side === 'buy' ? '#02bf76' : '',\r\n              borderColor: side === 'buy' ? '#02bf76' : '',\r\n            }}\r\n          >\r\n            BUY\r\n          </Radio.Button>\r\n          <Radio.Button\r\n            value=\"sell\"\r\n            style={{\r\n              width: '50%',\r\n              textAlign: 'center',\r\n              background: side === 'sell' ? '#F23B69' : '',\r\n              borderColor: side === 'sell' ? '#F23B69' : '',\r\n            }}\r\n          >\r\n            SELL\r\n          </Radio.Button>\r\n        </Radio.Group>\r\n        <Input\r\n          style={{ textAlign: 'right', paddingBottom: 8 }}\r\n          addonBefore={<div style={{ width: '30px' }}>Price</div>}\r\n          suffix={\r\n            <span style={{ fontSize: 10, opacity: 0.5 }}>{quoteCurrency}</span>\r\n          }\r\n          value={price}\r\n          type=\"number\"\r\n          step={market?.tickSize || 1}\r\n          onChange={(e) => setPrice(parseFloat(e.target.value))}\r\n        />\r\n        <Input.Group compact style={{ paddingBottom: 8 }}>\r\n          <Input\r\n            style={{ width: 'calc(50% + 30px)', textAlign: 'right' }}\r\n            addonBefore={<div style={{ width: '30px' }}>Size</div>}\r\n            suffix={\r\n              <span style={{ fontSize: 10, opacity: 0.5 }}>{baseCurrency}</span>\r\n            }\r\n            value={baseSize}\r\n            type=\"number\"\r\n            step={market?.minOrderSize || 1}\r\n            onChange={(e) => onSetBaseSize(parseFloat(e.target.value))}\r\n          />\r\n          <Input\r\n            style={{ width: 'calc(50% - 30px)', textAlign: 'right' }}\r\n            suffix={\r\n              <span style={{ fontSize: 10, opacity: 0.5 }}>\r\n                {quoteCurrency}\r\n              </span>\r\n            }\r\n            value={quoteSize}\r\n            type=\"number\"\r\n            step={market?.minOrderSize || 1}\r\n            onChange={(e) => onSetQuoteSize(parseFloat(e.target.value))}\r\n          />\r\n        </Input.Group>\r\n        <Slider\r\n          value={sizeFraction}\r\n          tipFormatter={(value) => `${value}%`}\r\n          marks={sliderMarks}\r\n          onChange={onSliderChange}\r\n        />\r\n        <div style={{ paddingTop: 18 }}>\r\n          {'POST '}\r\n          <Switch\r\n            checked={postOnly}\r\n            onChange={postOnChange}\r\n            style={{ marginRight: 40 }}\r\n          />\r\n          {'IOC '}\r\n          <Switch checked={ioc} onChange={iocOnChange} />\r\n        </div>\r\n      </div>\r\n      {side === 'buy' ? (\r\n        <BuyButton\r\n          disabled={!price || !baseSize}\r\n          onClick={onSubmit}\r\n          block\r\n          type=\"primary\"\r\n          size=\"large\"\r\n          loading={submitting}\r\n        >\r\n          Buy {baseCurrency}\r\n        </BuyButton>\r\n      ) : (\r\n        <SellButton\r\n          disabled={!price || !baseSize}\r\n          onClick={onSubmit}\r\n          block\r\n          type=\"primary\"\r\n          size=\"large\"\r\n          loading={submitting}\r\n        >\r\n          Sell {baseCurrency}\r\n        </SellButton>\r\n      )}\r\n    </FloatingElement>\r\n  );\r\n}\r\n","import { Col, Row } from 'antd';\r\nimport React from 'react';\r\nimport styled from 'styled-components';\r\nimport { useMarket, useBonfidaTrades } from '../utils/markets';\r\nimport { getDecimalCount } from '../utils/utils';\r\nimport FloatingElement from './layout/FloatingElement';\r\nimport { BonfidaTrade } from '../utils/types';\r\n\r\nconst Title = styled.div`\r\n  color: rgba(255, 255, 255, 1);\r\n`;\r\nconst SizeTitle = styled(Row)`\r\n  padding: 20px 0 14px;\r\n  color: #434a59;\r\n`;\r\n\r\nexport default function PublicTrades({ smallScreen }) {\r\n  const { baseCurrency, quoteCurrency, market } = useMarket();\r\n  const [trades, loaded] = useBonfidaTrades();\r\n\r\n  return (\r\n    <FloatingElement\r\n      style={\r\n        smallScreen\r\n          ? { flex: 1 }\r\n          : {\r\n              marginTop: '10px',\r\n              minHeight: '270px',\r\n              maxHeight: 'calc(100vh - 700px)',\r\n            }\r\n      }\r\n    >\r\n      <Title>Recent Market trades</Title>\r\n      <SizeTitle>\r\n        <Col span={8}>Price ({quoteCurrency}) </Col>\r\n        <Col span={8} style={{ textAlign: 'right' }}>\r\n          Size ({baseCurrency})\r\n        </Col>\r\n        <Col span={8} style={{ textAlign: 'right' }}>\r\n          Time\r\n        </Col>\r\n      </SizeTitle>\r\n      {!!trades && loaded && (\r\n        <div\r\n          style={{\r\n            marginRight: '-20px',\r\n            paddingRight: '5px',\r\n            overflowY: 'scroll',\r\n            maxHeight: smallScreen\r\n              ? 'calc(100% - 75px)'\r\n              : 'calc(100vh - 800px)',\r\n          }}\r\n        >\r\n          {trades.map((trade: BonfidaTrade, i: number) => (\r\n            <Row key={i} style={{ marginBottom: 4 }}>\r\n              <Col\r\n                span={8}\r\n                style={{\r\n                  color: trade.side === 'buy' ? '#41C77A' : '#F23B69',\r\n                }}\r\n              >\r\n                {market?.tickSize && !isNaN(trade.price)\r\n                  ? Number(trade.price).toFixed(\r\n                      getDecimalCount(market.tickSize),\r\n                    )\r\n                  : trade.price}\r\n              </Col>\r\n              <Col span={8} style={{ textAlign: 'right' }}>\r\n                {market?.minOrderSize && !isNaN(trade.size)\r\n                  ? Number(trade.size).toFixed(\r\n                      getDecimalCount(market.minOrderSize),\r\n                    )\r\n                  : trade.size}\r\n              </Col>\r\n              <Col span={8} style={{ textAlign: 'right', color: '#434a59' }}>\r\n                {trade.time && new Date(trade.time).toLocaleTimeString()}\r\n              </Col>\r\n            </Row>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </FloatingElement>\r\n  );\r\n}\r\n","import { Button, Divider, Spin, Typography } from 'antd';\r\nimport React from 'react';\r\nimport {\r\n  useGetOpenOrdersForDeprecatedMarkets,\r\n  useBalancesForDeprecatedMarkets,\r\n  useUnmigratedOpenOrdersAccounts,\r\n} from '../utils/markets';\r\nimport FloatingElement from './layout/FloatingElement';\r\nimport CheckOutlined from '@ant-design/icons/lib/icons/CheckOutlined';\r\nimport BalancesTable from './UserInfoTable/BalancesTable';\r\nimport OpenOrderTable from './UserInfoTable/OpenOrderTable';\r\nimport SyncOutlined from '@ant-design/icons/lib/icons/SyncOutlined';\r\n\r\nconst { Title } = Typography;\r\n\r\nexport default function DeprecatedMarketsInstructions({ switchToLiveMarkets }) {\r\n  const balances = useBalancesForDeprecatedMarkets();\r\n  const {\r\n    openOrders,\r\n    loaded,\r\n    refreshOpenOrders,\r\n  } = useGetOpenOrdersForDeprecatedMarkets();\r\n\r\n  const { refresh } = useUnmigratedOpenOrdersAccounts();\r\n  const needToCancelOrders = !openOrders || openOrders.length > 0;\r\n  const filteredBalances =\r\n    balances &&\r\n    balances.filter(({ orders, unsettled }) => orders > 0 || unsettled > 0);\r\n  const needToSettleFunds = filteredBalances && filteredBalances.length > 0;\r\n  return (\r\n    <FloatingElement>\r\n      <Title level={4} style={{ color: 'rgba(255, 255, 255, 1)' }}>\r\n        Migrate new markets\r\n      </Title>\r\n      <Typography>\r\n        Markets on older versions of the DEX or using Wrapped USDT are now deprecated. To migrate over\r\n        to the new markets, please cancel your orders and settle your funds on old markets. To convert\r\n        from Wrapped USDT to Native USDT use sollet.io.\r\n      </Typography>\r\n      <div style={{ marginTop: 20, display: 'flex', justifyContent: 'center' }}>\r\n        <Button onClick={() => refresh(true)}>\r\n          <SyncOutlined /> Refresh data\r\n        </Button>\r\n      </div>\r\n      {!balances ? (\r\n        <Spin size=\"large\" />\r\n      ) : (\r\n        <>\r\n          <Divider>\r\n            {!needToCancelOrders && <CheckOutlined />} Cancel your orders\r\n          </Divider>\r\n          {needToCancelOrders ? (\r\n            loaded ? (\r\n              <OpenOrderTable\r\n                openOrders={openOrders}\r\n                onCancelSuccess={() => {\r\n                  setTimeout(() => {\r\n                    refresh();\r\n                    refreshOpenOrders();\r\n                  }, 1000); // Wait so that on-chain account state reflects the update\r\n                }}\r\n              />\r\n            ) : (\r\n              <Spin size=\"large\" />\r\n            )\r\n          ) : null}\r\n          <Divider>\r\n            {!needToSettleFunds && <CheckOutlined />} Settle your funds\r\n          </Divider>\r\n          {needToSettleFunds && (\r\n            <BalancesTable\r\n              balances={filteredBalances}\r\n              hideWalletBalance\r\n              showMarket\r\n              onSettleSuccess={() => {\r\n                setTimeout(refresh, 1000); // Wait so that on-chain account state reflects the update\r\n              }}\r\n            />\r\n          )}\r\n          <Divider>Switch to upgraded markets</Divider>\r\n          <div style={{ display: 'flex', justifyContent: 'center' }}>\r\n            <Button\r\n              onClick={switchToLiveMarkets}\r\n              disabled={needToSettleFunds || needToCancelOrders}\r\n            >\r\n              Switch to new markets\r\n            </Button>\r\n          </div>\r\n        </>\r\n      )}\r\n    </FloatingElement>\r\n  );\r\n}\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Col, Input, Modal, Row, Typography } from 'antd';\r\nimport { notify } from '../utils/notifications';\r\nimport { isValidPublicKey } from '../utils/utils';\r\nimport { PublicKey } from '@solana/web3.js';\r\nimport { Market, MARKETS, TOKEN_MINTS } from '@project-serum/serum';\r\nimport { useAccountInfo, useConnection } from '../utils/connection';\r\nimport { LoadingOutlined } from '@ant-design/icons';\r\n\r\nconst { Text } = Typography;\r\n\r\nexport default function CustomMarketDialog({\r\n  visible,\r\n  onAddCustomMarket,\r\n  onClose,\r\n}) {\r\n  const connection = useConnection();\r\n\r\n  const [marketId, setMarketId] = useState('');\r\n\r\n  const [marketLabel, setMarketLabel] = useState('');\r\n  const [baseLabel, setBaseLabel] = useState('');\r\n  const [quoteLabel, setQuoteLabel] = useState('');\r\n\r\n  const [market, setMarket] = useState(null);\r\n  const [loadingMarket, setLoadingMarket] = useState(false);\r\n\r\n  const wellFormedMarketId = isValidPublicKey(marketId);\r\n\r\n  const [marketAccountInfo] = useAccountInfo(\r\n    wellFormedMarketId ? new PublicKey(marketId) : null,\r\n  );\r\n  const programId = marketAccountInfo\r\n    ? marketAccountInfo.owner.toBase58()\r\n    : MARKETS.find(({ deprecated }) => !deprecated).programId.toBase58();\r\n\r\n  useEffect(() => {\r\n    if (!wellFormedMarketId || !programId) {\r\n      resetLabels();\r\n      return;\r\n    }\r\n    setLoadingMarket(true);\r\n    Market.load(\r\n      connection,\r\n      new PublicKey(marketId),\r\n      {},\r\n      new PublicKey(programId),\r\n    )\r\n      .then((market) => {\r\n        setMarket(market);\r\n      })\r\n      .catch(() => {\r\n        resetLabels();\r\n        setMarket(null);\r\n      })\r\n      .finally(() => setLoadingMarket(false));\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [connection, marketId, programId]);\r\n\r\n  const resetLabels = () => {\r\n    setMarketLabel(null);\r\n    setBaseLabel(null);\r\n    setQuoteLabel(null);\r\n  };\r\n\r\n  const knownMarket = MARKETS.find(\r\n    (m) =>\r\n      m.address.toBase58() === marketId && m.programId.toBase58() === programId,\r\n  );\r\n  const knownProgram = MARKETS.find(\r\n    (m) => m.programId.toBase58() === programId,\r\n  );\r\n  const knownBaseCurrency =\r\n    market?.baseMintAddress &&\r\n    TOKEN_MINTS.find((token) => token.address.equals(market.baseMintAddress))\r\n      ?.name;\r\n\r\n  const knownQuoteCurrency =\r\n    market?.quoteMintAddress &&\r\n    TOKEN_MINTS.find((token) => token.address.equals(market.quoteMintAddress))\r\n      ?.name;\r\n\r\n  const canSubmit =\r\n    !loadingMarket &&\r\n    !!market &&\r\n    market.publicKey.toBase58() === marketId &&\r\n    marketId &&\r\n    programId &&\r\n    marketLabel &&\r\n    (knownBaseCurrency || baseLabel) &&\r\n    (knownQuoteCurrency || quoteLabel) &&\r\n    wellFormedMarketId;\r\n\r\n  const onSubmit = () => {\r\n    if (!canSubmit) {\r\n      notify({\r\n        message: 'Please fill in all fields with valid values',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n\r\n    let params = {\r\n      address: marketId,\r\n      programId,\r\n      name: marketLabel,\r\n    };\r\n    if (!knownBaseCurrency) {\r\n      params.baseLabel = baseLabel;\r\n    }\r\n    if (!knownQuoteCurrency) {\r\n      params.quoteLabel = quoteLabel;\r\n    }\r\n    onAddCustomMarket(params);\r\n    onDoClose();\r\n  };\r\n\r\n  const onDoClose = () => {\r\n    resetLabels();\r\n    setMarket(null);\r\n    setMarketId(null);\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title={'Add custom market'}\r\n      visible={visible}\r\n      onOk={onSubmit}\r\n      okText={'Add'}\r\n      onCancel={onDoClose}\r\n      okButtonProps={{ disabled: !canSubmit }}\r\n    >\r\n      <div>\r\n        {wellFormedMarketId ? (\r\n          <>\r\n            {!market && !loadingMarket && (\r\n              <Row style={{ marginBottom: 8 }}>\r\n                <Text type=\"danger\">Not a valid market</Text>\r\n              </Row>\r\n            )}\r\n            {market && knownMarket && (\r\n              <Row style={{ marginBottom: 8 }}>\r\n                <Text type=\"warning\">Market known: {knownMarket.name}</Text>\r\n              </Row>\r\n            )}\r\n            {market && !knownProgram && (\r\n              <Row style={{ marginBottom: 8 }}>\r\n                <Text type=\"danger\">Warning: unknown DEX program</Text>\r\n              </Row>\r\n            )}\r\n            {market && knownProgram && knownProgram.deprecated && (\r\n              <Row style={{ marginBottom: 8 }}>\r\n                <Text type=\"warning\">Warning: deprecated DEX program</Text>\r\n              </Row>\r\n            )}\r\n          </>\r\n        ) : (\r\n          <>\r\n            {marketId && !wellFormedMarketId && (\r\n              <Row style={{ marginBottom: 8 }}>\r\n                <Text type=\"danger\">Invalid market ID</Text>\r\n              </Row>\r\n            )}\r\n          </>\r\n        )}\r\n        <Row style={{ marginBottom: 8 }}>\r\n          <Col span={24}>\r\n            <Input\r\n              placeholder=\"Market Id\"\r\n              value={marketId}\r\n              onChange={(e) => setMarketId(e.target.value)}\r\n              suffix={loadingMarket ? <LoadingOutlined /> : null}\r\n            />\r\n          </Col>\r\n        </Row>\r\n\r\n        <Row style={{ marginBottom: 8, marginTop: 8 }}>\r\n          <Col span={24}>\r\n            <Input\r\n              placeholder=\"Market Label\"\r\n              disabled={!market}\r\n              value={marketLabel}\r\n              onChange={(e) => setMarketLabel(e.target.value)}\r\n            />\r\n          </Col>\r\n        </Row>\r\n        <Row gutter={[8]} style={{ marginBottom: 8 }}>\r\n          <Col span={12}>\r\n            <Input\r\n              placeholder=\"Base label\"\r\n              disabled={!market || knownBaseCurrency}\r\n              value={knownBaseCurrency || baseLabel}\r\n              onChange={(e) => setBaseLabel(e.target.value)}\r\n            />\r\n            {market && !knownBaseCurrency && (\r\n              <div style={{ marginTop: 8 }}>\r\n                <Text type=\"warning\">Warning: unknown token</Text>\r\n              </div>\r\n            )}\r\n          </Col>\r\n          <Col span={12}>\r\n            <Input\r\n              placeholder=\"Quote label\"\r\n              disabled={!market || knownQuoteCurrency}\r\n              value={knownQuoteCurrency || quoteLabel}\r\n              onChange={(e) => setQuoteLabel(e.target.value)}\r\n            />\r\n            {market && !knownQuoteCurrency && (\r\n              <div style={{ marginTop: 8 }}>\r\n                <Text type=\"warning\">Warning: unknown token</Text>\r\n              </div>\r\n            )}\r\n          </Col>\r\n        </Row>\r\n      </div>\r\n    </Modal>\r\n  );\r\n}\r\n","import React, { useCallback, useEffect, useRef, useState } from 'react';\r\nimport { Button, Col, Popover, Row, Select, Typography } from 'antd';\r\nimport styled from 'styled-components';\r\nimport Orderbook from '../components/Orderbook';\r\nimport UserInfoTable from '../components/UserInfoTable';\r\nimport StandaloneBalancesDisplay from '../components/StandaloneBalancesDisplay';\r\nimport {\r\n  getMarketInfos,\r\n  getTradePageUrl,\r\n  MarketProvider,\r\n  useMarket,\r\n  useMarketsList,\r\n  useUnmigratedDeprecatedMarkets,\r\n} from '../utils/markets';\r\nimport TradeForm from '../components/TradeForm';\r\nimport TradesTable from '../components/TradesTable';\r\nimport LinkAddress from '../components/LinkAddress';\r\nimport DeprecatedMarketsInstructions from '../components/DeprecatedMarketsInstructions';\r\nimport {\r\n  DeleteOutlined,\r\n  InfoCircleOutlined,\r\n  PlusCircleOutlined,\r\n} from '@ant-design/icons';\r\nimport CustomMarketDialog from '../components/CustomMarketDialog';\r\nimport { notify } from '../utils/notifications';\r\nimport { useHistory, useParams } from 'react-router-dom';\r\nimport { nanoid } from 'nanoid';\r\n\r\nconst { Option, OptGroup } = Select;\r\n\r\nconst Wrapper = styled.div`\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  padding: 16px 16px;\r\n  .borderNone .ant-select-selector {\r\n    border: none !important;\r\n  }\r\n`;\r\n\r\nexport default function TradePage() {\r\n  const { marketAddress } = useParams();\r\n  useEffect(() => {\r\n    if (marketAddress) {\r\n      localStorage.setItem('marketAddress', JSON.stringify(marketAddress));\r\n    }\r\n  }, [marketAddress]);\r\n  const history = useHistory();\r\n  function setMarketAddress(address) {\r\n    history.push(getTradePageUrl(address));\r\n  }\r\n\r\n  return (\r\n    <MarketProvider\r\n      marketAddress={marketAddress}\r\n      setMarketAddress={setMarketAddress}\r\n    >\r\n      <TradePageInner />\r\n    </MarketProvider>\r\n  );\r\n}\r\n\r\nfunction TradePageInner() {\r\n  const {\r\n    market,\r\n    marketName,\r\n    customMarkets,\r\n    setCustomMarkets,\r\n    setMarketAddress,\r\n  } = useMarket();\r\n  const markets = useMarketsList();\r\n  const [handleDeprecated, setHandleDeprecated] = useState(false);\r\n  const [addMarketVisible, setAddMarketVisible] = useState(false);\r\n  const deprecatedMarkets = useUnmigratedDeprecatedMarkets();\r\n  const [dimensions, setDimensions] = useState({\r\n    height: window.innerHeight,\r\n    width: window.innerWidth,\r\n  });\r\n\r\n  useEffect(() => {\r\n    document.title = marketName ? `${marketName} — Sonar DEX` : 'Sonar DEX';\r\n  }, [marketName]);\r\n\r\n  const changeOrderRef = useRef<\r\n    ({ size, price }: { size?: number; price?: number }) => void\r\n  >();\r\n\r\n  useEffect(() => {\r\n    const handleResize = () => {\r\n      setDimensions({\r\n        height: window.innerHeight,\r\n        width: window.innerWidth,\r\n      });\r\n    };\r\n\r\n    window.addEventListener('resize', handleResize);\r\n    return () => window.removeEventListener('resize', handleResize);\r\n  }, []);\r\n\r\n  const width = dimensions?.width;\r\n  const componentProps = {\r\n    onChangeOrderRef: (ref) => (changeOrderRef.current = ref),\r\n    onPrice: useCallback(\r\n      (price) => changeOrderRef.current && changeOrderRef.current({ price }),\r\n      [],\r\n    ),\r\n    onSize: useCallback(\r\n      (size) => changeOrderRef.current && changeOrderRef.current({ size }),\r\n      [],\r\n    ),\r\n  };\r\n  const component = (() => {\r\n    if (handleDeprecated) {\r\n      return (\r\n        <DeprecatedMarketsPage\r\n          switchToLiveMarkets={() => setHandleDeprecated(false)}\r\n        />\r\n      );\r\n    } else if (width < 1000) {\r\n      return <RenderSmaller {...componentProps} />;\r\n    } else if (width < 1450) {\r\n      return <RenderSmall {...componentProps} />;\r\n    } else {\r\n      return <RenderNormal {...componentProps} />;\r\n    }\r\n  })();\r\n\r\n  const onAddCustomMarket = (customMarket) => {\r\n    const marketInfo = getMarketInfos(customMarkets).some(\r\n      (m) => m.address.toBase58() === customMarket.address,\r\n    );\r\n    if (marketInfo) {\r\n      notify({\r\n        message: `A market with the given ID already exists`,\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n    const newCustomMarkets = [...customMarkets, customMarket];\r\n    setCustomMarkets(newCustomMarkets);\r\n    setMarketAddress(customMarket.address);\r\n  };\r\n\r\n  const onDeleteCustomMarket = (address) => {\r\n    const newCustomMarkets = customMarkets.filter((m) => m.address !== address);\r\n    setCustomMarkets(newCustomMarkets);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <CustomMarketDialog\r\n        visible={addMarketVisible}\r\n        onClose={() => setAddMarketVisible(false)}\r\n        onAddCustomMarket={onAddCustomMarket}\r\n      />\r\n      <Wrapper>\r\n        <Row\r\n          align=\"middle\"\r\n          style={{ paddingLeft: 5, paddingRight: 5 }}\r\n          gutter={16}\r\n        >\r\n          <Col>\r\n            <MarketSelector\r\n              markets={markets}\r\n              setHandleDeprecated={setHandleDeprecated}\r\n              placeholder={'Select market'}\r\n              customMarkets={customMarkets}\r\n              onDeleteCustomMarket={onDeleteCustomMarket}\r\n            />\r\n          </Col>\r\n          {market ? (\r\n            <Col>\r\n              <Popover\r\n                content={<LinkAddress address={market.publicKey.toBase58()} />}\r\n                placement=\"bottomRight\"\r\n                title=\"Market address\"\r\n                trigger=\"click\"\r\n              >\r\n                <InfoCircleOutlined style={{ color: '#2abdd2' }} />\r\n              </Popover>\r\n            </Col>\r\n          ) : null}\r\n          <Col>\r\n            <PlusCircleOutlined\r\n              style={{ color: '#2abdd2' }}\r\n              onClick={() => setAddMarketVisible(true)}\r\n            />\r\n          </Col>\r\n          {deprecatedMarkets && deprecatedMarkets.length > 0 && (\r\n            <React.Fragment>\r\n              <Col>\r\n                <Typography>\r\n                  You have unsettled funds on old markets! Please go through\r\n                  them to claim your funds.\r\n                </Typography>\r\n              </Col>\r\n              <Col>\r\n                <Button onClick={() => setHandleDeprecated(!handleDeprecated)}>\r\n                  {handleDeprecated ? 'View new markets' : 'Handle old markets'}\r\n                </Button>\r\n              </Col>\r\n            </React.Fragment>\r\n          )}\r\n        </Row>\r\n        {component}\r\n      </Wrapper>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction MarketSelector({\r\n  markets,\r\n  placeholder,\r\n  setHandleDeprecated,\r\n  customMarkets,\r\n  onDeleteCustomMarket,\r\n}) {\r\n  const { market, setMarketAddress } = useMarket();\r\n\r\n  const onSetMarketAddress = (marketAddress) => {\r\n    setHandleDeprecated(false);\r\n    setMarketAddress(marketAddress);\r\n  };\r\n\r\n  const extractBase = (a) => a.split('/')[0];\r\n  const extractQuote = (a) => a.split('/')[1];\r\n\r\n  const selectedMarket = getMarketInfos(customMarkets)\r\n    .find(\r\n      (proposedMarket) =>\r\n        market?.address && proposedMarket.address.equals(market.address),\r\n    )\r\n    ?.address?.toBase58();\r\n\r\n  return (\r\n    <Select\r\n      showSearch\r\n      size={'large'}\r\n      style={{ width: 200 }}\r\n      placeholder={placeholder || 'Select a market'}\r\n      optionFilterProp=\"name\"\r\n      onSelect={onSetMarketAddress}\r\n      listHeight={400}\r\n      value={selectedMarket}\r\n      filterOption={(input, option) =>\r\n        option?.name?.toLowerCase().indexOf(input.toLowerCase()) >= 0\r\n      }\r\n    >\r\n      {customMarkets && customMarkets.length > 0 && (\r\n        <OptGroup label=\"Custom\">\r\n          {customMarkets.map(({ address, name }, i) => (\r\n            <Option\r\n              value={address}\r\n              key={nanoid()}\r\n              name={name}\r\n              style={{\r\n                padding: '10px',\r\n                // @ts-ignore\r\n                backgroundColor: i % 2 === 0 ? 'rgb(39, 44, 61)' : null,\r\n              }}\r\n            >\r\n              <Row>\r\n                <Col flex=\"auto\">{name}</Col>\r\n                {selectedMarket !== address && (\r\n                  <Col>\r\n                    <DeleteOutlined\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        e.nativeEvent.stopImmediatePropagation();\r\n                        onDeleteCustomMarket && onDeleteCustomMarket(address);\r\n                      }}\r\n                    />\r\n                  </Col>\r\n                )}\r\n              </Row>\r\n            </Option>\r\n          ))}\r\n        </OptGroup>\r\n      )}\r\n      <OptGroup label=\"Markets\">\r\n        {markets\r\n          .sort((a, b) =>\r\n            extractQuote(a.name) === 'USDT' && extractQuote(b.name) !== 'USDT'\r\n              ? -1\r\n              : extractQuote(a.name) !== 'USDT' &&\r\n                extractQuote(b.name) === 'USDT'\r\n              ? 1\r\n              : 0,\r\n          )\r\n          .sort((a, b) =>\r\n            extractBase(a.name) < extractBase(b.name)\r\n              ? -1\r\n              : extractBase(a.name) > extractBase(b.name)\r\n              ? 1\r\n              : 0,\r\n          )\r\n          .map(({ address, name, deprecated }, i) => (\r\n            <Option\r\n              value={address.toBase58()}\r\n              key={nanoid()}\r\n              name={name}\r\n              style={{\r\n                padding: '10px',\r\n                // @ts-ignore\r\n                backgroundColor: i % 2 === 0 ? 'rgb(39, 44, 61)' : null,\r\n              }}\r\n            >\r\n              {name} {deprecated ? ' (Deprecated)' : null}\r\n            </Option>\r\n          ))}\r\n      </OptGroup>\r\n    </Select>\r\n  );\r\n}\r\n\r\nconst DeprecatedMarketsPage = ({ switchToLiveMarkets }) => {\r\n  return (\r\n    <>\r\n      <Row>\r\n        <Col flex=\"auto\">\r\n          <DeprecatedMarketsInstructions\r\n            switchToLiveMarkets={switchToLiveMarkets}\r\n          />\r\n        </Col>\r\n      </Row>\r\n    </>\r\n  );\r\n};\r\n\r\nconst RenderNormal = ({ onChangeOrderRef, onPrice, onSize }) => {\r\n  return (\r\n    <Row\r\n      style={{\r\n        minHeight: '900px',\r\n        flexWrap: 'nowrap',\r\n      }}\r\n    >\r\n      <Col flex=\"auto\" style={{ height: '100%', display: 'flex' }}>\r\n        <UserInfoTable />\r\n      </Col>\r\n      <Col flex={'360px'} style={{ height: '100%' }}>\r\n        <Orderbook smallScreen={false} onPrice={onPrice} onSize={onSize} />\r\n        <TradesTable smallScreen={false} />\r\n      </Col>\r\n      <Col\r\n        flex=\"400px\"\r\n        style={{ height: '100%', display: 'flex', flexDirection: 'column' }}\r\n      >\r\n        <TradeForm setChangeOrderRef={onChangeOrderRef} />\r\n        <StandaloneBalancesDisplay />\r\n      </Col>\r\n    </Row>\r\n  );\r\n};\r\n\r\nconst RenderSmall = ({ onChangeOrderRef, onPrice, onSize }) => {\r\n  return (\r\n    <>\r\n      <Row\r\n        style={{\r\n          height: '900px',\r\n        }}\r\n      >\r\n        <Col flex=\"auto\" style={{ height: '100%', display: 'flex' }}>\r\n          <Orderbook\r\n            smallScreen={true}\r\n            depth={13}\r\n            onPrice={onPrice}\r\n            onSize={onSize}\r\n          />\r\n        </Col>\r\n        <Col flex=\"auto\" style={{ height: '100%', display: 'flex' }}>\r\n          <TradesTable smallScreen={true} />\r\n        </Col>\r\n        <Col\r\n          flex=\"400px\"\r\n          style={{ height: '100%', display: 'flex', flexDirection: 'column' }}\r\n        >\r\n          <TradeForm setChangeOrderRef={onChangeOrderRef} />\r\n          <StandaloneBalancesDisplay />\r\n        </Col>\r\n      </Row>\r\n      <Row>\r\n        <Col flex=\"auto\">\r\n          <UserInfoTable />\r\n        </Col>\r\n      </Row>\r\n    </>\r\n  );\r\n};\r\n\r\nconst RenderSmaller = ({ onChangeOrderRef, onPrice, onSize }) => {\r\n  return (\r\n    <>\r\n      <Row>\r\n        <Col xs={24} sm={12} style={{ height: '100%', display: 'flex' }}>\r\n          <TradeForm style={{ flex: 1 }} setChangeOrderRef={onChangeOrderRef} />\r\n        </Col>\r\n        <Col xs={24} sm={12}>\r\n          <StandaloneBalancesDisplay />\r\n        </Col>\r\n      </Row>\r\n      <Row\r\n        style={{\r\n          height: '500px',\r\n        }}\r\n      >\r\n        <Col xs={24} sm={12} style={{ height: '100%', display: 'flex' }}>\r\n          <Orderbook smallScreen={true} onPrice={onPrice} onSize={onSize} />\r\n        </Col>\r\n        <Col xs={24} sm={12} style={{ height: '100%', display: 'flex' }}>\r\n          <TradesTable smallScreen={true} />\r\n        </Col>\r\n      </Row>\r\n      <Row>\r\n        <Col flex=\"auto\">\r\n          <UserInfoTable />\r\n        </Col>\r\n      </Row>\r\n    </>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { Dropdown, Menu } from 'antd';\r\nimport { useWallet } from '../utils/wallet';\r\nimport LinkAddress from './LinkAddress';\r\n\r\nexport default function WalletConnect() {\r\n  const { connected, wallet, select, connect, disconnect } = useWallet();\r\n  const publicKey = (connected && wallet?.publicKey?.toBase58()) || '';\r\n\r\n  const menu = (\r\n    <Menu>\r\n      {connected && <LinkAddress shorten={true} address={publicKey} />}\r\n      <Menu.Item key=\"3\" onClick={select}>\r\n        Change Wallet\r\n      </Menu.Item>\r\n    </Menu>\r\n  );\r\n\r\n  return (\r\n    <Dropdown.Button onClick={connected ? disconnect : connect} overlay={menu}>\r\n      {connected ? 'Disconnect' : 'Connect'}\r\n    </Dropdown.Button>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport FloatingElement from '../components/layout/FloatingElement';\r\nimport {\r\n  useAllMarkets,\r\n  useAllOpenOrders,\r\n  useMarketInfos,\r\n} from '../utils/markets';\r\nimport OpenOrderTable from '../components/UserInfoTable/OpenOrderTable';\r\nimport { Button, Row } from 'antd';\r\nimport { OrderWithMarketAndMarketName } from '../utils/types';\r\nimport { useWallet } from '../utils/wallet';\r\nimport WalletConnect from '../components/WalletConnect';\r\n\r\nexport default function OpenOrdersPage() {\r\n  const { connected } = useWallet();\r\n  const { openOrders, loaded, refreshOpenOrders } = useAllOpenOrders();\r\n  let marketInfos = useMarketInfos();\r\n  let marketAddressesToNames = Object.fromEntries(\r\n    marketInfos.map((info) => [info.address.toBase58(), info.name]),\r\n  );\r\n  let [allMarkets] = useAllMarkets();\r\n  const marketsByAddress = Object.fromEntries(\r\n    (allMarkets || []).map((marketInfo) => [\r\n      marketInfo.market.address.toBase58(),\r\n      marketInfo.market,\r\n    ]),\r\n  );\r\n\r\n  const dataSource: OrderWithMarketAndMarketName[] = (openOrders || [])\r\n    .map((orderInfos) =>\r\n      orderInfos.orders.map((order) => {\r\n        return {\r\n          marketName: marketAddressesToNames[orderInfos.marketAddress],\r\n          market: marketsByAddress[orderInfos.marketAddress],\r\n          ...order,\r\n        };\r\n      }),\r\n    )\r\n    .flat();\r\n\r\n  if (!connected) {\r\n    return (\r\n      <Row\r\n        justify=\"center\"\r\n        style={{\r\n          marginTop: '10%',\r\n        }}\r\n      >\r\n        <WalletConnect />\r\n      </Row>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <FloatingElement style={{ flex: 1, paddingTop: 10 }}>\r\n      <Button onClick={refreshOpenOrders} loading={!loaded}>\r\n        Refresh\r\n      </Button>\r\n      <OpenOrderTable\r\n        openOrders={dataSource}\r\n        pageSize={25}\r\n        loading={!loaded}\r\n        onCancelSuccess={refreshOpenOrders}\r\n        marketFilter\r\n      />\r\n    </FloatingElement>\r\n  );\r\n}\r\n","import React, { useState } from 'react';\r\nimport DataTable from '../layout/DataTable';\r\nimport { Button, Row } from 'antd';\r\nimport { settleAllFunds } from '../../utils/send';\r\nimport { notify } from '../../utils/notifications';\r\nimport { useConnection } from '../../utils/connection';\r\nimport { useWallet } from '../../utils/wallet';\r\nimport {\r\n  useAllMarkets,\r\n  useSelectedTokenAccounts,\r\n  useTokenAccounts,\r\n} from '../../utils/markets';\r\nimport StandaloneTokenAccountsSelect from '../StandaloneTokenAccountSelect';\r\nimport { abbreviateAddress } from '../../utils/utils';\r\nimport { PublicKey } from '@solana/web3.js';\r\n\r\nexport default function WalletBalancesTable({\r\n  walletBalances,\r\n}: {\r\n  walletBalances: {\r\n    coin: string;\r\n    mint: string;\r\n    walletBalance: number;\r\n    openOrdersFree: number;\r\n    openOrdersTotal: number;\r\n  }[];\r\n}) {\r\n  const connection = useConnection();\r\n  const { wallet, connected } = useWallet();\r\n  const [selectedTokenAccounts] = useSelectedTokenAccounts();\r\n  const [tokenAccounts, tokenAccountsConnected] = useTokenAccounts();\r\n  const [allMarkets, allMarketsConnected] = useAllMarkets();\r\n  const [settlingFunds, setSettlingFunds] = useState(false);\r\n\r\n  async function onSettleFunds() {\r\n    setSettlingFunds(true);\r\n    try {\r\n      if (!wallet) {\r\n        notify({\r\n          message: 'Wallet not connected',\r\n          description: 'Wallet not connected',\r\n          type: 'error',\r\n        });\r\n        return;\r\n      }\r\n\r\n      if (!tokenAccounts || !tokenAccountsConnected) {\r\n        notify({\r\n          message: 'Error settling funds',\r\n          description: 'TokenAccounts not connected',\r\n          type: 'error',\r\n        });\r\n        return;\r\n      }\r\n      if (!allMarkets || !allMarketsConnected) {\r\n        notify({\r\n          message: 'Error settling funds',\r\n          description: 'Markets not connected',\r\n          type: 'error',\r\n        });\r\n        return;\r\n      }\r\n      await settleAllFunds({\r\n        connection,\r\n        tokenAccounts,\r\n        selectedTokenAccounts,\r\n        wallet,\r\n        markets: allMarkets.map((marketInfo) => marketInfo.market),\r\n      });\r\n    } catch (e) {\r\n      notify({\r\n        message: 'Error settling funds',\r\n        description: e.message,\r\n        type: 'error',\r\n      });\r\n    } finally {\r\n      setSettlingFunds(false);\r\n    }\r\n  }\r\n\r\n  const columns = [\r\n    {\r\n      title: 'Coin',\r\n      key: 'coin',\r\n      width: '20%',\r\n      render: (walletBalance) => (\r\n        <Row align=\"middle\">\r\n          <a\r\n            href={`https://explorer.solana.com/address/${walletBalance.mint}`}\r\n            target={'_blank'}\r\n            rel=\"noopener noreferrer\"\r\n          >\r\n            {walletBalance.coin ||\r\n              abbreviateAddress(new PublicKey(walletBalance.mint))}\r\n          </a>\r\n        </Row>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Wallet Balance',\r\n      dataIndex: 'walletBalance',\r\n      key: 'walletBalance',\r\n      width: '20%',\r\n    },\r\n    {\r\n      title: 'Open orders total balances',\r\n      dataIndex: 'openOrdersTotal',\r\n      key: 'openOrdersTotal',\r\n      width: '20%',\r\n    },\r\n    {\r\n      title: 'Unsettled balances',\r\n      dataIndex: 'openOrdersFree',\r\n      key: 'openOrdersFree',\r\n      width: '20%',\r\n    },\r\n    {\r\n      title: 'Selected token account',\r\n      key: 'selectTokenAccount',\r\n      width: '20%',\r\n      render: (walletBalance) => (\r\n        <Row align=\"middle\" style={{ width: '430px' }}>\r\n          <StandaloneTokenAccountsSelect\r\n            accounts={tokenAccounts?.filter(\r\n              (t) => t.effectiveMint.toBase58() === walletBalance.mint,\r\n            )}\r\n            mint={walletBalance.mint}\r\n          />\r\n        </Row>\r\n      ),\r\n    },\r\n  ];\r\n  return (\r\n    <React.Fragment>\r\n      <DataTable\r\n        emptyLabel=\"No balances\"\r\n        dataSource={walletBalances}\r\n        columns={columns}\r\n        pagination={false}\r\n      />\r\n      {connected && (\r\n        <Button onClick={onSettleFunds} loading={settlingFunds}>\r\n          Settle all funds\r\n        </Button>\r\n      )}\r\n    </React.Fragment>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Tabs } from 'antd';\r\nimport {\r\n  useAllOpenOrdersBalances,\r\n  useWalletBalancesForAllMarkets,\r\n} from '../utils/markets';\r\nimport FloatingElement from '../components/layout/FloatingElement';\r\nimport WalletBalancesTable from '../components/UserInfoTable/WalletBalancesTable';\r\nimport { useMintToTickers } from '../utils/tokens';\r\n\r\nconst { TabPane } = Tabs;\r\n\r\nexport default function BalancesPage() {\r\n  const walletBalances = useWalletBalancesForAllMarkets();\r\n  const mintToTickers = useMintToTickers();\r\n  const openOrdersBalances = useAllOpenOrdersBalances();\r\n\r\n  const data = (walletBalances || []).map((balance) => {\r\n    const balances = {\r\n      coin: mintToTickers[balance.mint],\r\n      mint: balance.mint,\r\n      walletBalance: balance.balance,\r\n      openOrdersFree: 0,\r\n      openOrdersTotal: 0,\r\n    };\r\n    for (let openOrdersAccount of openOrdersBalances[balance.mint] || []) {\r\n      balances['openOrdersFree'] += openOrdersAccount.free;\r\n      balances['openOrdersTotal'] += openOrdersAccount.total;\r\n    }\r\n    return balances;\r\n  });\r\n\r\n  return (\r\n    <FloatingElement style={{ flex: 1, paddingTop: 10 }}>\r\n      <Tabs defaultActiveKey=\"walletBalances\">\r\n        <TabPane tab=\"Wallet Balances\" key=\"walletBalances\">\r\n          <WalletBalancesTable walletBalances={data} />\r\n        </TabPane>\r\n      </Tabs>\r\n    </FloatingElement>\r\n  );\r\n}\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Button, Col, Input, Row, Select, Typography } from 'antd';\r\nimport styled from 'styled-components';\r\nimport { Orderbook } from '@project-serum/serum';\r\nimport {\r\n  getExpectedFillPrice,\r\n  getMarketDetails,\r\n  getMarketInfos,\r\n  getMarketOrderPrice,\r\n  getSelectedTokenAccountForMint,\r\n  MarketProvider,\r\n  useBalances,\r\n  useCustomMarkets,\r\n  useLocallyStoredFeeDiscountKey,\r\n  useMarket,\r\n  useTokenAccounts,\r\n} from '../utils/markets';\r\nimport { notify } from '../utils/notifications';\r\nimport { useWallet } from '../utils/wallet';\r\nimport { useConnection, useSendConnection } from '../utils/connection';\r\nimport { placeOrder } from '../utils/send';\r\nimport { floorToDecimal, getDecimalCount } from '../utils/utils';\r\nimport FloatingElement from './layout/FloatingElement';\r\nimport WalletConnect from './WalletConnect';\r\nimport { SwapOutlined } from '@ant-design/icons';\r\nimport { CustomMarketInfo } from '../utils/types';\r\nimport { WalletAdapter } from '../wallet-adapters';\r\n\r\nconst { Option } = Select;\r\nconst { Title } = Typography;\r\n\r\nconst ActionButton = styled(Button)`\r\n  color: #2abdd2;\r\n  background-color: #212734;\r\n  border-width: 0px;\r\n`;\r\n\r\nconst ConvertButton = styled(Button)`\r\n  background: #02bf76;\r\n  border-color: #02bf76;\r\n`;\r\n\r\nexport default function ConvertForm() {\r\n  const { connected, wallet } = useWallet();\r\n  const { customMarkets } = useCustomMarkets();\r\n  const marketInfos = getMarketInfos(customMarkets);\r\n  const [marketAddress, setMarketAddress] = useState<string | null>(null);\r\n\r\n  const [fromToken, setFromToken] = useState<string | undefined>(undefined);\r\n  const [toToken, setToToken] = useState<string | undefined>(undefined);\r\n  const [size, setSize] = useState<number | undefined>(undefined);\r\n\r\n  const marketInfosbyName = Object.fromEntries(\r\n    marketInfos.map((market) => [market.name, market]),\r\n  );\r\n\r\n  const tokenConvertMap: Map<string, Set<string>> = new Map();\r\n  Object.keys(marketInfosbyName).forEach((market) => {\r\n    let [base, quote] = market.split('/');\r\n    !tokenConvertMap.has(base)\r\n      ? tokenConvertMap.set(base, new Set([quote]))\r\n      : tokenConvertMap.set(\r\n          base,\r\n          new Set([...(tokenConvertMap.get(base) || []), quote]),\r\n        );\r\n    !tokenConvertMap.has(quote)\r\n      ? tokenConvertMap.set(quote, new Set([base]))\r\n      : tokenConvertMap.set(\r\n          quote,\r\n          new Set([...(tokenConvertMap.get(quote) || []), base]),\r\n        );\r\n  });\r\n\r\n  const setMarket = (toToken) => {\r\n    const marketInfo = marketInfos\r\n      .filter((marketInfo) => !marketInfo.deprecated)\r\n      .find(\r\n        (marketInfo) =>\r\n          marketInfo.name === `${fromToken}/${toToken}` ||\r\n          marketInfo.name === `${toToken}/${fromToken}`,\r\n      );\r\n    if (!marketInfo) {\r\n      console.warn(\r\n        `Could not find market info for market names ${fromToken}/${toToken} or ${toToken}/${fromToken}`,\r\n      );\r\n      notify({\r\n        message: 'Invalid market',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n    setMarketAddress(marketInfo.address.toBase58());\r\n    setToToken(toToken);\r\n  };\r\n\r\n  return (\r\n    <FloatingElement style={{ maxWidth: 500 }}>\r\n      <Title level={3}>Convert</Title>\r\n      {!connected && (\r\n        <Row justify=\"center\">\r\n          <Col>\r\n            <WalletConnect />\r\n          </Col>\r\n        </Row>\r\n      )}\r\n      {tokenConvertMap && connected && (\r\n        <>\r\n          <Row style={{ marginBottom: 8 }}>\r\n            <Col>\r\n              <Select\r\n                style={{ minWidth: 300 }}\r\n                placeholder=\"Select a token\"\r\n                value={fromToken}\r\n                onChange={(token) => {\r\n                  setFromToken(token);\r\n                  setToToken(undefined);\r\n                }}\r\n              >\r\n                {Array.from(tokenConvertMap.keys()).map((token) => (\r\n                  <Option value={token} key={token}>\r\n                    {token}\r\n                  </Option>\r\n                ))}\r\n              </Select>\r\n            </Col>\r\n          </Row>\r\n          {fromToken && (\r\n            <Row style={{ marginBottom: 8 }}>\r\n              <Col>\r\n                <Select\r\n                  style={{ minWidth: 300 }}\r\n                  value={toToken}\r\n                  onChange={setMarket}\r\n                >\r\n                  {[...(tokenConvertMap.get(fromToken) || [])].map((token) => (\r\n                    <Option value={token} key={token}>\r\n                      {token}\r\n                    </Option>\r\n                  ))}\r\n                </Select>\r\n              </Col>\r\n            </Row>\r\n          )}\r\n          {fromToken && toToken && (\r\n            <MarketProvider\r\n              marketAddress={marketAddress}\r\n              setMarketAddress={setMarketAddress}\r\n            >\r\n              <ConvertFormSubmit\r\n                size={size}\r\n                setSize={setSize}\r\n                fromToken={fromToken}\r\n                toToken={toToken}\r\n                wallet={wallet}\r\n                customMarkets={customMarkets}\r\n              />\r\n            </MarketProvider>\r\n          )}\r\n        </>\r\n      )}\r\n    </FloatingElement>\r\n  );\r\n}\r\n\r\nfunction ConvertFormSubmit({\r\n  size,\r\n  setSize,\r\n  fromToken,\r\n  toToken,\r\n  wallet,\r\n  customMarkets,\r\n}: {\r\n  size: number | null | undefined;\r\n  setSize: (newSize: number | undefined) => void;\r\n  fromToken: string;\r\n  toToken: string;\r\n  wallet?: WalletAdapter;\r\n  customMarkets: CustomMarketInfo[];\r\n}) {\r\n  const { market } = useMarket();\r\n  const [accounts] = useTokenAccounts();\r\n  const balances = useBalances();\r\n  const [fromAmount, setFromAmount] = useState<number | undefined>();\r\n  const [toAmount, setToAmount] = useState<number | undefined>();\r\n  const {\r\n    storedFeeDiscountKey: feeDiscountKey,\r\n  } = useLocallyStoredFeeDiscountKey();\r\n\r\n  const connection = useConnection();\r\n  const sendConnection = useSendConnection();\r\n\r\n  const [isConverting, setIsConverting] = useState(false);\r\n\r\n  const isFromTokenBaseOfMarket = (market) => {\r\n    const { marketName } = getMarketDetails(market, customMarkets);\r\n    if (!marketName) {\r\n      throw Error(\r\n        'Cannot determine if coin is quote or base because marketName is missing',\r\n      );\r\n    }\r\n    const [base] = marketName.split('/');\r\n    return fromToken === base;\r\n  };\r\n\r\n  const onConvert = async () => {\r\n    if (!market) {\r\n      console.warn('Market is null when attempting convert.');\r\n      notify({\r\n        message: 'Invalid market',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n    // get accounts\r\n    const baseCurrencyAccount = getSelectedTokenAccountForMint(\r\n      accounts,\r\n      market?.baseMintAddress,\r\n    );\r\n    const quoteCurrencyAccount = getSelectedTokenAccountForMint(\r\n      accounts,\r\n      market?.quoteMintAddress,\r\n    );\r\n\r\n    // get approximate price\r\n    let side;\r\n    try {\r\n      side = isFromTokenBaseOfMarket(market) ? 'sell' : 'buy';\r\n    } catch (e) {\r\n      console.warn(e);\r\n      notify({\r\n        message: 'Error placing order',\r\n        description: e.message,\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n\r\n    const sidedOrderbookAccount =\r\n      // @ts-ignore\r\n      side === 'buy' ? market._decoded.asks : market._decoded.bids;\r\n    const orderbookData = await connection.getAccountInfo(\r\n      sidedOrderbookAccount,\r\n    );\r\n    if (!orderbookData?.data) {\r\n      notify({ message: 'Invalid orderbook data', type: 'error' });\r\n      return;\r\n    }\r\n    const decodedOrderbookData = Orderbook.decode(market, orderbookData.data);\r\n    const [bbo] =\r\n      decodedOrderbookData &&\r\n      decodedOrderbookData.getL2(1).map(([price]) => price);\r\n    if (!bbo) {\r\n      notify({ message: 'No best price found', type: 'error' });\r\n      return;\r\n    }\r\n    if (!size) {\r\n      notify({ message: 'Size not specified', type: 'error' });\r\n      return;\r\n    }\r\n\r\n    const tickSizeDecimals = getDecimalCount(market.tickSize);\r\n    const parsedPrice = getMarketOrderPrice(\r\n      decodedOrderbookData,\r\n      size,\r\n      tickSizeDecimals,\r\n    );\r\n\r\n    // round size\r\n    const sizeDecimalCount = getDecimalCount(market.minOrderSize);\r\n    const nativeSize = side === 'sell' ? size : size / parsedPrice;\r\n    const parsedSize = floorToDecimal(nativeSize, sizeDecimalCount);\r\n\r\n    setIsConverting(true);\r\n    try {\r\n      if (!wallet) {\r\n        return null;\r\n      }\r\n\r\n      await placeOrder({\r\n        side,\r\n        price: parsedPrice,\r\n        size: parsedSize,\r\n        orderType: 'ioc',\r\n        market,\r\n        connection: sendConnection,\r\n        wallet,\r\n        baseCurrencyAccount: baseCurrencyAccount?.pubkey,\r\n        quoteCurrencyAccount: quoteCurrencyAccount?.pubkey,\r\n        feeDiscountPubkey: feeDiscountKey,\r\n      });\r\n    } catch (e) {\r\n      console.warn(e);\r\n      notify({\r\n        message: 'Error placing order',\r\n        description: e.message,\r\n        type: 'error',\r\n      });\r\n    } finally {\r\n      setIsConverting(false);\r\n    }\r\n  };\r\n\r\n  const getPrice = async () => {\r\n    try {\r\n      const side = isFromTokenBaseOfMarket(market) ? 'sell' : 'buy';\r\n      const sidedOrderbookAccount =\r\n        // @ts-ignore\r\n        side === 'buy' ? market._decoded.asks : market._decoded.bids;\r\n      const orderbookData = await connection.getAccountInfo(\r\n        sidedOrderbookAccount,\r\n      );\r\n      if (!orderbookData?.data || !market) {\r\n        return [null, null];\r\n      }\r\n      const decodedOrderbookData = Orderbook.decode(market, orderbookData.data);\r\n      const [bbo] =\r\n        decodedOrderbookData &&\r\n        decodedOrderbookData.getL2(1).map(([price]) => price);\r\n      if (!bbo || !size) {\r\n        return [null, null];\r\n      }\r\n      const tickSizeDecimals = getDecimalCount(market.tickSize);\r\n      const expectedPrice = getExpectedFillPrice(\r\n        decodedOrderbookData,\r\n        size,\r\n        tickSizeDecimals,\r\n      );\r\n      if (side === 'buy') {\r\n        return [expectedPrice.toFixed(6), 1];\r\n      } else {\r\n        return [1, expectedPrice.toFixed(6)];\r\n      }\r\n    } catch (e) {\r\n      console.log(`Got error ${e}`);\r\n      return [null, null];\r\n    }\r\n  };\r\n\r\n  useEffect(\r\n    () => {\r\n      getPrice().then(([fromAmount, toAmount]) => {\r\n        setFromAmount(fromAmount || undefined);\r\n        setToAmount(toAmount || undefined);\r\n      });\r\n    },\r\n    // eslint-disable-next-line\r\n    [market?.address.toBase58(), size],\r\n  );\r\n\r\n  const canConvert = market && size && size > 0;\r\n  const balance = balances.find(\r\n    (coinBalance) => coinBalance.coin === fromToken,\r\n  );\r\n  const availableBalance =\r\n    ((balance?.unsettled || 0) + (balance?.wallet || 0)) * 0.99;\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Row style={{ marginBottom: 8 }}>\r\n        <Col>\r\n          <Input\r\n            style={{ minWidth: 300 }}\r\n            addonBefore={`Size (${fromToken})`}\r\n            placeholder=\"Size\"\r\n            value={size === null ? undefined : size}\r\n            type=\"number\"\r\n            onChange={(e) => setSize(parseFloat(e.target.value) || undefined)}\r\n          />\r\n        </Col>\r\n      </Row>\r\n      <Row gutter={12} style={{ marginBottom: 8 }}>\r\n        <Col span={12}>\r\n          <ActionButton\r\n            block\r\n            size=\"large\"\r\n            onClick={() => setSize(floorToDecimal(availableBalance, 4))}\r\n          >\r\n            Max: {availableBalance.toFixed(4)}\r\n          </ActionButton>\r\n        </Col>\r\n        <Col span={12}>\r\n          <ConvertButton\r\n            block\r\n            type=\"primary\"\r\n            size=\"large\"\r\n            loading={isConverting}\r\n            onClick={onConvert}\r\n            disabled={!canConvert}\r\n          >\r\n            Convert\r\n          </ConvertButton>\r\n        </Col>\r\n      </Row>\r\n      {canConvert && (\r\n        <Row align=\"middle\" justify=\"center\">\r\n          <Col>\r\n            {fromAmount} {fromToken}\r\n          </Col>\r\n          <Col offset={1}>\r\n            <SwapOutlined />\r\n          </Col>\r\n          <Col offset={1}>\r\n            {toAmount} {toToken}\r\n          </Col>\r\n        </Row>\r\n      )}\r\n    </React.Fragment>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport styled from 'styled-components';\r\nimport ConvertForm from '../components/ConvertForm';\r\nimport { Row, Col } from 'antd';\r\nimport { DEFAULT_MARKET, MarketProvider } from '../utils/markets';\r\nimport { useLocalStorageState } from '../utils/utils';\r\n\r\nconst Wrapper = styled.div`\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  padding: 16px 16px;\r\n  .borderNone .ant-select-selector {\r\n    border: none !important;\r\n  }\r\n`;\r\n\r\nexport default function ConvertPage() {\r\n  const [marketAddress, setMarketAddress] = useLocalStorageState(\r\n    'marketAddress',\r\n    DEFAULT_MARKET?.address.toBase58(),\r\n  );\r\n  return (\r\n    <Wrapper style={{ flex: 1, paddingTop: 10 }}>\r\n      <Row justify=\"center\">\r\n        <Col>\r\n          <MarketProvider\r\n            marketAddress={marketAddress}\r\n            setMarketAddress={setMarketAddress}\r\n          >\r\n            <ConvertForm />\r\n          </MarketProvider>\r\n        </Col>\r\n      </Row>\r\n    </Wrapper>\r\n  );\r\n}\r\n","import React, {useContext, useState} from 'react';\r\nimport {sleep, useLocalStorageState} from './utils';\r\nimport {useInterval} from './useInterval';\r\nimport {useConnection} from './connection';\r\nimport {useWallet} from './wallet';\r\nimport {\r\n  useMarketInfos,\r\n  useTokenAccounts,\r\n} from './markets';\r\nimport {settleAllFunds} from './send';\r\nimport {PreferencesContextValues} from './types';\r\nimport {Market} from \"@project-serum/serum\";\r\n\r\nconst PreferencesContext = React.createContext<PreferencesContextValues | null>(\r\n  null,\r\n);\r\n\r\nexport function PreferencesProvider({ children }) {\r\n  const [autoSettleEnabled, setAutoSettleEnabled] = useLocalStorageState(\r\n    'autoSettleEnabled',\r\n    true,\r\n  );\r\n\r\n  const [tokenAccounts] = useTokenAccounts();\r\n  const { connected, wallet } = useWallet();\r\n  const marketInfoList = useMarketInfos();\r\n  const [currentlyFetchingMarkets, setCurrentlyFetchingMarkets] = useState<boolean>(false);\r\n  const [markets, setMarkets] = useState<Map<string, Market>>(new Map())\r\n  const addToMarketsMap = (marketId, market) => {\r\n    setMarkets(prev => new Map(prev).set(marketId, market));\r\n  }\r\n  const connection = useConnection();\r\n\r\n  useInterval(() => {\r\n    const autoSettle = async () => {\r\n      if (!wallet) {\r\n        return;\r\n      }\r\n      try {\r\n        console.log('Settling funds...');\r\n        await settleAllFunds({\r\n          connection,\r\n          wallet,\r\n          tokenAccounts: tokenAccounts || [],\r\n          markets: [...markets.values()],\r\n        });\r\n      } catch (e) {\r\n        console.log('Error auto settling funds: ' + e.message);\r\n        return;\r\n      }\r\n      console.log('Finished settling funds.');\r\n    };\r\n    (\r\n      connected &&\r\n      wallet?.autoApprove &&\r\n      autoSettleEnabled &&\r\n      autoSettle()\r\n    );\r\n  }, 20000);\r\n\r\n  // warms up the market and open orders cache for auto-settlement\r\n  useInterval(() => {\r\n    const fetchMarkets = async () => {\r\n      if (!wallet) {\r\n        // only need these markets for auto-settlement, so don't fetch unless we are connected.\r\n        return;\r\n      }\r\n      setCurrentlyFetchingMarkets(true);\r\n      for (const marketInfo of marketInfoList) {\r\n        if (markets.has(marketInfo.address.toString())) {\r\n          continue;\r\n        }\r\n        try {\r\n          const market = await Market.load(connection, marketInfo.address, {}, marketInfo.programId)\r\n          addToMarketsMap(marketInfo.address.toString(), market);\r\n          await sleep(1000);\r\n        } catch (e) {\r\n          console.log('Error fetching market: ' + e.message);\r\n        }\r\n      }\r\n      setCurrentlyFetchingMarkets(false);\r\n    }\r\n    (\r\n      connected &&\r\n      wallet?.autoApprove &&\r\n      autoSettleEnabled &&\r\n      !currentlyFetchingMarkets &&\r\n      fetchMarkets()\r\n    );\r\n  }, 60000)\r\n\r\n  return (\r\n    <PreferencesContext.Provider\r\n      value={{\r\n        autoSettleEnabled,\r\n        setAutoSettleEnabled,\r\n      }}\r\n    >\r\n      {children}\r\n    </PreferencesContext.Provider>\r\n  );\r\n}\r\n\r\nexport function usePreferences() {\r\n  const context = useContext(PreferencesContext);\r\n  if (!context) {\r\n    throw new Error('Missing preferences context');\r\n  }\r\n  return {\r\n    autoSettleEnabled: context.autoSettleEnabled,\r\n    setAutoSettleEnabled: context.setAutoSettleEnabled,\r\n  };\r\n}\r\n","import React from 'react';\r\nimport { Switch, Typography } from 'antd';\r\nimport { usePreferences } from '../utils/preferences';\r\n\r\nconst { Paragraph } = Typography;\r\n\r\nexport default function Settings({ autoApprove }) {\r\n  const { autoSettleEnabled, setAutoSettleEnabled } = usePreferences();\r\n\r\n  return (\r\n    <div>\r\n      <Switch\r\n        style={{ marginRight: 10 }}\r\n        disabled={!autoApprove}\r\n        checked={autoApprove && autoSettleEnabled}\r\n        onChange={setAutoSettleEnabled}\r\n      />{' '}\r\n      Auto settle\r\n      {!autoApprove && (\r\n        <Paragraph style={{ color: 'rgba(255,255,255,0.5)', marginTop: 10 }}>\r\n          To use auto settle, first enable auto approval in your wallet\r\n        </Paragraph>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState } from 'react';\r\nimport { Col, Input, Modal, Row } from 'antd';\r\nimport { EndpointInfo } from '../utils/types';\r\n\r\nexport default function CustomClusterEndpointDialog({\r\n  visible,\r\n  testingConnection,\r\n  onAddCustomEndpoint,\r\n  onClose,\r\n}: {\r\n  visible: boolean;\r\n  testingConnection: boolean;\r\n  onAddCustomEndpoint: (info: EndpointInfo) => void;\r\n  onClose?: () => void;\r\n}) {\r\n  const [customEndpoint, setCustomEndpoint] = useState('');\r\n  const [customEndpointName, setCustomEndpointName] = useState('');\r\n\r\n  const onSubmit = () => {\r\n    const fullEndpoint = 'https://' + customEndpoint;\r\n    const params = {\r\n      name: customEndpointName,\r\n      endpoint: fullEndpoint,\r\n      custom: true,\r\n    };\r\n    onAddCustomEndpoint(params);\r\n    onDoClose();\r\n  };\r\n  const onDoClose = () => {\r\n    setCustomEndpoint('');\r\n    setCustomEndpointName('');\r\n    onClose && onClose();\r\n  };\r\n  const canSubmit = customEndpoint !== '' && customEndpointName !== '';\r\n\r\n  return (\r\n    <Modal\r\n      title={'Add custom endpoint'}\r\n      visible={visible}\r\n      onOk={onSubmit}\r\n      okText={'Add'}\r\n      onCancel={onDoClose}\r\n      okButtonProps={{ disabled: !canSubmit, loading: testingConnection }}\r\n    >\r\n      <Row style={{ marginBottom: 8 }}>\r\n        <Col span={24}>\r\n          <Input\r\n            placeholder=\"Cluster Name\"\r\n            value={customEndpointName}\r\n            onChange={(e) => setCustomEndpointName(e.target.value)}\r\n          />\r\n        </Col>\r\n      </Row>\r\n      <Row style={{ marginBottom: 8 }}>\r\n        <Col span={24}>\r\n          <Input\r\n            placeholder=\"Cluster Endpoint\"\r\n            value={customEndpoint}\r\n            addonBefore={'https://'}\r\n            onChange={(e) => setCustomEndpoint(e.target.value)}\r\n          />\r\n        </Col>\r\n      </Row>\r\n    </Modal>\r\n  );\r\n}\r\n","import React, { useRef, useState } from 'react';\r\nimport { Select, Typography } from 'antd';\r\nimport { SearchOutlined } from '@ant-design/icons';\r\nimport { TOKEN_MINTS } from '@project-serum/serum';\r\nimport apps from '@project-serum/awesome-serum';\r\n\r\nconst { Option } = Select;\r\n\r\nconst appsAndTokens = apps.concat(\r\n  TOKEN_MINTS.map((mint) => {\r\n    return {\r\n      name: `${mint.name} SPL`,\r\n      url: `https://explorer.solana.com/address/${mint.address.toBase58()}`,\r\n      description: `${mint.name} SPL token`,\r\n      icon: '',\r\n      tags: [\r\n        'token',\r\n        'blockchain',\r\n        'solana',\r\n        'spl',\r\n        'solana',\r\n        mint.address.toBase58(),\r\n      ],\r\n    };\r\n  }),\r\n);\r\n\r\ninterface App {\r\n  name: string;\r\n  url: string;\r\n  description: string;\r\n  tags: string[];\r\n}\r\n\r\nexport default function AppSearch(props) {\r\n  const [searchMatches, setSearchMatches] = useState<App[]>([]);\r\n  const [searchValue, setSearchValue] = useState<string | undefined>(undefined);\r\n\r\n  const matchApp = (searchString: string, app: App) => {\r\n    const lowerSearchStr = searchString.toLowerCase();\r\n    return (\r\n      app.name.toLowerCase().includes(lowerSearchStr) ||\r\n      app.tags.some(\r\n        (tag) =>\r\n          tag.toLowerCase().includes(lowerSearchStr) ||\r\n          lowerSearchStr.includes(tag.toLowerCase()),\r\n      )\r\n    );\r\n  };\r\n\r\n  const handleSearch = (value) => {\r\n    setSearchValue(value === '' ? undefined : value);\r\n    const filteredApps = appsAndTokens.filter((app) => matchApp(value, app));\r\n    setSearchMatches(filteredApps);\r\n  };\r\n\r\n  const handleSelect = (value, option) => {\r\n    window.open(option.href, '_blank');\r\n    handleClear();\r\n  };\r\n\r\n  const handleClear = () => {\r\n    setSearchMatches([]);\r\n    setSearchValue(undefined);\r\n  };\r\n\r\n  const options = searchMatches.map((d) => (\r\n    <Option key={d.name} value={d.name} href={d.url}>\r\n      <h3>{d.name}</h3>\r\n      <Typography.Text type=\"secondary\">\r\n        {d.url.replace('https://', '')}\r\n      </Typography.Text>\r\n    </Option>\r\n  ));\r\n\r\n  const ref = useRef<any>();\r\n  return (\r\n    <Select\r\n      ref={ref}\r\n      showSearch\r\n      allowClear\r\n      value={searchValue}\r\n      placeholder={\r\n        props.focussed || props.focussed === undefined\r\n          ? 'Search for dex, wallet, token...'\r\n          : ''\r\n      }\r\n      onSearch={handleSearch}\r\n      onClear={handleClear}\r\n      onSelect={handleSelect}\r\n      onFocus={props.onFocus}\r\n      onBlur={() => {\r\n        props.onBlur();\r\n        handleClear();\r\n      }}\r\n      notFoundContent={null} // todo: make this search history\r\n      style={{\r\n        width: props.width || '300px',\r\n        transition: props.focussed ? 'width 0.1s ease 0.1s' : '',\r\n      }}\r\n      dropdownStyle={{\r\n        width: props.width || '300px',\r\n      }}\r\n      dropdownMatchSelectWidth={false}\r\n      suffixIcon={\r\n        <SearchOutlined onClick={() => ref.current && ref.current.focus()} />\r\n      }\r\n      filterOption={false}\r\n    >\r\n      {options}\r\n    </Select>\r\n  );\r\n}\r\n","import {\r\n  InfoCircleOutlined,\r\n  PlusCircleOutlined,\r\n  SettingOutlined,\r\n} from '@ant-design/icons';\r\nimport { Button, Col, Menu, Popover, Row, Select } from 'antd';\r\nimport React, { useCallback, useEffect, useState } from 'react';\r\nimport { useHistory, useLocation } from 'react-router-dom';\r\nimport logo from '../assets/logo.svg';\r\nimport styled from 'styled-components';\r\nimport { useWallet } from '../utils/wallet';\r\nimport { ENDPOINTS, useConnectionConfig } from '../utils/connection';\r\nimport Settings from './Settings';\r\nimport CustomClusterEndpointDialog from './CustomClusterEndpointDialog';\r\nimport { EndpointInfo } from '../utils/types';\r\nimport { notify } from '../utils/notifications';\r\nimport { Connection } from '@solana/web3.js';\r\nimport WalletConnect from './WalletConnect';\r\nimport AppSearch from './AppSearch';\r\nimport { getTradePageUrl } from '../utils/markets';\r\n\r\nconst Wrapper = styled.div`\r\n  background-color: #0d1017;\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: flex-end;\r\n  padding: 0px 30px;\r\n  flex-wrap: wrap;\r\n`;\r\nconst LogoWrapper = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  color: #2abdd2;\r\n  font-weight: bold;\r\n  cursor: pointer;\r\n  img {\r\n    height: 30px;\r\n    margin-right: 8px;\r\n  }\r\n`;\r\n\r\nconst EXTERNAL_LINKS = {\r\n  '/learn': 'https://serum-academy.com/en/serum-dex/',\r\n  '/add-market': 'https://serum-academy.com/en/add-market/',\r\n  '/wallet-support': 'https://serum-academy.com/en/wallet-support',\r\n  '/dex-list': 'https://serum-academy.com/en/dex-list/',\r\n  '/developer-resources': 'https://serum-academy.com/en/developer-resources/',\r\n  '/explorer': 'https://explorer.solana.com',\r\n  '/srm-faq': 'https://projectserum.com/srm-faq',\r\n  '/dashboard': 'https://sonar.watch/dashboard',\r\n};\r\n\r\nexport default function TopBar() {\r\n  const { connected, wallet } = useWallet();\r\n  const {\r\n    endpoint,\r\n    endpointInfo,\r\n    setEndpoint,\r\n    availableEndpoints,\r\n    setCustomEndpoints,\r\n  } = useConnectionConfig();\r\n  const [addEndpointVisible, setAddEndpointVisible] = useState(false);\r\n  const [testingConnection, setTestingConnection] = useState(false);\r\n  const location = useLocation();\r\n  const history = useHistory();\r\n  const [searchFocussed, setSearchFocussed] = useState(false);\r\n\r\n  const handleClick = useCallback(\r\n    (e) => {\r\n      if (!(e.key in EXTERNAL_LINKS)) {\r\n        history.push(e.key);\r\n      }\r\n    },\r\n    [history],\r\n  );\r\n\r\n  const onAddCustomEndpoint = (info: EndpointInfo) => {\r\n    const existingEndpoint = availableEndpoints.some(\r\n      (e) => e.endpoint === info.endpoint,\r\n    );\r\n    if (existingEndpoint) {\r\n      notify({\r\n        message: `An endpoint with the given url already exists`,\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n\r\n    const handleError = (e) => {\r\n      console.log(`Connection to ${info.endpoint} failed: ${e}`);\r\n      notify({\r\n        message: `Failed to connect to ${info.endpoint}`,\r\n        type: 'error',\r\n      });\r\n    };\r\n\r\n    try {\r\n      const connection = new Connection(info.endpoint, 'recent');\r\n      connection\r\n        .getEpochInfo()\r\n        .then((result) => {\r\n          setTestingConnection(true);\r\n          console.log(`testing connection to ${info.endpoint}`);\r\n          const newCustomEndpoints = [\r\n            ...availableEndpoints.filter((e) => e.custom),\r\n            info,\r\n          ];\r\n          setEndpoint(info.endpoint);\r\n          setCustomEndpoints(newCustomEndpoints);\r\n        })\r\n        .catch(handleError);\r\n    } catch (e) {\r\n      handleError(e);\r\n    } finally {\r\n      setTestingConnection(false);\r\n    }\r\n  };\r\n\r\n  const endpointInfoCustom = endpointInfo && endpointInfo.custom;\r\n  useEffect(() => {\r\n    const handler = () => {\r\n      if (endpointInfoCustom) {\r\n        setEndpoint(ENDPOINTS[0].endpoint);\r\n      }\r\n    };\r\n    window.addEventListener('beforeunload', handler);\r\n    return () => window.removeEventListener('beforeunload', handler);\r\n  }, [endpointInfoCustom, setEndpoint]);\r\n\r\n  const tradePageUrl = location.pathname.startsWith('/market/')\r\n    ? location.pathname\r\n    : getTradePageUrl();\r\n\r\n  return (\r\n    <>\r\n      <CustomClusterEndpointDialog\r\n        visible={addEndpointVisible}\r\n        testingConnection={testingConnection}\r\n        onAddCustomEndpoint={onAddCustomEndpoint}\r\n        onClose={() => setAddEndpointVisible(false)}\r\n      />\r\n      <Wrapper>\r\n        <LogoWrapper onClick={() => history.push(tradePageUrl)}>\r\n          <img src={logo} alt=\"sonar logo\" />\r\n          {'SONAR DEX'}\r\n        </LogoWrapper>\r\n        <Menu\r\n          mode=\"horizontal\"\r\n          onClick={handleClick}\r\n          selectedKeys={[location.pathname]}\r\n          style={{\r\n            borderBottom: 'none',\r\n            backgroundColor: 'transparent',\r\n            display: 'flex',\r\n            alignItems: 'flex-end',\r\n            flex: 1,\r\n          }}\r\n        >\r\n          <Menu.Item key={tradePageUrl} style={{ margin: '0 10px 0 20px' }}>\r\n            TRADE\r\n          </Menu.Item>\r\n          {!searchFocussed && (\r\n            <Menu.Item key=\"/dashboard\" style={{ margin: '0 10px' }}>\r\n              <a\r\n                href={EXTERNAL_LINKS['/dashboard']}\r\n                target=\"_blank\"\r\n                rel=\"noopener noreferrer\"\r\n              >\r\n                DASHBOARD\r\n              </a>\r\n            </Menu.Item>\r\n          )}\r\n          {connected && (!searchFocussed || location.pathname === '/balances') && (\r\n            <Menu.Item key=\"/balances\" style={{ margin: '0 10px' }}>\r\n              BALANCES\r\n            </Menu.Item>\r\n          )}\r\n          {connected && (!searchFocussed || location.pathname === '/orders') && (\r\n            <Menu.Item key=\"/orders\" style={{ margin: '0 10px' }}>\r\n              ORDERS\r\n            </Menu.Item>\r\n          )}\r\n          {connected && (!searchFocussed || location.pathname === '/convert') && (\r\n            <Menu.Item key=\"/convert\" style={{ margin: '0 10px' }}>\r\n              CONVERT\r\n            </Menu.Item>\r\n          )}\r\n        </Menu>\r\n        <div\r\n          style={{\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            paddingRight: 5,\r\n          }}\r\n        >\r\n          <AppSearch\r\n            onFocus={() => setSearchFocussed(true)}\r\n            onBlur={() => setSearchFocussed(false)}\r\n            focussed={searchFocussed}\r\n            width={searchFocussed ? '350px' : '35px'}\r\n          />\r\n        </div>\r\n        <div>\r\n          <Row\r\n            align=\"middle\"\r\n            style={{ paddingLeft: 5, paddingRight: 5 }}\r\n            gutter={16}\r\n          >\r\n            <Col>\r\n              <PlusCircleOutlined\r\n                style={{ color: '#2abdd2' }}\r\n                onClick={() => setAddEndpointVisible(true)}\r\n              />\r\n            </Col>\r\n            <Col>\r\n              <Popover\r\n                content={endpoint}\r\n                placement=\"bottomRight\"\r\n                title=\"URL\"\r\n                trigger=\"hover\"\r\n              >\r\n                <InfoCircleOutlined style={{ color: '#2abdd2' }} />\r\n              </Popover>\r\n            </Col>\r\n            <Col>\r\n              <Select\r\n                onSelect={setEndpoint}\r\n                value={endpoint}\r\n                style={{ marginRight: 8, width: '150px' }}\r\n              >\r\n                {availableEndpoints.map(({ name, endpoint }) => (\r\n                  <Select.Option value={endpoint} key={endpoint}>\r\n                    {name}\r\n                  </Select.Option>\r\n                ))}\r\n              </Select>\r\n            </Col>\r\n          </Row>\r\n        </div>\r\n        {connected && (\r\n          <div>\r\n            <Popover\r\n              content={<Settings autoApprove={wallet?.autoApprove} />}\r\n              placement=\"bottomRight\"\r\n              title=\"Settings\"\r\n              trigger=\"click\"\r\n            >\r\n              <Button style={{ marginRight: 8 }}>\r\n                <SettingOutlined />\r\n                Settings\r\n              </Button>\r\n            </Popover>\r\n          </div>\r\n        )}\r\n        <div>\r\n          <WalletConnect />\r\n        </div>\r\n      </Wrapper>\r\n    </>\r\n  );\r\n}\r\n","export const helpUrls = {\r\n  customerSupport: 'https://t.me/ProjectSerum',\r\n  customerSupportZh: 'https://t.me/ProjectSerum_Chinese',\r\n  contactEmail: 'mailto:contact@projectserum.com',\r\n  discord: 'https://discord.gg/gG4DvM2JGw',\r\n  telegram: 'https://t.me/ProjectSerum',\r\n  github: 'https://github.com/project-serum',\r\n  projectSerum: 'https://projectserum.com/',\r\n  developerResources: 'https://projectserum.com/developer-resources',\r\n  solanaBeach: 'https://solanabeach.io',\r\n  sonar: 'https://sonar.watch'\r\n};\r\n","import React from 'react';\r\nimport { Layout, Row, Col, Grid } from 'antd';\r\nimport Link from './Link';\r\nimport { helpUrls } from './HelpUrls';\r\nconst { Footer } = Layout;\r\nconst { useBreakpoint } = Grid;\r\n\r\nconst footerElements = [\r\n  { description: 'Sonar', link: helpUrls.sonar },\r\n  { description: 'Discord', link: helpUrls.discord },\r\n  { description: 'Project Serum', link: helpUrls.projectSerum },\r\n  { description: 'Solana Network', link: helpUrls.solanaBeach },\r\n];\r\n\r\nexport const CustomFooter = () => {\r\n  const smallScreen = !useBreakpoint().lg;\r\n\r\n  return (\r\n    <Footer\r\n      style={{\r\n        height: '45px',\r\n        paddingBottom: 10,\r\n        paddingTop: 10,\r\n      }}\r\n    >\r\n      <Row align=\"middle\" gutter={[16, 4]}>\r\n        {!smallScreen && (\r\n          <>\r\n            <Col flex=\"auto\" />\r\n            {footerElements.map((elem, index) => {\r\n              return (\r\n                <Col key={index + ''}>\r\n                  <Link external to={elem.link}>\r\n                    {elem.description}\r\n                  </Link>\r\n                </Col>\r\n              );\r\n            })}\r\n          </>\r\n        )}\r\n        <Col flex=\"auto\">{/*  <DexProgramSelector />*/}</Col>\r\n      </Row>\r\n    </Footer>\r\n  );\r\n};\r\n","import { Layout } from 'antd';\r\nimport React from 'react';\r\nimport TopBar from './TopBar';\r\nimport { CustomFooter as Footer } from './Footer';\r\nconst { Header, Content } = Layout;\r\n\r\nexport default function BasicLayout({ children }) {\r\n  return (\r\n    <React.Fragment>\r\n      <Layout\r\n        style={{ display: 'flex', minHeight: '100vh', flexDirection: 'column' }}\r\n      >\r\n        <Header style={{ padding: 0, minHeight: 64, height: 'unset' }}>\r\n          <TopBar />\r\n        </Header>\r\n        <Content style={{ flex: 1 }}>{children}</Content>\r\n        <Footer />\r\n      </Layout>\r\n    </React.Fragment>\r\n  );\r\n}\r\n","import { PublicKey } from '@solana/web3.js';\r\nimport React, { ReactElement, useMemo, useState } from 'react';\r\nimport { useAccountInfo } from '../utils/connection';\r\nimport { isValidPublicKey } from '../utils/utils';\r\nimport { ValidateStatus } from 'antd/lib/form/FormItem';\r\nimport { TokenInstructions } from '@project-serum/serum';\r\nimport { parseTokenMintData, useMintToTickers } from '../utils/tokens';\r\nimport { AutoComplete, Form, Tooltip } from 'antd';\r\nimport Link from './Link';\r\n\r\nexport interface MintInfo {\r\n  address: PublicKey;\r\n  decimals: number;\r\n}\r\n\r\nexport function useMintInput(\r\n  name,\r\n  label: string | ReactElement,\r\n  tooltip?: string | ReactElement,\r\n): [ReactElement, MintInfo | null] {\r\n  const [address, setAddress] = useState('');\r\n  const [accountInfo, loaded] = useAccountInfo(\r\n    isValidPublicKey(address) ? new PublicKey(address) : null,\r\n  );\r\n\r\n  const mintToTickers = useMintToTickers();\r\n  const options = useMemo(() => {\r\n    return Object.entries(mintToTickers)\r\n      .filter(\r\n        ([mintAddress, ticker]) =>\r\n          mintAddress.includes(address) ||\r\n          ticker.toLowerCase().includes(address.toLowerCase()),\r\n      )\r\n      .map(([mintAddress, ticker]) => ({\r\n        value: mintAddress,\r\n        label: (\r\n          <>\r\n            {ticker} ({mintAddress})\r\n          </>\r\n        ),\r\n      }));\r\n  }, [mintToTickers, address]);\r\n\r\n  const { validateStatus, hasFeedback, help, mintInfo } = useMemo(() => {\r\n    let validateStatus: ValidateStatus = '';\r\n    let hasFeedback = false;\r\n    let help: string | null = null;\r\n    let mintInfo: MintInfo | null = null;\r\n    if (address) {\r\n      hasFeedback = true;\r\n      if (accountInfo) {\r\n        if (\r\n          accountInfo.owner.equals(TokenInstructions.TOKEN_PROGRAM_ID) &&\r\n          accountInfo.data.length === 82\r\n        ) {\r\n          let parsed = parseTokenMintData(accountInfo.data);\r\n          if (parsed.initialized) {\r\n            validateStatus = 'success';\r\n            mintInfo = {\r\n              address: new PublicKey(address),\r\n              decimals: parsed.decimals,\r\n            };\r\n          } else {\r\n            validateStatus = 'error';\r\n            help = 'Invalid SPL mint';\r\n          }\r\n        } else {\r\n          validateStatus = 'error';\r\n          help = 'Invalid SPL mint address';\r\n        }\r\n      } else if (isValidPublicKey(address) && !loaded) {\r\n        validateStatus = 'validating';\r\n      } else {\r\n        validateStatus = 'error';\r\n        help = 'Invalid Solana address';\r\n      }\r\n    }\r\n    return { validateStatus, hasFeedback, help, mintInfo };\r\n  }, [address, accountInfo, loaded]);\r\n\r\n  const input = (\r\n    <Form.Item\r\n      label={\r\n        <Tooltip\r\n          title={\r\n            <>\r\n              {tooltip} You can look up token mint addresses on{' '}\r\n              <Link external to=\"https://sollet.io\">\r\n                sollet.io\r\n              </Link>\r\n              .\r\n            </>\r\n          }\r\n        >\r\n          {label}\r\n        </Tooltip>\r\n      }\r\n      name={name}\r\n      validateStatus={validateStatus}\r\n      hasFeedback={hasFeedback}\r\n      help={help}\r\n    >\r\n      <AutoComplete\r\n        options={options}\r\n        value={address}\r\n        onChange={(value) => setAddress(value)}\r\n      />\r\n    </Form.Item>\r\n  );\r\n\r\n  return [input, mintInfo];\r\n}\r\n","import React, { useState } from 'react';\r\nimport { Button, Form, Input, Tooltip, Typography } from 'antd';\r\nimport { notify } from '../utils/notifications';\r\nimport { MARKETS } from '@project-serum/serum';\r\nimport { useConnection } from '../utils/connection';\r\nimport FloatingElement from '../components/layout/FloatingElement';\r\nimport styled from 'styled-components';\r\nimport { useWallet } from '../utils/wallet';\r\nimport { listMarket } from '../utils/send';\r\nimport { useMintInput } from '../components/useMintInput';\r\n\r\nconst { Text, Title } = Typography;\r\n\r\nconst Wrapper = styled.div`\r\n  max-width: 800px;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  margin-top: 24px;\r\n  margin-bottom: 24px;\r\n`;\r\n\r\nexport default function ListNewMarketPage() {\r\n  const connection = useConnection();\r\n  const { wallet, connected } = useWallet();\r\n  const [baseMintInput, baseMintInfo] = useMintInput(\r\n    'baseMint',\r\n    <Text>\r\n      Base Token Mint Address{' '}\r\n      <Text type=\"secondary\">\r\n        (e.g. BTC solana address:{' '}\r\n        {\r\n          <Text type=\"secondary\" code>\r\n            9n4nbM75f5Ui33ZbPYXn59EwSgE8CGsHtAeTH5YFeJ9E\r\n          </Text>\r\n        }\r\n        )\r\n      </Text>\r\n    </Text>,\r\n    'The base token is the token being traded. For example, the base token of a BTC/USDT market is BTC.',\r\n  );\r\n  const [quoteMintInput, quoteMintInfo] = useMintInput(\r\n    'quoteMint',\r\n    <Text>\r\n      Quote Token Mint Address{' '}\r\n      <Text type=\"secondary\">\r\n        (e.g. USDT solana address:{' '}\r\n        {\r\n          <Text type=\"secondary\" code>\r\n            BQcdHdAQW1hczDbBi9hiegXAR7A98Q9jx3X3iBBBDiq4\r\n          </Text>\r\n        }\r\n        )\r\n      </Text>\r\n    </Text>,\r\n    'The quote token is the token used to price trades. For example, the quote token of a BTC/USDT market is USDT.',\r\n  );\r\n  const [lotSize, setLotSize] = useState('1');\r\n  const [tickSize, setTickSize] = useState('0.01');\r\n  const dexProgramId = MARKETS.find(({ deprecated }) => !deprecated).programId;\r\n  const [submitting, setSubmitting] = useState(false);\r\n\r\n  const [listedMarket, setListedMarket] = useState(null);\r\n\r\n  let baseLotSize;\r\n  let quoteLotSize;\r\n  if (baseMintInfo && parseFloat(lotSize) > 0) {\r\n    baseLotSize = Math.round(10 ** baseMintInfo.decimals * parseFloat(lotSize));\r\n    if (quoteMintInfo && parseFloat(tickSize) > 0) {\r\n      quoteLotSize = Math.round(\r\n        parseFloat(lotSize) *\r\n          10 ** quoteMintInfo.decimals *\r\n          parseFloat(tickSize),\r\n      );\r\n    }\r\n  }\r\n\r\n  const canSubmit =\r\n    connected &&\r\n    !!baseMintInfo &&\r\n    !!quoteMintInfo &&\r\n    !!baseLotSize &&\r\n    !!quoteLotSize;\r\n\r\n  async function onSubmit() {\r\n    if (!canSubmit) {\r\n      return;\r\n    }\r\n    setSubmitting(true);\r\n    try {\r\n      const marketAddress = await listMarket({\r\n        connection,\r\n        wallet,\r\n        baseMint: baseMintInfo.address,\r\n        quoteMint: quoteMintInfo.address,\r\n        baseLotSize,\r\n        quoteLotSize,\r\n        dexProgramId,\r\n      });\r\n      setListedMarket(marketAddress);\r\n    } catch (e) {\r\n      console.warn(e);\r\n      notify({\r\n        message: 'Error listing new market',\r\n        description: e.message,\r\n        type: 'error',\r\n      });\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Wrapper>\r\n      <FloatingElement>\r\n        <Title level={4}>List New Market</Title>\r\n        <Form\r\n          labelCol={{ span: 24 }}\r\n          wrapperCol={{ span: 24 }}\r\n          layout={'vertical'}\r\n          onFinish={onSubmit}\r\n        >\r\n          {baseMintInput}\r\n          {quoteMintInput}\r\n          <Form.Item\r\n            label={\r\n              <Tooltip title=\"Smallest allowed order size. For a BTC/USDT market, this would be in units of BTC.\">\r\n                Minimum Order Size{' '}\r\n                <Text type=\"secondary\">(Lot size in e.g. BTC)</Text>\r\n              </Tooltip>\r\n            }\r\n            name=\"lotSize\"\r\n            initialValue=\"1\"\r\n            validateStatus={\r\n              baseMintInfo && quoteMintInfo\r\n                ? baseLotSize\r\n                  ? 'success'\r\n                  : 'error'\r\n                : null\r\n            }\r\n            hasFeedback={baseMintInfo && quoteMintInfo}\r\n          >\r\n            <Input\r\n              value={lotSize}\r\n              onChange={(e) => setLotSize(e.target.value.trim())}\r\n              type=\"number\"\r\n              min=\"0\"\r\n              step=\"any\"\r\n            />\r\n          </Form.Item>\r\n          <Form.Item\r\n            label={\r\n              <Tooltip title=\"Smallest amount by which prices can move. For a BTC/USDT market, this would be in units of USDT.\">\r\n                Tick Size{' '}\r\n                <Text type=\"secondary\">(Price increment in e.g. USDT)</Text>\r\n              </Tooltip>\r\n            }\r\n            name=\"tickSize\"\r\n            initialValue=\"0.01\"\r\n            validateStatus={\r\n              baseMintInfo && quoteMintInfo\r\n                ? quoteLotSize\r\n                  ? 'success'\r\n                  : 'error'\r\n                : null\r\n            }\r\n            hasFeedback={baseMintInfo && quoteMintInfo}\r\n          >\r\n            <Input\r\n              value={tickSize}\r\n              onChange={(e) => setTickSize(e.target.value.trim())}\r\n              type=\"number\"\r\n              min=\"0\"\r\n              step=\"any\"\r\n            />\r\n          </Form.Item>\r\n          <Form.Item label=\" \" colon={false}>\r\n            <Button\r\n              type=\"primary\"\r\n              htmlType=\"submit\"\r\n              disabled={!canSubmit}\r\n              loading={submitting}\r\n            >\r\n              {connected ? 'Submit' : 'Not connected to wallet'}\r\n            </Button>\r\n          </Form.Item>\r\n        </Form>\r\n      </FloatingElement>\r\n      {listedMarket ? (\r\n        <FloatingElement>\r\n          <Text>New market address: {listedMarket.toBase58()}</Text>\r\n        </FloatingElement>\r\n      ) : null}\r\n    </Wrapper>\r\n  );\r\n}\r\n","import React, { useEffect, useState } from 'react';\r\nimport {\r\n  AutoComplete,\r\n  Button,\r\n  Form,\r\n  Input,\r\n  Switch,\r\n  Tooltip,\r\n  Typography,\r\n} from 'antd';\r\nimport { PublicKey } from '@solana/web3.js';\r\nimport { useConnection } from '../../utils/connection';\r\nimport FloatingElement from '../../components/layout/FloatingElement';\r\nimport styled from 'styled-components';\r\nimport { useWallet } from '../../utils/wallet';\r\nimport { sendSignedTransaction, signTransactions } from '../../utils/send';\r\nimport { useMintInput } from '../../components/useMintInput';\r\nimport { PoolTransactions } from '@project-serum/pool';\r\nimport { useTokenAccounts } from '../../utils/markets';\r\nimport BN from 'bn.js';\r\nimport { notify } from '../../utils/notifications';\r\nimport Link from '../../components/Link';\r\n\r\nconst { Text, Title } = Typography;\r\n\r\nconst Wrapper = styled.div`\r\n  max-width: 800px;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  margin-top: 24px;\r\n  margin-bottom: 24px;\r\n`;\r\n\r\nconst AddRemoveTokenButtons = styled.div`\r\n  margin-top: 16px;\r\n  margin-bottom: 16px;\r\n`;\r\n\r\nconst SIMPLE_POOL_PROGRAM_ID = '71JS8f7y7ASMbuuSMCVG7a3qDdcVco2qYD6bMJeZqUCm';\r\nconst ADMIN_CONTROLLED_POOL_PROGRAM_ID =\r\n  'WvmTNLpGMVbwJVYztYL4Hnsy82cJhQorxjnnXcRm3b6';\r\nconst DEFAULT_PROGRAM_ID = ADMIN_CONTROLLED_POOL_PROGRAM_ID;\r\nconst PROGRAM_ID_OPTIONS = [\r\n  {\r\n    label: `Simple Pool (${SIMPLE_POOL_PROGRAM_ID})`,\r\n    value: SIMPLE_POOL_PROGRAM_ID,\r\n  },\r\n  {\r\n    label: `Admin-Controlled Pool (${ADMIN_CONTROLLED_POOL_PROGRAM_ID})`,\r\n    value: ADMIN_CONTROLLED_POOL_PROGRAM_ID,\r\n  },\r\n];\r\n\r\nexport default function NewPoolPage() {\r\n  const connection = useConnection();\r\n  const { wallet, connected } = useWallet();\r\n  const [poolName, setPoolName] = useState('');\r\n  const [programId, setProgramId] = useState(DEFAULT_PROGRAM_ID);\r\n  const [initialSupply, setInitialSupply] = useState('1');\r\n  const [initialAssets, setInitialAssets] = useState<InitialAsset[]>([\r\n    { valid: false },\r\n    { valid: false },\r\n  ]);\r\n  const [adminControlled, setAdminControlled] = useState(false);\r\n  const [adminAddress, setAdminAddress] = useState('');\r\n  const [tokenAccounts] = useTokenAccounts();\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [newPoolAddress, setNewPoolAddress] = useState<PublicKey | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (programId === SIMPLE_POOL_PROGRAM_ID) {\r\n      setAdminControlled(false);\r\n    } else if (programId === ADMIN_CONTROLLED_POOL_PROGRAM_ID) {\r\n      setAdminControlled(true);\r\n    }\r\n  }, [programId]);\r\n\r\n  useEffect(() => {\r\n    if (connected && wallet) {\r\n      setAdminAddress(wallet.publicKey.toBase58());\r\n    }\r\n  }, [wallet, connected]);\r\n\r\n  const canSubmit =\r\n    connected &&\r\n    poolName.trim() &&\r\n    programId &&\r\n    parseFloat(initialSupply) > 0 &&\r\n    initialAssets.every((asset) => asset.valid) &&\r\n    tokenAccounts &&\r\n    (adminAddress || !adminControlled);\r\n\r\n  async function onSubmit() {\r\n    if (!canSubmit || !wallet) {\r\n      return;\r\n    }\r\n    setSubmitting(true);\r\n    try {\r\n      const assets = initialAssets as ValidInitialAsset[];\r\n      const [\r\n        poolAddress,\r\n        transactionsAndSigners,\r\n      ] = await PoolTransactions.initializeSimplePool({\r\n        connection,\r\n        programId: new PublicKey(programId),\r\n        poolName,\r\n        poolStateSpace: 1024,\r\n        poolMintDecimals: 6,\r\n        initialPoolMintSupply: new BN(\r\n          Math.round(10 ** 6 * parseFloat(initialSupply)),\r\n        ),\r\n        assetMints: assets.map((asset) => asset.mint),\r\n        initialAssetQuantities: assets.map((asset) => new BN(asset.quantity)),\r\n        creator: wallet.publicKey,\r\n        creatorAssets: assets.map((asset) => {\r\n          const found = tokenAccounts?.find((tokenAccount) =>\r\n            tokenAccount.effectiveMint.equals(asset.mint),\r\n          );\r\n          if (!found) {\r\n            throw new Error('No token account for ' + asset.mint.toBase58());\r\n          }\r\n          return found.pubkey;\r\n        }),\r\n        additionalAccounts: adminControlled\r\n          ? [\r\n              {\r\n                pubkey: new PublicKey(adminAddress),\r\n                isSigner: false,\r\n                isWritable: false,\r\n              },\r\n            ]\r\n          : [],\r\n      });\r\n      const signed = await signTransactions({\r\n        transactionsAndSigners,\r\n        wallet,\r\n        connection,\r\n      });\r\n      for (let signedTransaction of signed) {\r\n        await sendSignedTransaction({ signedTransaction, connection });\r\n      }\r\n      setNewPoolAddress(poolAddress);\r\n    } catch (e) {\r\n      console.warn(e);\r\n      notify({\r\n        message: 'Error creating new pool',\r\n        description: e.message,\r\n        type: 'error',\r\n      });\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Wrapper>\r\n      <FloatingElement>\r\n        <Title level={4}>Create new pool</Title>\r\n        <Form layout=\"vertical\" onFinish={onSubmit}>\r\n          <Form.Item\r\n            label={\r\n              <Tooltip title=\"Public name of the pool.\">Pool Name</Tooltip>\r\n            }\r\n            name=\"name\"\r\n          >\r\n            <Input\r\n              value={poolName}\r\n              onChange={(e) => setPoolName(e.target.value)}\r\n            />\r\n          </Form.Item>\r\n          <Form.Item\r\n            label={\r\n              <Tooltip title=\"Address of the pool program.\">\r\n                Program ID{' '}\r\n                <Text type=\"secondary\">(e.g. {DEFAULT_PROGRAM_ID})</Text>\r\n              </Tooltip>\r\n            }\r\n            name=\"programId\"\r\n            initialValue={DEFAULT_PROGRAM_ID}\r\n          >\r\n            <AutoComplete\r\n              value={programId}\r\n              onChange={(value) => setProgramId(value)}\r\n              options={PROGRAM_ID_OPTIONS}\r\n            />\r\n          </Form.Item>\r\n          <Form.Item\r\n            label={\r\n              <Tooltip title=\"Initial number of pool tokens to mint to your account.\">\r\n                Initial Pool Token Supply\r\n              </Tooltip>\r\n            }\r\n            name=\"initialSupply\"\r\n            initialValue=\"1\"\r\n          >\r\n            <Input\r\n              value={initialSupply}\r\n              onChange={(e) => setInitialSupply(e.target.value.trim())}\r\n              type=\"number\"\r\n              min=\"0\"\r\n              step=\"any\"\r\n            />\r\n          </Form.Item>\r\n          <AddRemoveTokenButtons>\r\n            <Button\r\n              onClick={() =>\r\n                setInitialAssets((assets) => assets.concat({ valid: false }))\r\n              }\r\n            >\r\n              Add token\r\n            </Button>{' '}\r\n            <Button\r\n              onClick={() =>\r\n                setInitialAssets((assets) => assets.slice(0, assets.length - 1))\r\n              }\r\n              disabled={initialAssets.length <= 1}\r\n            >\r\n              Remove token\r\n            </Button>\r\n          </AddRemoveTokenButtons>\r\n          {initialAssets.map((asset, i) => (\r\n            <AssetInput setInitialAssets={setInitialAssets} index={i} key={i} />\r\n          ))}\r\n          <Form.Item\r\n            label={\r\n              <Tooltip title=\"Whether the assets in the pool can be controlled by the pool admin.\">\r\n                Admin Controlled\r\n              </Tooltip>\r\n            }\r\n            name=\"adminControlled\"\r\n          >\r\n            <Switch\r\n              checked={adminControlled}\r\n              onChange={(checked) => setAdminControlled(checked)}\r\n              disabled={\r\n                programId === SIMPLE_POOL_PROGRAM_ID ||\r\n                programId === ADMIN_CONTROLLED_POOL_PROGRAM_ID\r\n              }\r\n            />\r\n          </Form.Item>\r\n          {adminControlled ? (\r\n            <Form.Item\r\n              label={\r\n                <Tooltip title=\"Address of the pool admin account.\">\r\n                  Admin Address\r\n                </Tooltip>\r\n              }\r\n            >\r\n              <Input\r\n                value={adminAddress}\r\n                onChange={(e) => setAdminAddress(e.target.value.trim())}\r\n              />\r\n            </Form.Item>\r\n          ) : null}\r\n          <Form.Item label=\" \" colon={false}>\r\n            <Button\r\n              type=\"primary\"\r\n              htmlType=\"submit\"\r\n              disabled={!canSubmit}\r\n              loading={submitting}\r\n            >\r\n              {connected ? 'Submit' : 'Not connected to wallet'}\r\n            </Button>\r\n          </Form.Item>\r\n        </Form>\r\n      </FloatingElement>\r\n      {newPoolAddress ? (\r\n        <FloatingElement>\r\n          <Text>\r\n            New pool address:{' '}\r\n            <Link to={`/pools/${newPoolAddress.toBase58()}`}>\r\n              {newPoolAddress.toBase58()}\r\n            </Link>\r\n          </Text>\r\n        </FloatingElement>\r\n      ) : null}\r\n    </Wrapper>\r\n  );\r\n}\r\n\r\ntype InitialAsset = { valid: false } | ValidInitialAsset;\r\ninterface ValidInitialAsset {\r\n  valid: true;\r\n  mint: PublicKey;\r\n  quantity: number;\r\n}\r\n\r\nfunction AssetInput({ setInitialAssets, index }) {\r\n  const [mintInput, mintInfo] = useMintInput(\r\n    `mint${index}`,\r\n    <Text>Token {index + 1} Mint Address</Text>,\r\n    <>Token mint address for token {index + 1}.</>,\r\n  );\r\n  const [quantity, setQuantity] = useState('');\r\n\r\n  useEffect(() => {\r\n    let change: InitialAsset;\r\n    if (mintInfo && parseFloat(quantity) >= 0) {\r\n      let parsedQuantity = Math.round(\r\n        10 ** mintInfo.decimals * parseFloat(quantity),\r\n      );\r\n      change = {\r\n        mint: mintInfo.address,\r\n        quantity: parsedQuantity,\r\n        valid: true,\r\n      };\r\n    } else {\r\n      change = { valid: false };\r\n    }\r\n    setInitialAssets((assets: InitialAsset[]) =>\r\n      assets.map((old, i) => (i === index ? change : old)),\r\n    );\r\n  }, [setInitialAssets, index, mintInfo, quantity]);\r\n\r\n  return (\r\n    <>\r\n      {mintInput}\r\n      <Form.Item\r\n        label={\r\n          <Tooltip\r\n            title={\r\n              <>\r\n                Initial quantity of token {index + 1} to deposit into the pool.\r\n              </>\r\n            }\r\n          >\r\n            Token {index + 1} Initial Quantity\r\n          </Tooltip>\r\n        }\r\n        name={`quantity${index}`}\r\n        validateStatus={'success'}\r\n      >\r\n        <Input\r\n          value={quantity}\r\n          onChange={(e) => setQuantity(e.target.value.trim())}\r\n          type=\"number\"\r\n          min=\"0\"\r\n          step=\"any\"\r\n        />\r\n      </Form.Item>\r\n    </>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { PublicKey } from '@solana/web3.js';\r\nimport { abbreviateAddress } from '../utils/utils';\r\nimport { useMintToTickers } from '../utils/tokens';\r\nimport { Popover } from 'antd';\r\nimport LinkAddress from './LinkAddress';\r\nimport { InfoCircleOutlined } from '@ant-design/icons';\r\n\r\nexport function MintName({\r\n  mint,\r\n  showAddress = false,\r\n}: {\r\n  mint: string | PublicKey | null | undefined;\r\n  showAddress?: boolean;\r\n}) {\r\n  const mintToTickers = useMintToTickers();\r\n  if (!mint) {\r\n    return null;\r\n  }\r\n  const mintKey = typeof mint === 'string' ? new PublicKey(mint) : mint;\r\n  const mintAddress = typeof mint === 'string' ? mint : mint.toBase58();\r\n  const ticker = mintToTickers[mintAddress] ?? abbreviateAddress(mintKey);\r\n\r\n  return (\r\n    <>\r\n      {ticker}\r\n      {showAddress ? (\r\n        <>\r\n          {' '}\r\n          <Popover\r\n            content={<LinkAddress address={mintAddress} />}\r\n            placement=\"bottomRight\"\r\n            title=\"Token mint\"\r\n            trigger=\"hover\"\r\n          >\r\n            <InfoCircleOutlined style={{ color: '#2abdd2' }} />\r\n          </Popover>\r\n        </>\r\n      ) : null}\r\n    </>\r\n  );\r\n}\r\n","import { Basket, PoolInfo } from '@project-serum/pool';\r\nimport React from 'react';\r\nimport BN from 'bn.js';\r\nimport { PublicKey } from '@solana/web3.js';\r\nimport { useAccountInfo } from '../../../utils/connection';\r\nimport { parseTokenMintData } from '../../../utils/tokens';\r\nimport { Spin } from 'antd';\r\nimport { MintName } from '../../../components/MintName';\r\n\r\ninterface BasketDisplayProps {\r\n  poolInfo: PoolInfo;\r\n  basket?: Basket | null | undefined;\r\n}\r\n\r\nexport default function PoolBasketDisplay({\r\n  poolInfo,\r\n  basket,\r\n}: BasketDisplayProps) {\r\n  return (\r\n    <ul>\r\n      {poolInfo.state.assets.map((asset, index) => (\r\n        <BasketItem\r\n          key={index}\r\n          mint={asset.mint}\r\n          quantity={basket?.quantities[index]}\r\n        />\r\n      ))}\r\n    </ul>\r\n  );\r\n}\r\n\r\ninterface BasketItemProps {\r\n  mint: PublicKey;\r\n  quantity?: BN;\r\n}\r\n\r\nfunction BasketItem({ mint, quantity }: BasketItemProps) {\r\n  const [mintAccountInfo] = useAccountInfo(mint);\r\n  let quantityDisplay = <Spin size=\"small\" />;\r\n  if (mintAccountInfo && quantity) {\r\n    const mintInfo = parseTokenMintData(mintAccountInfo.data);\r\n    quantityDisplay = <>{quantity.toNumber() / 10 ** mintInfo.decimals}</>;\r\n  }\r\n\r\n  return (\r\n    <li>\r\n      {quantityDisplay} <MintName mint={mint} showAddress />\r\n    </li>\r\n  );\r\n}\r\n","import { getPoolBasket, PoolInfo } from '@project-serum/pool';\r\nimport React from 'react';\r\nimport FloatingElement from '../../../components/layout/FloatingElement';\r\nimport { Typography } from 'antd';\r\nimport { MintInfo } from '../../../utils/tokens';\r\nimport { useAsyncData } from '../../../utils/fetch-loop';\r\nimport { useConnection } from '../../../utils/connection';\r\nimport tuple from 'immutable-tuple';\r\nimport PoolBasketDisplay from './PoolBasketDisplay';\r\n\r\nconst { Text, Paragraph } = Typography;\r\n\r\ninterface PoolInfoProps {\r\n  poolInfo: PoolInfo;\r\n  mintInfo: MintInfo;\r\n}\r\n\r\nconst feeFormat = new Intl.NumberFormat(undefined, {\r\n  style: 'percent',\r\n  minimumFractionDigits: 0,\r\n  maximumFractionDigits: 6,\r\n});\r\n\r\nexport default function PoolInfoPanel({ poolInfo, mintInfo }: PoolInfoProps) {\r\n  const connection = useConnection();\r\n\r\n  const [totalBasket] = useAsyncData(\r\n    () => getPoolBasket(connection, poolInfo, { redeem: mintInfo.supply }),\r\n    tuple(getPoolBasket, connection, poolInfo, 'total', mintInfo),\r\n  );\r\n\r\n  return (\r\n    <FloatingElement stretchVertical>\r\n      <Paragraph>Name: {poolInfo.state.name}</Paragraph>\r\n      <Paragraph>\r\n        Address: <Text copyable>{poolInfo.address.toBase58()}</Text>\r\n      </Paragraph>\r\n      <Paragraph>\r\n        Pool token mint address:{' '}\r\n        <Text copyable>{poolInfo.state.poolTokenMint.toBase58()}</Text>\r\n      </Paragraph>\r\n      {poolInfo.state.adminKey ? (\r\n        <Paragraph>\r\n          Pool admin: <Text copyable>{poolInfo.state.adminKey.toBase58()}</Text>\r\n        </Paragraph>\r\n      ) : null}\r\n      <Paragraph>\r\n        Fee rate: {feeFormat.format(poolInfo.state.feeRate / 1_000_000)}\r\n      </Paragraph>\r\n      <Paragraph>\r\n        Total supply: {mintInfo.supply.toNumber() / 10 ** mintInfo.decimals}\r\n      </Paragraph>\r\n      <Text>Total assets:</Text>\r\n      <div>\r\n        <PoolBasketDisplay poolInfo={poolInfo} basket={totalBasket} />\r\n      </div>\r\n    </FloatingElement>\r\n  );\r\n}\r\n","import { getPoolBasket, PoolInfo, PoolTransactions } from '@project-serum/pool';\r\nimport React, { useMemo, useState } from 'react';\r\nimport FloatingElement from '../../../components/layout/FloatingElement';\r\nimport { Button, Input, Spin, Tabs, Typography } from 'antd';\r\nimport { MintInfo } from '../../../utils/tokens';\r\nimport { useAsyncData } from '../../../utils/fetch-loop';\r\nimport { useConnection } from '../../../utils/connection';\r\nimport { PublicKey } from '@solana/web3.js';\r\nimport tuple from 'immutable-tuple';\r\nimport PoolBasketDisplay from './PoolBasketDisplay';\r\nimport BN from 'bn.js';\r\nimport { notify } from '../../../utils/notifications';\r\nimport { useWallet } from '../../../utils/wallet';\r\nimport { useTokenAccounts } from '../../../utils/markets';\r\nimport { sendTransaction } from '../../../utils/send';\r\n\r\nconst { Text } = Typography;\r\nconst { TabPane } = Tabs;\r\n\r\ninterface PoolCreateRedeemPanel {\r\n  poolInfo: PoolInfo;\r\n  mintInfo: MintInfo;\r\n}\r\n\r\nexport default function PoolCreateRedeemPanel({\r\n  poolInfo,\r\n  mintInfo,\r\n}: PoolCreateRedeemPanel) {\r\n  return (\r\n    <FloatingElement stretchVertical>\r\n      <Tabs>\r\n        <TabPane tab=\"Create\" key=\"create\">\r\n          <CreateRedeemTab\r\n            poolInfo={poolInfo}\r\n            mintInfo={mintInfo}\r\n            tab=\"create\"\r\n          />\r\n        </TabPane>\r\n        <TabPane tab=\"Redeem\" key=\"redeem\">\r\n          <CreateRedeemTab\r\n            poolInfo={poolInfo}\r\n            mintInfo={mintInfo}\r\n            tab=\"redeem\"\r\n          />\r\n        </TabPane>\r\n      </Tabs>\r\n    </FloatingElement>\r\n  );\r\n}\r\n\r\ninterface CreateRedeemInnerPanel {\r\n  poolInfo: PoolInfo;\r\n  mintInfo: MintInfo;\r\n  tab: string;\r\n}\r\n\r\nfunction CreateRedeemTab({ poolInfo, mintInfo, tab }: CreateRedeemInnerPanel) {\r\n  const connection = useConnection();\r\n  const { wallet, connected } = useWallet();\r\n  const [quantity, setQuantity] = useState('');\r\n  const [tokenAccounts] = useTokenAccounts();\r\n  const [submitting, setSubmitting] = useState(false);\r\n\r\n  const action = useMemo(() => {\r\n    const parsedQuantity = Math.round(\r\n      parseFloat(quantity) * 10 ** mintInfo.decimals,\r\n    );\r\n    if (parsedQuantity > 0) {\r\n      if (tab === 'create') {\r\n        return { create: new BN(parsedQuantity) };\r\n      } else {\r\n        return { redeem: new BN(parsedQuantity) };\r\n      }\r\n    }\r\n    return null;\r\n  }, [mintInfo.decimals, quantity, tab]);\r\n\r\n  const [basket, basketLoaded] = useAsyncData(\r\n    async () =>\r\n      action ? await getPoolBasket(connection, poolInfo, action) : null,\r\n    tuple(getPoolBasket, connection, poolInfo.address.toBase58(), action),\r\n  );\r\n\r\n  function findTokenAccount(mint: PublicKey): PublicKey {\r\n    const account = tokenAccounts?.find((account) =>\r\n      account.effectiveMint.equals(mint),\r\n    );\r\n    if (account) {\r\n      return account.pubkey;\r\n    }\r\n    throw new Error('No token account for ' + mint.toBase58());\r\n  }\r\n\r\n  const canSubmit = connected && action && basket;\r\n\r\n  async function onSubmit(e) {\r\n    e.preventDefault();\r\n    if (!action || !basket || !connected || !canSubmit || !wallet) {\r\n      return;\r\n    }\r\n    setSubmitting(true);\r\n    try {\r\n      const { transaction, signers } = PoolTransactions.execute(\r\n        poolInfo,\r\n        action,\r\n        {\r\n          owner: wallet.publicKey,\r\n          poolTokenAccount: findTokenAccount(poolInfo.state.poolTokenMint),\r\n          assetAccounts: poolInfo.state.assets.map((asset) =>\r\n            findTokenAccount(asset.mint),\r\n          ),\r\n        },\r\n        basket,\r\n      );\r\n      await sendTransaction({ connection, wallet, transaction, signers });\r\n    } catch (e) {\r\n      console.warn(e);\r\n      notify({\r\n        message:\r\n          'Error ' +\r\n          (tab === 'create' ? 'creating' : 'redeeming') +\r\n          ' pool tokens',\r\n        description: e.message,\r\n        type: 'error',\r\n      });\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={onSubmit}>\r\n      <Input\r\n        addonBefore={<>Quantity</>}\r\n        value={quantity}\r\n        onChange={(e) => setQuantity(e.target.value.trim())}\r\n        style={{ marginBottom: 24 }}\r\n      />\r\n      <div>\r\n        {!basket ? (\r\n          basketLoaded ? null : (\r\n            <Spin />\r\n          )\r\n        ) : (\r\n          <>\r\n            <Text>{tab === 'create' ? 'Cost' : 'Proceeds'}: </Text>\r\n            <Text type=\"secondary\">(indicative only)</Text>\r\n            <PoolBasketDisplay poolInfo={poolInfo} basket={basket} />\r\n          </>\r\n        )}\r\n      </div>\r\n      <Button\r\n        htmlType=\"submit\"\r\n        type=\"primary\"\r\n        disabled={!canSubmit || submitting}\r\n      >\r\n        {!connected ? 'Wallet not connected' : 'Submit'}\r\n      </Button>\r\n    </form>\r\n  );\r\n}\r\n","import { PoolInfo } from '@project-serum/pool';\r\nimport React from 'react';\r\nimport { PublicKey } from '@solana/web3.js';\r\nimport { useAccountInfo } from '../../../utils/connection';\r\nimport {\r\n  parseTokenAccountData,\r\n  parseTokenMintData,\r\n} from '../../../utils/tokens';\r\nimport { Button, Spin, Tabs } from 'antd';\r\nimport FloatingElement from '../../../components/layout/FloatingElement';\r\nimport { useTokenAccounts } from '../../../utils/markets';\r\nimport { MintName } from '../../../components/MintName';\r\nimport { LinkOutlined } from '@ant-design/icons';\r\nimport { WRAPPED_SOL_MINT } from '@project-serum/serum/lib/token-instructions';\r\n\r\nconst { TabPane } = Tabs;\r\n\r\nexport default function PoolBalancesPanel({\r\n  poolInfo,\r\n}: {\r\n  poolInfo: PoolInfo;\r\n}) {\r\n  return (\r\n    <FloatingElement>\r\n      <Tabs>\r\n        <TabPane tab=\"Wallet Balances\" key=\"wallet\">\r\n          <WalletBalancesTab poolInfo={poolInfo} />\r\n        </TabPane>\r\n        <TabPane tab=\"Pool Balances\" key=\"pool\">\r\n          <PoolBalancesTab poolInfo={poolInfo} />\r\n        </TabPane>\r\n      </Tabs>\r\n    </FloatingElement>\r\n  );\r\n}\r\n\r\nfunction WalletBalancesTab({ poolInfo }: { poolInfo: PoolInfo }) {\r\n  const [tokenAccounts] = useTokenAccounts();\r\n  return (\r\n    <ul>\r\n      {[\r\n        poolInfo.state.poolTokenMint,\r\n        ...poolInfo.state.assets.map((asset) => asset.mint),\r\n      ].map((mint, index) => {\r\n        const tokenAccount = tokenAccounts?.find((account) =>\r\n          account.effectiveMint.equals(mint),\r\n        );\r\n        if (!tokenAccount) {\r\n          return null;\r\n        }\r\n        return (\r\n          <BalanceItem\r\n            key={index}\r\n            mint={mint}\r\n            publicKey={tokenAccount.pubkey}\r\n            isPoolToken={mint.equals(poolInfo.state.poolTokenMint)}\r\n          />\r\n        );\r\n      })}\r\n    </ul>\r\n  );\r\n}\r\n\r\nfunction PoolBalancesTab({ poolInfo }: { poolInfo: PoolInfo }) {\r\n  return (\r\n    <ul>\r\n      {poolInfo.state.assets.map((asset, index) => {\r\n        return (\r\n          <BalanceItem\r\n            key={index}\r\n            mint={asset.mint}\r\n            publicKey={asset.vaultAddress}\r\n          />\r\n        );\r\n      })}\r\n    </ul>\r\n  );\r\n}\r\n\r\ninterface BalanceItemProps {\r\n  mint: PublicKey;\r\n  publicKey: PublicKey;\r\n  isPoolToken?: boolean;\r\n}\r\n\r\nfunction BalanceItem({ mint, publicKey, isPoolToken }: BalanceItemProps) {\r\n  const [mintAccountInfo] = useAccountInfo(mint);\r\n  const [balanceAccountInfo] = useAccountInfo(publicKey);\r\n  let quantityDisplay = <Spin size=\"small\" />;\r\n  if (mintAccountInfo && balanceAccountInfo) {\r\n    const mintInfo = parseTokenMintData(mintAccountInfo.data);\r\n    if (mint.equals(WRAPPED_SOL_MINT)) {\r\n      quantityDisplay = (\r\n        <>{balanceAccountInfo.lamports / 10 ** mintInfo.decimals}</>\r\n      );\r\n    } else {\r\n      const accountInfo = parseTokenAccountData(balanceAccountInfo.data);\r\n      quantityDisplay = <>{accountInfo.amount / 10 ** mintInfo.decimals}</>;\r\n    }\r\n  }\r\n\r\n  return (\r\n    <li>\r\n      {quantityDisplay}{' '}\r\n      {isPoolToken ? (\r\n        <>\r\n          Pool Token (<MintName mint={mint} />)\r\n        </>\r\n      ) : (\r\n        <MintName mint={mint} />\r\n      )}{' '}\r\n      <Button\r\n        type=\"link\"\r\n        icon={<LinkOutlined />}\r\n        href={'https://explorer.solana.com/address/' + publicKey.toBase58()}\r\n        target=\"_blank\"\r\n        rel=\"noopener noreferrer\"\r\n      />\r\n    </li>\r\n  );\r\n}\r\n","import React, { FormEvent, useMemo, useState } from 'react';\r\nimport { AdminControlledPoolInstructions, PoolInfo } from '@project-serum/pool';\r\nimport { TokenInstructions } from '@project-serum/serum';\r\nimport FloatingElement from '../../../components/layout/FloatingElement';\r\nimport { useConnection } from '../../../utils/connection';\r\nimport { useWallet } from '../../../utils/wallet';\r\nimport {\r\n  getSelectedTokenAccountForMint,\r\n  useTokenAccounts,\r\n} from '../../../utils/markets';\r\nimport { sendTransaction } from '../../../utils/send';\r\nimport { notify } from '../../../utils/notifications';\r\nimport {\r\n  Account,\r\n  PublicKey,\r\n  SystemProgram,\r\n  Transaction,\r\n} from '@solana/web3.js';\r\nimport { AutoComplete, Button, Input, Select, Tabs } from 'antd';\r\nimport {\r\n  createAssociatedTokenAccount,\r\n  getAssociatedTokenAddress,\r\n} from '@project-serum/associated-token';\r\nimport { parseTokenMintData, useMintToTickers } from '../../../utils/tokens';\r\nimport BN from 'bn.js';\r\nimport { refreshAllCaches } from '../../../utils/fetch-loop';\r\n\r\nconst { TabPane } = Tabs;\r\nconst { Option } = Select;\r\n\r\nexport function PoolAdminPanel({ poolInfo }: { poolInfo: PoolInfo }) {\r\n  return (\r\n    <FloatingElement>\r\n      <Tabs>\r\n        <TabPane tab=\"Pause/Unpause\" key=\"pause\">\r\n          <PauseUnpauseTab poolInfo={poolInfo} />\r\n        </TabPane>\r\n        <TabPane tab=\"Add Token\" key=\"addAsset\">\r\n          <AddAssetTab poolInfo={poolInfo} />\r\n        </TabPane>\r\n        <TabPane tab=\"Remove Token\" key=\"removeAsset\">\r\n          <RemoveAssetTab poolInfo={poolInfo} />\r\n        </TabPane>\r\n        <TabPane tab=\"Deposit\" key=\"deposit\">\r\n          <DepositTab poolInfo={poolInfo} />\r\n        </TabPane>\r\n        <TabPane tab=\"Withdraw\" key=\"withdraw\">\r\n          <WithdrawTab poolInfo={poolInfo} />\r\n        </TabPane>\r\n        <TabPane tab=\"Modify Fee\" key=\"updateFee\">\r\n          <UpdateFeeTab poolInfo={poolInfo} />\r\n        </TabPane>\r\n      </Tabs>\r\n    </FloatingElement>\r\n  );\r\n}\r\n\r\ninterface TabParams {\r\n  poolInfo: PoolInfo;\r\n}\r\n\r\nfunction PauseUnpauseTab({ poolInfo }: TabParams) {\r\n  const connection = useConnection();\r\n  const { wallet, connected } = useWallet();\r\n  const [submitting, setSubmitting] = useState(false);\r\n\r\n  async function sendPause() {\r\n    if (!connected || !wallet) {\r\n      return;\r\n    }\r\n    setSubmitting(true);\r\n    try {\r\n      const transaction = new Transaction();\r\n      transaction.add(AdminControlledPoolInstructions.pause(poolInfo));\r\n      await sendTransaction({ connection, wallet, transaction });\r\n    } catch (e) {\r\n      notify({\r\n        message: 'Error pausing pool',\r\n        description: e.message,\r\n        type: 'error',\r\n      });\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  }\r\n\r\n  async function sendUnpause() {\r\n    if (!connected || !wallet) {\r\n      return;\r\n    }\r\n    setSubmitting(true);\r\n    try {\r\n      const transaction = new Transaction();\r\n      transaction.add(AdminControlledPoolInstructions.unpause(poolInfo));\r\n      await sendTransaction({ connection, wallet, transaction });\r\n    } catch (e) {\r\n      notify({\r\n        message: 'Error unpausing pool',\r\n        description: e.message,\r\n        type: 'error',\r\n      });\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Button onClick={sendPause} disabled={submitting}>\r\n        Pause\r\n      </Button>{' '}\r\n      <Button onClick={sendUnpause} disabled={submitting}>\r\n        Unpause\r\n      </Button>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction AddAssetTab({ poolInfo }: TabParams) {\r\n  const connection = useConnection();\r\n  const [address, setAddress] = useState('');\r\n  const { wallet, connected } = useWallet();\r\n  const canSubmit = connected && address;\r\n  const [onSubmit, submitting] = useOnSubmitHandler(\r\n    'adding asset to pool',\r\n    async () => {\r\n      const mintAddress = new PublicKey(address);\r\n      const vaultAddress = await getAssociatedTokenAddress(\r\n        poolInfo.state.vaultSigner,\r\n        mintAddress,\r\n      );\r\n      const transaction = new Transaction();\r\n      if (!(await connection.getAccountInfo(vaultAddress)) && wallet) {\r\n        transaction.add(\r\n          await createAssociatedTokenAccount(\r\n            wallet.publicKey,\r\n            poolInfo.state.vaultSigner,\r\n            mintAddress,\r\n          ),\r\n        );\r\n      }\r\n      transaction.add(\r\n        AdminControlledPoolInstructions.addAsset(poolInfo, vaultAddress),\r\n      );\r\n      return [transaction, []];\r\n    },\r\n  );\r\n\r\n  return (\r\n    <form onSubmit={onSubmit}>\r\n      <MintSelector\r\n        label=\"Token Mint Address\"\r\n        value={address}\r\n        onChange={(value) => setAddress(value)}\r\n        style={{ marginBottom: 24 }}\r\n      />\r\n      <SubmitButton canSubmit={canSubmit} submitting={submitting} />\r\n    </form>\r\n  );\r\n}\r\n\r\nfunction RemoveAssetTab({ poolInfo }: TabParams) {\r\n  const [address, setAddress] = useState('');\r\n  const { connected } = useWallet();\r\n  const canSubmit = connected && address;\r\n  const [onSubmit, submitting] = useOnSubmitHandler(\r\n    'removing asset from pool',\r\n    async () => {\r\n      const mintAddress = new PublicKey(address);\r\n      const vaultAddress = poolInfo.state.assets.find((asset) =>\r\n        asset.mint.equals(mintAddress),\r\n      )?.vaultAddress;\r\n      if (!vaultAddress) {\r\n        throw new Error('Asset not in pool');\r\n      }\r\n      const transaction = new Transaction();\r\n      transaction.add(\r\n        AdminControlledPoolInstructions.removeAsset(poolInfo, vaultAddress),\r\n      );\r\n      return [transaction, []];\r\n    },\r\n  );\r\n\r\n  return (\r\n    <form onSubmit={onSubmit}>\r\n      <MintInPoolSelector\r\n        poolInfo={poolInfo}\r\n        label=\"Token Mint Address\"\r\n        value={address}\r\n        onChange={(value) => setAddress(value)}\r\n        style={{ marginBottom: 24 }}\r\n      />\r\n      <SubmitButton canSubmit={canSubmit} submitting={submitting} />\r\n    </form>\r\n  );\r\n}\r\n\r\nfunction DepositTab({ poolInfo }: TabParams) {\r\n  const [address, setAddress] = useState('');\r\n  const [quantity, setQuantity] = useState('');\r\n\r\n  const connection = useConnection();\r\n  const { wallet, connected } = useWallet();\r\n  const [tokenAccounts] = useTokenAccounts();\r\n  const canSubmit =\r\n    connected && address && tokenAccounts && parseFloat(quantity);\r\n\r\n  const [onSubmit, submitting] = useOnSubmitHandler(\r\n    'depositing to pool',\r\n    async () => {\r\n      if (!wallet) {\r\n        throw new Error('Wallet is not connected');\r\n      }\r\n\r\n      const mintAddress = new PublicKey(address);\r\n      const vaultAddress = poolInfo.state.assets.find((asset) =>\r\n        asset.mint.equals(mintAddress),\r\n      )?.vaultAddress;\r\n      if (!vaultAddress) {\r\n        throw new Error('Asset not in pool');\r\n      }\r\n\r\n      const walletTokenAccount = getSelectedTokenAccountForMint(\r\n        tokenAccounts,\r\n        mintAddress,\r\n      );\r\n      if (!walletTokenAccount) {\r\n        throw new Error('Asset not in wallet');\r\n      }\r\n\r\n      const mintAccountInfo = await connection.getAccountInfo(mintAddress);\r\n      if (!mintAccountInfo) {\r\n        throw new Error('Mint not found');\r\n      }\r\n      const mintDecimals = parseTokenMintData(mintAccountInfo.data).decimals;\r\n      const parsedQuantity = Math.round(\r\n        parseFloat(quantity) * 10 ** mintDecimals,\r\n      );\r\n\r\n      const wrappedSolAccount =\r\n        mintAddress.equals(TokenInstructions.WRAPPED_SOL_MINT) &&\r\n        walletTokenAccount.pubkey.equals(wallet.publicKey)\r\n          ? new Account()\r\n          : null;\r\n\r\n      const transaction = new Transaction();\r\n      const signers: Account[] = [];\r\n      if (wrappedSolAccount) {\r\n        transaction.add(\r\n          SystemProgram.createAccount({\r\n            fromPubkey: wallet.publicKey,\r\n            lamports: parsedQuantity + 2.04e6,\r\n            newAccountPubkey: wrappedSolAccount.publicKey,\r\n            programId: TokenInstructions.TOKEN_PROGRAM_ID,\r\n            space: 165,\r\n          }),\r\n          TokenInstructions.initializeAccount({\r\n            account: wrappedSolAccount.publicKey,\r\n            mint: TokenInstructions.WRAPPED_SOL_MINT,\r\n            owner: wallet.publicKey,\r\n          }),\r\n          TokenInstructions.transfer({\r\n            source: wrappedSolAccount.publicKey,\r\n            destination: vaultAddress,\r\n            amount: parsedQuantity,\r\n            owner: wallet.publicKey,\r\n          }),\r\n          TokenInstructions.closeAccount({\r\n            source: wrappedSolAccount.publicKey,\r\n            destination: walletTokenAccount.pubkey,\r\n            owner: wallet.publicKey,\r\n          }),\r\n        );\r\n        signers.push(wrappedSolAccount);\r\n      } else {\r\n        transaction.add(\r\n          TokenInstructions.transfer({\r\n            source: walletTokenAccount.pubkey,\r\n            destination: vaultAddress,\r\n            amount: parsedQuantity,\r\n            owner: wallet.publicKey,\r\n          }),\r\n        );\r\n      }\r\n      return [transaction, signers];\r\n    },\r\n    true,\r\n  );\r\n\r\n  return (\r\n    <form onSubmit={onSubmit}>\r\n      <MintInPoolSelector\r\n        poolInfo={poolInfo}\r\n        label=\"Token Mint Address\"\r\n        value={address}\r\n        onChange={(value) => setAddress(value)}\r\n        style={{ marginBottom: 24 }}\r\n      />\r\n      <Input\r\n        addonBefore={<>Quantity</>}\r\n        value={quantity}\r\n        onChange={(e) => setQuantity(e.target.value.trim())}\r\n        style={{ marginBottom: 24 }}\r\n      />\r\n      <SubmitButton canSubmit={canSubmit} submitting={submitting} />\r\n    </form>\r\n  );\r\n}\r\n\r\nfunction WithdrawTab({ poolInfo }: TabParams) {\r\n  const [address, setAddress] = useState('');\r\n  const [quantity, setQuantity] = useState('');\r\n\r\n  const connection = useConnection();\r\n  const { wallet, connected } = useWallet();\r\n  const [tokenAccounts] = useTokenAccounts();\r\n  const canSubmit =\r\n    connected && address && tokenAccounts && parseFloat(quantity);\r\n\r\n  const [onSubmit, submitting] = useOnSubmitHandler(\r\n    'withdrawing from pool',\r\n    async () => {\r\n      if (!wallet) {\r\n        throw new Error('Wallet is not connected');\r\n      }\r\n\r\n      const mintAddress = new PublicKey(address);\r\n      const vaultAddress = poolInfo.state.assets.find((asset) =>\r\n        asset.mint.equals(mintAddress),\r\n      )?.vaultAddress;\r\n      if (!vaultAddress) {\r\n        throw new Error('Asset not in pool');\r\n      }\r\n\r\n      const walletTokenAccount = getSelectedTokenAccountForMint(\r\n        tokenAccounts,\r\n        mintAddress,\r\n      );\r\n      if (!walletTokenAccount) {\r\n        throw new Error('Asset not in wallet');\r\n      }\r\n\r\n      const mintAccountInfo = await connection.getAccountInfo(mintAddress);\r\n      if (!mintAccountInfo) {\r\n        throw new Error('Mint not found');\r\n      }\r\n      const mintDecimals = parseTokenMintData(mintAccountInfo.data).decimals;\r\n      const parsedQuantity = Math.round(\r\n        parseFloat(quantity) * 10 ** mintDecimals,\r\n      );\r\n\r\n      const wrappedSolAccount =\r\n        mintAddress.equals(TokenInstructions.WRAPPED_SOL_MINT) &&\r\n        walletTokenAccount.pubkey.equals(wallet.publicKey)\r\n          ? new Account()\r\n          : null;\r\n\r\n      const transaction = new Transaction();\r\n      const signers: Account[] = [];\r\n      if (wrappedSolAccount) {\r\n        transaction.add(\r\n          SystemProgram.createAccount({\r\n            fromPubkey: wallet.publicKey,\r\n            lamports: 2.04e6,\r\n            newAccountPubkey: wrappedSolAccount.publicKey,\r\n            programId: TokenInstructions.TOKEN_PROGRAM_ID,\r\n            space: 165,\r\n          }),\r\n          TokenInstructions.initializeAccount({\r\n            account: wrappedSolAccount.publicKey,\r\n            mint: TokenInstructions.WRAPPED_SOL_MINT,\r\n            owner: wallet.publicKey,\r\n          }),\r\n        );\r\n        signers.push(wrappedSolAccount);\r\n      }\r\n      transaction.add(\r\n        AdminControlledPoolInstructions.approveDelegate(\r\n          poolInfo,\r\n          vaultAddress,\r\n          wallet.publicKey,\r\n          new BN(parsedQuantity),\r\n        ),\r\n      );\r\n      if (wrappedSolAccount) {\r\n        transaction.add(\r\n          TokenInstructions.transfer({\r\n            source: vaultAddress,\r\n            destination: wrappedSolAccount.publicKey,\r\n            amount: parsedQuantity,\r\n            owner: wallet.publicKey,\r\n          }),\r\n          TokenInstructions.closeAccount({\r\n            source: wrappedSolAccount.publicKey,\r\n            destination: walletTokenAccount.pubkey,\r\n            owner: wallet.publicKey,\r\n          }),\r\n        );\r\n      } else {\r\n        transaction.add(\r\n          TokenInstructions.transfer({\r\n            source: vaultAddress,\r\n            destination: walletTokenAccount.pubkey,\r\n            amount: parsedQuantity,\r\n            owner: wallet.publicKey,\r\n          }),\r\n        );\r\n      }\r\n      return [transaction, signers];\r\n    },\r\n  );\r\n\r\n  return (\r\n    <form onSubmit={onSubmit}>\r\n      <MintInPoolSelector\r\n        poolInfo={poolInfo}\r\n        label=\"Token Mint Address\"\r\n        value={address}\r\n        onChange={(value) => setAddress(value)}\r\n        style={{ marginBottom: 24 }}\r\n      />\r\n      <Input\r\n        addonBefore={<>Quantity</>}\r\n        value={quantity}\r\n        onChange={(e) => setQuantity(e.target.value.trim())}\r\n        style={{ marginBottom: 24 }}\r\n      />\r\n      <SubmitButton canSubmit={canSubmit} submitting={submitting} />\r\n    </form>\r\n  );\r\n}\r\n\r\nfunction UpdateFeeTab({ poolInfo }: TabParams) {\r\n  const [feeRate, setFeeRate] = useState('');\r\n\r\n  const { connected } = useWallet();\r\n  const [tokenAccounts] = useTokenAccounts();\r\n  const canSubmit = connected && tokenAccounts && parseFloat(feeRate);\r\n\r\n  const [onSubmit, submitting] = useOnSubmitHandler(\r\n    'changing pool fee',\r\n    async () => {\r\n      const transaction = new Transaction();\r\n      transaction.add(\r\n        AdminControlledPoolInstructions.updateFee(\r\n          poolInfo,\r\n          Math.round(parseFloat(feeRate) * 1_000_000),\r\n        ),\r\n      );\r\n      return [transaction, []];\r\n    },\r\n  );\r\n\r\n  return (\r\n    <form onSubmit={onSubmit}>\r\n      <Input\r\n        addonBefore={<>Fee Rate</>}\r\n        value={feeRate}\r\n        onChange={(e) => setFeeRate(e.target.value.trim())}\r\n        style={{ marginBottom: 24 }}\r\n      />\r\n      <SubmitButton canSubmit={canSubmit} submitting={submitting} />\r\n    </form>\r\n  );\r\n}\r\n\r\nfunction useOnSubmitHandler(\r\n  description: string,\r\n  makeTransaction: () => Promise<[Transaction, Account[]]>,\r\n  refresh = false,\r\n): [(FormEvent) => void, boolean] {\r\n  const connection = useConnection();\r\n  const { wallet, connected } = useWallet();\r\n  const [submitting, setSubmitting] = useState(false);\r\n\r\n  async function onSubmit(e: FormEvent) {\r\n    e.preventDefault();\r\n    if (submitting) {\r\n      return;\r\n    }\r\n    setSubmitting(true);\r\n    try {\r\n      if (!connected || !wallet) {\r\n        throw new Error('Wallet not connected');\r\n      }\r\n      const [transaction, signers] = await makeTransaction();\r\n      await sendTransaction({ connection, wallet, transaction, signers });\r\n      if (refresh) {\r\n        refreshAllCaches();\r\n      }\r\n    } catch (e) {\r\n      notify({\r\n        message: `Error ${description}`,\r\n        description: e.message,\r\n        type: 'error',\r\n      });\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  }\r\n\r\n  return [onSubmit, submitting];\r\n}\r\n\r\nfunction SubmitButton({ canSubmit, submitting }) {\r\n  const { connected } = useWallet();\r\n  return (\r\n    <Button\r\n      htmlType=\"submit\"\r\n      type=\"primary\"\r\n      disabled={!canSubmit || submitting}\r\n    >\r\n      {!connected ? 'Wallet not connected' : 'Submit'}\r\n    </Button>\r\n  );\r\n}\r\n\r\nfunction MintInPoolSelector({\r\n  poolInfo,\r\n  label,\r\n  value,\r\n  onChange,\r\n  style,\r\n}: {\r\n  poolInfo: PoolInfo;\r\n  label: string;\r\n  value: string;\r\n  onChange: (string) => void;\r\n  style: any;\r\n}) {\r\n  const mintToTickers = useMintToTickers();\r\n  return (\r\n    <Input.Group style={style}>\r\n      <span className=\"ant-input-group-addon\">{label}</span>\r\n      <Select onChange={onChange} value={value} style={{ width: '100%' }}>\r\n        {poolInfo.state.assets.map((asset) => (\r\n          <Option value={asset.mint.toBase58()} key={asset.mint.toBase58()}>\r\n            {mintToTickers[asset.mint.toBase58()] ? (\r\n              <>\r\n                {mintToTickers[asset.mint.toBase58()]} ({asset.mint.toBase58()})\r\n              </>\r\n            ) : (\r\n              asset.mint.toBase58()\r\n            )}\r\n          </Option>\r\n        ))}\r\n      </Select>\r\n    </Input.Group>\r\n  );\r\n}\r\n\r\nfunction MintSelector({ label, style, value, onChange }) {\r\n  const mintToTickers = useMintToTickers();\r\n  const options = useMemo(() => {\r\n    return Object.entries(mintToTickers)\r\n      .filter(\r\n        ([mintAddress, ticker]) =>\r\n          mintAddress.includes(value) ||\r\n          ticker.toLowerCase().includes(value.toLowerCase()),\r\n      )\r\n      .map(([mintAddress, ticker]) => ({\r\n        value: mintAddress,\r\n        label: (\r\n          <>\r\n            {ticker} ({mintAddress})\r\n          </>\r\n        ),\r\n      }));\r\n  }, [mintToTickers, value]);\r\n  return (\r\n    <Input.Group style={style}>\r\n      <span className=\"ant-input-group-addon\">{label}</span>\r\n      <AutoComplete\r\n        options={options}\r\n        value={value}\r\n        onChange={(e) => onChange(e)}\r\n        style={{ width: '100%' }}\r\n      />\r\n    </Input.Group>\r\n  );\r\n}\r\n","import React, { useMemo } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport { Col, PageHeader, Row, Spin, Typography } from 'antd';\r\nimport { PublicKey } from '@solana/web3.js';\r\nimport { useAccountInfo } from '../../../utils/connection';\r\nimport FloatingElement from '../../../components/layout/FloatingElement';\r\nimport {\r\n  decodePoolState,\r\n  isAdminControlledPool,\r\n  PoolInfo,\r\n} from '@project-serum/pool';\r\nimport PoolInfoPanel from './PoolInfoPanel';\r\nimport { parseTokenMintData } from '../../../utils/tokens';\r\nimport PoolCreateRedeemPanel from './PoolCreateRedeemPanel';\r\nimport PoolBalancesPanel from './PoolBalancesPanel';\r\nimport { useHistory } from 'react-router-dom';\r\nimport { PoolAdminPanel } from './PoolAdminPanel';\r\nimport { useWallet } from '../../../utils/wallet';\r\n\r\nconst { Text } = Typography;\r\n\r\nexport default function PoolPage() {\r\n  const { poolAddress } = useParams();\r\n  const [poolAccountInfo, poolAccountLoaded] = useAccountInfo(\r\n    isPublicKey(poolAddress) ? new PublicKey(poolAddress) : null,\r\n  );\r\n  const history = useHistory();\r\n\r\n  const poolInfo: PoolInfo | null = useMemo(() => {\r\n    if (!poolAccountInfo) {\r\n      return null;\r\n    }\r\n    try {\r\n      return {\r\n        address: new PublicKey(poolAddress),\r\n        state: decodePoolState(poolAccountInfo.data),\r\n        program: poolAccountInfo.owner,\r\n      };\r\n    } catch (e) {\r\n      return null;\r\n    }\r\n  }, [poolAddress, poolAccountInfo]);\r\n  const [mintAccountInfo, mintAccountInfoLoaded] = useAccountInfo(\r\n    poolInfo?.state.poolTokenMint,\r\n  );\r\n  const mintInfo = useMemo(\r\n    () => (mintAccountInfo ? parseTokenMintData(mintAccountInfo.data) : null),\r\n    [mintAccountInfo],\r\n  );\r\n  const { wallet } = useWallet();\r\n\r\n  if (poolInfo && mintInfo && wallet) {\r\n    return (\r\n      <>\r\n        <PageHeader\r\n          title={<>Pool {poolInfo.address.toBase58()}</>}\r\n          onBack={() => history.push('/pools')}\r\n          subTitle={poolInfo.state.name}\r\n        />\r\n        <Row>\r\n          <Col xs={24} lg={12}>\r\n            <PoolInfoPanel poolInfo={poolInfo} mintInfo={mintInfo} />\r\n          </Col>\r\n          <Col xs={24} lg={12}>\r\n            <PoolCreateRedeemPanel poolInfo={poolInfo} mintInfo={mintInfo} />\r\n          </Col>\r\n          <Col xs={24}>\r\n            <PoolBalancesPanel poolInfo={poolInfo} />\r\n          </Col>\r\n          {wallet.connected &&\r\n          poolInfo.state.adminKey?.equals(wallet.publicKey) &&\r\n          isAdminControlledPool(poolInfo) ? (\r\n            <Col xs={24}>\r\n              <PoolAdminPanel poolInfo={poolInfo} />\r\n            </Col>\r\n          ) : null}\r\n        </Row>\r\n      </>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <PageHeader\r\n        title={<>Pool {poolAddress}</>}\r\n        onBack={() => history.push('/pools')}\r\n      />\r\n      <FloatingElement>\r\n        {!poolAccountLoaded || !mintAccountInfoLoaded ? (\r\n          <Spin />\r\n        ) : (\r\n          <Text>Invalid pool</Text>\r\n        )}\r\n      </FloatingElement>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction isPublicKey(address) {\r\n  try {\r\n    new PublicKey(address);\r\n    return true;\r\n  } catch (e) {\r\n    return false;\r\n  }\r\n}\r\n","import styled from 'styled-components';\r\nimport FloatingElement from '../../components/layout/FloatingElement';\r\nimport React, { useState } from 'react';\r\nimport { Button, Input, Typography } from 'antd';\r\nimport { useHistory } from 'react-router-dom';\r\nimport Link from '../../components/Link';\r\n\r\nconst { Title } = Typography;\r\n\r\nconst Wrapper = styled.div`\r\n  max-width: 700px;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  margin-top: 24px;\r\n  margin-bottom: 24px;\r\n`;\r\n\r\nconst Form = styled.form`\r\n  display: flex;\r\n  margin-top: 16px;\r\n  margin-bottom: 48px;\r\n`;\r\n\r\nexport default function PoolListPage() {\r\n  const [poolAddress, setPoolAddress] = useState('');\r\n  const history = useHistory();\r\n\r\n  function onSubmit(e) {\r\n    e.preventDefault();\r\n    history.push(`/pools/${poolAddress}`);\r\n  }\r\n  return (\r\n    <Wrapper>\r\n      <FloatingElement>\r\n        <Title level={3}>Pools</Title>\r\n        <Form onSubmit={onSubmit}>\r\n          <Input\r\n            value={poolAddress}\r\n            onChange={(e) => setPoolAddress(e.target.value.trim())}\r\n            placeholder=\"Pool address\"\r\n          />\r\n          <Button type=\"primary\" htmlType=\"submit\">\r\n            Go\r\n          </Button>\r\n        </Form>\r\n        <Link to=\"/pools/new\">Create new pool</Link>\r\n      </FloatingElement>\r\n    </Wrapper>\r\n  );\r\n}\r\n","import { HashRouter, Route, Switch, Redirect } from 'react-router-dom';\r\nimport TradePage from './pages/TradePage';\r\nimport OpenOrdersPage from './pages/OpenOrdersPage';\r\nimport React from 'react';\r\nimport BalancesPage from './pages/BalancesPage';\r\nimport ConvertPage from './pages/ConvertPage';\r\nimport BasicLayout from './components/BasicLayout';\r\nimport ListNewMarketPage from './pages/ListNewMarketPage';\r\nimport NewPoolPage from './pages/pools/NewPoolPage';\r\nimport PoolPage from './pages/pools/PoolPage';\r\nimport PoolListPage from './pages/pools/PoolListPage';\r\nimport { getTradePageUrl } from './utils/markets';\r\n\r\nexport function Routes() {\r\n  return (\r\n    <>\r\n      <HashRouter basename={'/'}>\r\n        <BasicLayout>\r\n          <Switch>\r\n            <Route exact path=\"/\">\r\n              <Redirect to={getTradePageUrl()} />\r\n            </Route>\r\n            <Route exact path=\"/market/:marketAddress\">\r\n              <TradePage />\r\n            </Route>\r\n            <Route exact path=\"/orders\" component={OpenOrdersPage} />\r\n            <Route exact path=\"/balances\" component={BalancesPage} />\r\n            <Route exact path=\"/convert\" component={ConvertPage} />\r\n            <Route\r\n              exact\r\n              path=\"/list-new-market\"\r\n              component={ListNewMarketPage}\r\n            />\r\n            <Route exact path=\"/pools\">\r\n              <PoolListPage />\r\n            </Route>\r\n            <Route exact path=\"/pools/new\">\r\n              <NewPoolPage />\r\n            </Route>\r\n            <Route exact path=\"/pools/:poolAddress\">\r\n              <PoolPage />\r\n            </Route>\r\n          </Switch>\r\n        </BasicLayout>\r\n      </HashRouter>\r\n    </>\r\n  );\r\n}\r\n","import React, { Suspense } from 'react';\r\nimport './App.less';\r\nimport { ConnectionProvider } from './utils/connection';\r\nimport { WalletProvider } from './utils/wallet';\r\nimport { GlobalStyle } from './global_style';\r\nimport { Spin } from 'antd';\r\nimport ErrorBoundary from './components/ErrorBoundary';\r\nimport { Routes } from './routes';\r\nimport { PreferencesProvider } from './utils/preferences';\r\n\r\nexport default function App() {\r\n  return (\r\n    <Suspense fallback={() => <Spin size=\"large\" />}>\r\n      <GlobalStyle />\r\n      <ErrorBoundary>\r\n        <ConnectionProvider>\r\n          <WalletProvider>\r\n            <PreferencesProvider>\r\n              <Suspense fallback={() => <Spin size=\"large\" />}>\r\n                <Routes />\r\n              </Suspense>\r\n            </PreferencesProvider>\r\n          </WalletProvider>\r\n        </ConnectionProvider>\r\n      </ErrorBoundary>\r\n    </Suspense>\r\n  );\r\n}\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\r\n    ),\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA',\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then((registration) => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.',\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then((response) => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.',\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then((registration) => {\r\n        registration.unregister();\r\n      })\r\n      .catch((error) => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root'),\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}